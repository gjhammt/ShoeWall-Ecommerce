define(["require","jquery","pubsub","wcs.context","wcs.utils","wcs.alert","wcs.product-form-core","wcs.product-form-util","wcs.product-form-data-extract"],function(d,g,t,a,s,b,i,e,n){var o,r,c="AddToCartForm",u=s.getURLParam(window.location.href,"token"),C=g(".product-form-js").data("redeem-gift-enabled")&&0<u.length,l=function(t){return this instanceof l?(this.productForm=g(t),this):new l(t)};l.prototype={initAddToCart:function(){var e=this;return this.unbindAddToCartEvents(),this.initAddToCartEvents(),this.initProductFormCore(),this.initRedeemAGift(),this.initProductAuthentication(),this.initAddToWishListClass(),this.initGlobalEvent(),this.skuAuthenticationEnabled&&g.pubsub("subscribe","WCS.PRODUCTFORM.COLOR.ITEM.AVAILABILITY",function(t,i){if(i.itemKey)try{e.currentCatEntry=parseInt(i.itemKey),i.isClicked?(e.selectedCatEntry=e.currentCatEntry,e.lastEventHover=!1):e.lastEventHover=!0,e.initAuthenticationRequiredSwatch()}catch(t){console.error("Cannot parse cat entry")}}),this},initProductAuthentication:function(){this.isAuthenticated=!1;var t=g(".attr-box.selected > .color-swatch-button-content"),i=t.data();i&&""===i.authenticatedOnlyAddToCart&&(this.skuAuthenticationEnabled=""===t.closest(".product-content-form-attr-container").data().skuLevelAuthenticationEnabled,this.$addToCartButton=this.productForm.find(".add-to-bag-js"),this.$signInButton=this.productForm.find(".sign-in-button"),this.signInCookieName=this.$signInButton.data("signInCookieName"),this.signInCookieValidValue=this.$signInButton.data("signInCookieValidValue")||"full",this.initAuthenticationRequiredSwatch(),g.pubsub("subscribe","product-form.attr.swatch.click",this.initAuthenticationRequiredSwatch.bind(this)),this.skuAuthenticationEnabled&&g.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",this.focusOut.bind(this)))},focusOut:function(){this.currentCatEntry=this.selectedCatEntry,this.initAuthenticationRequiredSwatch()},initAuthenticationRequiredSwatch:function(){var t=g(".attr-box.selected > .color-swatch-button-content");this.checkLoyaltyCookie();var i=!0!==this.skuAuthenticationEnabled;this.currentCatEntry&&this.productAvailJSON.skuPreSale&&this.productAvailJSON.skuPreSale.skus&&0<this.productAvailJSON.skuPreSale.skus.length&&-1<this.productAvailJSON.skuPreSale.skus.indexOf(this.currentCatEntry)&&(i=!0),""===t.data().authenticatedOnlyAddToCart&&i?(this.authenticateOnlyEnabled=!0,this.changeAddButtonAuthenticationStatus(),this.isAuthenticated||(g(document).off("closed.zf.reveal.pdp.presale"),g(document).on("closed.zf.reveal.pdp.presale",this.authenticationModalClosed.bind(this)))):this.authenticateOnlyEnabled&&(this.authenticateOnlyEnabled=null,this.changeAddButtonAuthenticationStatus())},checkLoyaltyCookie:function(){this.isAuthenticated=!1;var t=a.getCookie(this.signInCookieName);t&&t===this.signInCookieValidValue&&(this.isAuthenticated=!0)},authenticationModalClosed:function(){this.checkLoyaltyCookie(),this.changeAddButtonAuthenticationStatus(),this.isAuthenticated&&(g(document).off("closed.zf.reveal.pdp.presale"),this.$addToCartButton.trigger("click"))},changeAddButtonAuthenticationStatus:function(){this.isAuthenticated||!this.authenticateOnlyEnabled?this.toggleSignInVisibility(!1):this.toggleSignInVisibility(!0)},toggleSignInVisibility:function(t){if(t){if(this.$addToCartButton.hide(),"R"===a.getUserType()){var i=this.$signInButton.data("authenticatedNonMemberUrl");null!=i&&0<i.length&&this.$signInButton.data("openAjax",i)}this.$signInButton.removeClass("hide"),g.pubsub("publish","WCS.PRODUCTFORM.EVENT.SIGNIN.VISIBILITY.CHANGE",{signInVisible:!0,wasHover:this.lastEventHover})}else this.$addToCartButton.show(),this.$signInButton.addClass("hide"),g.pubsub("publish","WCS.PRODUCTFORM.EVENT.SIGNIN.VISIBILITY.CHANGE",{signInVisible:!1,wasHover:this.lastEventHover})},initRedeemAGift:function(){if(0,C){var t=this.productForm.find(".add-to-bag-js"),i=t.data("get-this-gift-text"),e=s.getURLParam(window.location.href,"egc_url"),o=g([".find-store-js",".product-content-info-write-review-link",".product-content-info-see-product-details-link",".product-content-info-rating",".give-as-gift-link",".product-loyalty-member-container",".egift-link-tooltip"].join()),d=g(".product-gift-action-get-egift-card-js");o.addClass("hidden"),d.removeClass("hidden"),0<e.length&&g(".product-gift-action-get-egift-card-js").attr("href",decodeURIComponent(e)),t.removeClass("disabled btn-out-of-stock").text(i),g(".product-actions-primary").addClass("product-redeem-as-gift-container")}},unbindAddToCartEvents:function(){g.pubsub("unsubscribe",this.updateItemSelectionInStockEventToken),g.pubsub("unsubscribe",this.addToCartItemSelectionInStockEventToken),g.pubsub("unsubscribe",this.addToWishListMessaging),this.productForm.find(".add-to-bag-js").off("click",this.handleAddToBagClick),this.productForm.off("submit",this.handleAddToBagClick)},initAddToCartEvents:function(){var e=this;this.productForm.find(".add-to-bag-js").on("click",{self:this},s.debounce(function(t){e.handleAddToBagClick(t)},500,!0)),this.productForm.on("submit",{self:this},this.handleAddToBagClick),this.storeSelectionModalAddToCartEvent=g.pubsub("subscribe","vfdp.wcs.product_form.add_to_bag_from_store_selection",function(t,i){e.addToCartForPickUp=i.addToCartForPickup,e.selectedStore=i.selectedStore,e.productForm.find(".add-to-bag-js").trigger("click")})},handleAddToBagClick:function(t){var i=t.data.self,e=i.productForm.find(".add-to-bag-js"),o=(i.productForm.find(".out-of-stock"),i.isValidForm());if(t.preventDefault(),e.hasClass("notify-me-active"))d(["wcs.product-form-notify"],function(){i.productForm.closest(".product-content-form").NotifyMe(),g.pubsub("publish","WCS.PRODUCTFORM.EVENT.NOTIFYME.ACTIVE")});else if(e.hasClass("bfd-active"))g.pubsub("publish","WCS.PRODUCTFORM.EVENT.ONLINEDEALER.ACTIVE");else if(!e.hasClass("disabled")&&o){if(g("#uclw").length)return!0===i.selectChangeComplete&&g("#uclw").length&&g("#uclw").is(":visible")?(i.addToBag(t),void(i.selectChangeComplete=!1)):void setTimeout(function(){i.productForm.find(".add-to-bag-js").trigger("click")},100);i.addToBag(t)}},addToBag:function(i){var e=i.data.self,t=e.buildDataObjectForValidAddToBag(),o=r?"VFAjaxCustomOrderItemAdd":"VFAjaxOrderItemAdd";actionUrl=a.getContextRoot()+o,g.pubsub("publish","vfdp.wcs.product_form.add_to_cart_clicked"),WCS_CONFIG.get("global::useCustomLoadingNotification")&&setTimeout(function(){var t="undefined"!=typeof LOADING_INDICATOR_TEXTS?LOADING_INDICATOR_TEXTS.PROCESS:"";g(i.target).html('<div class="dot-wave" aria-live="assertive" aria-label="'+t+'"></div>'),g(i.target).trigger("focusout")},200),e.submitForm(t,actionUrl,function(t){WCS_CONFIG.get("global::useCustomLoadingNotification")?(g(i.target).html(g(i.target).data("addedToCartText")),setTimeout(function(){g(i.target).html(e.addToCartText),e.handleFormSubmitResponse(t)},1e3)):e.handleFormSubmitResponse(t)})},buildDataObjectForValidAddToBag:function(){var t=this,i={};!this.addToCartForPickUp&&"pick-up"!==this.stateManager.getProperty("deliveryOption")||(i.physicalStoreIdentifier=this.selectedStore||this.stateManager.getProperty("selectedStore"),this.addToCartForPickUp=!1,this.selectedStore=null),t.addToCartButton.data("department")&&(i.department=t.addToCartButton.data("department")),i.categoryId=t.categoryId,i.storeId=t.storeId,i.langId=t.langId,i.catalogId=t.catalogId,i.orderId=".",i.URL="/";var e=t.productForm.find("#crossSellCheckbox");return 0<e.length&&e.is(":checked")?(i.catEntryId_1=t.catEntryId,i.quantity_1=g.productFormUtil.getQuantity(t.productForm),i.catEntryId_2=e.val(),i.quantity_2="1"):(i.catEntryId=t.catEntryId,i.quantity=g.productFormUtil.getQuantity(t.productForm)),o=g(".product-content-form-customise-btn").data("unmadeEditorOptions"),(r=o?o.currentDesignId:null)&&(i.extRecipeId=r,i.action="add",i.mergeItems=!1,i.imageURL=o?o.imageUrl:null,i.recipeJson=o?o.recipeJson:null),i},handleFormSubmitResponse:function(t){if(0,t.orderId)if(C){var i={},e=this.productForm.data("gift-redemption"),o=this.productForm.find(".add-to-bag-js").data("apply-gift-card-url"),d=this.productForm.find(".add-to-bag-js").data("gift-success-url");e?(i.orderId=t.orderId[0],i.billingGiftCardNumber=e.egc.egc_number,i.billingGiftCardPIN=e.egc.access_code,b.showLoadingNotification("p"),g.ajax({type:"POST",url:o,data:i,dataType:"json"}).done(function(t){b.hideLoadingNotification(),t.errorMessage?(g.productFormUtil.displayErrorMessage(t.errorMessage,this.productForm),b.hideLoadingNotification()):window.location.href=d}).fail(function(t){g.productFormUtil.displayErrorMessage(t,this.productForm),b.hideLoadingNotification()})):g.productFormUtil.displayErrorMessage(LANG_MSG.ERR_INVALID_GIFT_CARD_INFO,this.productForm)}else{g.productFormUtil.clearAddTOCartErrorMessage(this.productForm),g.pubsub("publish","ORDER_ID_UPDATED",{orderId:t.orderId});var a=g(".product-form-js").index(this.productForm);g.pubsub("publish","vfdp.wcs.product_form.add_to_cart_succeeded",{productFormIndex:a});var s,n,r,c,u=this.productForm.parents(".bundle-product-info-js"),l=this.productForm.data("child-part-number"),h=this.productForm.data("bundle-part-number").toString(),p=this.productForm.data("product-part-number"),f=this.productForm.find("#crossSellCheckbox"),m=!!g("body").data("disableMiniCart");s=0<u.length?u.find(".product-info-js").data("catentry-name-dl"):g("#product-info .product-info-js:not(.hide)").data("catentry-name-dl"),n=0<f.length&&f.is(":checked")?t.catEntryId_1[0]:t.catEntryId[0],t.volume&&(r=t.volume||"0"),t.quantity&&(c=t.quantity||"0"),g.pubsub("publish","SHOPCART_UPDATED.add",{product:[{bundleId:h,itemId:l,catEntryId:n,name:s,productId:p,volume:r,quantity:c}],rewardEligibility:{orderId:t.orderId[0],rewardOptionEligible:t.rewardOptionEligible,rewardsAdded:t.rewardsAdded},action:"add",disableMiniCart:m})}else g.productFormUtil.displayErrorMessage(t.errorMessage,this.productForm),g.productFormUtil.setProductGridProductHeights()},addToWishList:function(t,i){var e,o,d=this;t.type&&(t.preventDefault(),t.currentTarget.blur()),d.checkAllAttributeSelection()&&(o=d.buildDataObjectForValidAddToWishList(),e=a.getContextRoot()+"VFAjaxInterestItemAdd",d.submitForm(o,e,function(t){d.handleWishListAddResponse(t,i)}))},addToWishListMessaging:function(t){g.pubsub("subscribe","vfdp.wcs.product_form.add_to_wishlist_message",function(t,i){if(g(".add-to-wishlist-js").attr("data-changed-add-to-wishlist-text")){var e=i.formAction,o=g(".add-to-wishlist-js").attr("data-changed-add-to-wishlist-text"),d=g(".add-to-wishlist-js").attr("data-default-add-to-wishlist-text");"success"===e?(g(".add-to-wishlist-js .wishlist-button-text").text(o),g(".add-to-wishlist-js .icon-check").removeClass("hide"),g(".add-to-wishlist-js").addClass("success")):(g(".add-to-wishlist-js .wishlist-button-text").text(d),g(".add-to-wishlist-js .icon-check").addClass("hide"),g(".add-to-wishlist-js").removeClass("success"))}})},buildDataObjectForValidAddToWishList:function(){var t=this,i={};return(i={}).storeId=t.storeId,i.langId=t.langId,i.catalogId=t.catalogId,i.catEntryId=t.catEntryId,i.quantity=g.productFormUtil.isValidQuantity(t.productForm)?g.productFormUtil.getQuantity(t.productForm):1,i.listId=".",i.URL="/",o=g(".product-content-form-customise-btn").data("unmadeEditorOptions"),(r=o?o.currentDesignId:null)&&(i.extRecipeId=r,i.imageURL=o?o.imageUrl:null,i.recipeJson=o?o.recipeJson:null,i.listIdName=o?o.listIdName:null),i},initAddToWishListClass:function(){var t=this.productForm.find(".product-actions-primary");0<t.find(".add-to-wishlist-js").length&&t.addClass("add-to-wishlist-enabled")},initGlobalEvent:function(){var e=this;e.formUpdateEvent||(e.formUpdateEvent=g.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.FORM_UPDATE",function(t,i){e.productForm=i.updatedForm,e.initAddToCart()}))},addToWishListIconHandle:function(){var t=g(".add-to-wishlist-js");if(t.addClass("add-wishlist-filled"),t.data("useAnimation")){var i=t.find(".icon-wishlist");i.removeClass("icon-wishlist").addClass("icon-favorite-filled"),i.addClass("favorites-icon-filled-animated"),setTimeout(function(){i.removeClass("favorites-icon-filled-animated")},700)}},handleWishListAddResponse:function(t,i){if(0,t.listId){0<g(".wishlist-js").length&&g(".wishlist-js").trigger("click");var e=g(".product-form-js").index(this.productForm),o=g("#product-info .product-info-js:not(.hide)").data();g.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_succeeded",{productFormIndex:e,productName:o.catentryNameDl});var d=n.getProductDataTracking(),a=n.getProductData(this.productForm,t);g.pubsub("publish","WISHLIST_UPDATED.add",g.extend(!0,a,d,i)),g.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_message",{formAction:"success"}),this.addToWishListIconHandle()}else g.productFormUtil.displayErrorMessage(t.errorMessage,this.productForm)}},g.extend(l.prototype,i.prototype),g.fn.AddToCartForm=function(i){return this.each(function(){var t=g(this).data(c);t||(t=new l(this,i).initAddToCart(),g(this).data(c,t))})}});
//# sourceMappingURL=../../../../maps/js/wcs/view/product-form/product-form-add-to-cart.hash-e685a3645b91cc33b22203b52d7210ff.js.map