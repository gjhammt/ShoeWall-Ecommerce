define(["require","jquery","shared.main.screen","wcs.context"],function(o,h,d,a){var r,f={},l={reRenderMediaGalleryUrl:"VFAjaxMediaGalleryView?requestype=ajax",positionIndicatorOffset:10};function s(e){var i=h(e.target.parentElement.parentElement).data("imageIndex");r.loadViewer(i,!0),r.showViewer()}function m(){r&&!r.isLoaded&&r.initViewer(0,function(e){e||(r.unloadViewer(),r.hideViewer())}.bind(f))}function c(){h(".mol-media-gallery__cell__overlay").each(function(e,i){var t,n,o,a=h(i),r=a.data("previewImageUri");i.style.backgroundImage="url('"+r+"')",t=r,n=new h.Deferred,(o=new Image).onload=function(){n.resolve({width:o.width,height:o.height})},o.onerror=function(){n.reject(new Error("Image failed to load"))},o.src=t,n.promise().then(function(e){a.data({width:e.width,height:e.height})})})}function p(e){if(!f.ignoreNextMoveOut){var i=h(e.currentTarget).find(".mol-media-gallery__cell__overlay");i.removeClass("mol-media-gallery__cell__overlay__animation__show"),i.addClass("mol-media-gallery__cell__overlay__animation__hide")}}function g(e){var i=h(e.currentTarget),t=i.find(".mol-media-gallery__cell__overlay"),n=t[0],o=i.width(),a=i.height(),r=t.data("width"),l=t.data("height");if(r&&l){var s=u(e.offsetX,o,r),c=u(e.offsetY,a,l);n.style.backgroundPosition=s+"px "+c+"px"}m(),n.style.minHeight&&""!==n.style.minHeight||(n.style.minHeight=a+"px",n.style.height=a+"px",n.style.width=o+"px"),f.ignoreNextMoveOut="none"===n.style.display,r&&l&&(t.addClass("mol-media-gallery__cell__overlay__animation__show"),t.removeClass("mol-media-gallery__cell__overlay__animation__hide"))}function u(e,i,t){return e/i*(i-t)}function t(e,i,t){var n=h(e.currentTarget),o=void 0!==i?i:n.index();if(f.$images.length>=o){var a=h(f.$images[o]),r=a.offset().top;t?r+=a.height():r-=f.$topNav.height()+f.$topNavPromo.height(),f.$body.animate({scrollTop:r},"slow")}}function $(){if(f.$images=f.selector.find(".mol-media-gallery__cell"),f.$dotContainer=h(".mol-position-indicator-container"),f.$dots=f.$dotContainer.find(".mol-position-indicator-item"),f.$topNav=h("header.topnav-header"),f.$topNavPromo=h(".topnav-promobar-container"),f.$body=h("body, html"),f.$dots.on("click",t.bind(f)),f.$navigationButton=h(".mol-scroll-navigation-button"),0<f.$navigationButton.length){f.$navigationLabel=f.$navigationButton.find("span").first(),f.$navigationIcon=f.$navigationButton.find(".mol-scroll-navigation-button--icon");var e=f.$navigationLabel.data();f.topLabel=e.topLabel,f.bottomLabel=e.bottomLabel}f.$navigationButton.on("click",function(e){var i=f.isBottom?0:f.$images.length-1;t(e,i,!f.isBottom)}.bind(f))}function y(e,i){var t=h(window).scrollTop(),n=h(window).height(),o=t+n,a=f.$topNav.height()?f.$topNav.height():0,r=f.selector.offset().top+f.selector.height(),l=f.$dotContainer.height(),s=f.selector.offset().top,c=f.selector.offset().left-f.config.positionIndicatorOffset,d=(n-(s+a))/2-l/2;f.$dotContainer.css("position","fixed"),f.$dotContainer.css("margin-top",d+"px"),f.$dotContainer.css("left",c+"px");for(var m,p=0,g=0;g<f.$images.length;g++){if(0<h(f.$images[g]).offset().top+f.$topNav.height()+f.$topNavPromo.height()-t){p=g;break}}if(f.$dots.removeClass("active"),h(f.$dots[p]).addClass("active"),r<o?(e||f.$dotContainer.fadeOut(),f.isBottom=!0):(f.$dotContainer.fadeIn(),f.isBottom=!1),m=f.isBottom,f.$navigationIcon&&f.$navigationIcon.length&&(m?(f.$navigationIcon.addClass("mol-scroll-navigation-button--icon--bottom"),f.$navigationLabel.html(f.bottomLabel)):(f.$navigationIcon.removeClass("mol-scroll-navigation-button--icon--bottom"),f.$navigationLabel.html(f.topLabel))),i){var u=f.initialMediaHeight||f.$mediaGalleryWrapper.height(),$=h(".mol-media-gallery__row").length||1;f.$productViewContainer.css("min-height",$*u)}}function v(){f.$stickyInner.css("position","unset"),f.sticky.unloadSideBar()}function b(e){f.sticky&&(f.stickyHeight<f.mainBodyHeight?(f.sticky.initSideBar(null,e),f.$parentWrapper.removeClass("no-sticky")):(f.$parentWrapper.addClass("no-sticky"),f.sticky.unloadSideBar()))}function w(){return f.$mainPanelWrapper&&0<f.$mainPanelWrapper.find(".section-1").length}function _(e){f.selector=h(".mol-media-gallery"),f.config=h.extend({},l,f.selector.data("mediaGallery")),f.imagesSelector=h(".mol-media-gallery__cell.mol-media-gallery-image-container",f.selector),f.zoomInButton=h(".mol-media-gallery__zoom-icon",f.selector);var i=h(".mol-lazy-platform-viewer");if(0!==i.length){f.reRenderUrl=a.getURLWithContextRoot(f.config.reRenderMediaGalleryUrl),r=i.first().molLazyPlatformViewer().data().molLazyPlatformViewer,f.subScription||(f.subScription=h.pubsub("subscribe","product-form.attr.swatch.click",function(e,i){var t=h(i.target).data(),n=h(".attr-color-js"),o=t.productId?o=t.productId:n.first().data("productId"),a=h("meta[name=storeId]").attr("content"),r=h("meta[name=langId]").attr("content"),l=t.unisex,s=t.unisexDepartment||"",c={partNumber:t.partNumber,productId:o,color_identifier:t.variationId,storeId:a,langId:r,isUnisex:l,unisexDepartment:s};h.ajax({url:this.reRenderUrl,data:c}).done(function(e){if("small"===d.size()){var i=h(e).filter(".mol-media-gallery")[0],t=h(e).filter(".mol-position-indicator-container")[0];t&&f.$dotContainer.replaceWith(t),f.selector.replaceWith(i)}else f.initialMediaHeight=f.$mediaGalleryWrapper.height(),f.$mediaGalleryContainer.empty(),f.$mediaGalleryContainer.html(e);_(!0)}.bind(this)).fail(function(e){console.error(e)})}.bind(f))),f.$selectionDetails=h(".section-2, .section-3, .section-reviews"),f.$mainPanelWrapper=h(".main-panel-wrapper"),f.$parentWrapper=h(".media-gallery-enabled"),f.$mediaGalleryContainer=h("#product-imgs"),f.$spinViewerContainer=h("[data-spin-container]"),f.isSpinViewerPresent=0<f.$spinViewerContainer.length,f.$contentBanner=h(".mol-media-gallery__cell__content__banner"),f.$lastGalleryContainer=h(".mol-media-gallery-image-container:last"),f.$molVideoPlayPause=h(".mol-video-player-play-pause-on-click"),f.$productViewContainer=h(".product-views-container"),f.$mediaGalleryWrapper=h(".mol-media-gallery-image-wrapper"),f.$sectionReviews=h(".section-reviews");for(var t=1;t<=4;t++)f["$section"+t]=h(".section-"+t);var n=f.$sectionReviews.eq(0).siblings().is(f.$section2);"small"===d.size()?(m(),r.loadViewer(0),r.showViewer(),f.sticky&&f.sticky.unloadSideBar(),f.$selectionDetails.removeClass("attached-to-sticky"),f.$stickySelector&&0<f.$stickySelector.find(".section-2").length&&(n&&f.$sectionReviews.hasClass("section-top")&&h(f.$sectionReviews).insertAfter(f.$stickySelector),h(f.$section2).insertAfter(f.$stickySelector),n&&!f.$sectionReviews.hasClass("section-top")&&h(f.$sectionReviews).insertAfter(f.$stickySelector),h(f.$section3).insertAfter(f.$stickySelector)),w()&&(h(f.$section1).insertAfter(f.$mainPanelWrapper),h(f.$section4).insertAfter(f.$section3)),f.isSpinViewerPresent&&f.isSpinInitialized&&(r.restoreContainer(f.selector),f.isSpinInitialized=!1),f.$contentBanner&&0<f.$contentBanner.length&&0<f.selector.find(".mol-media-gallery__cell__content__banner").length&&f.$contentBanner.prependTo(f.$section4)):(f.config.listViewEnabled?($(),f.isSpinViewerPresent&&!f.isSpinInitialized&&(r.moveToContainer(f.$spinViewerContainer),f.isSpinInitialized=!0)):(f.imagesSelector.on("mousemove",g.bind(f)),f.imagesSelector.on("mouseout",p.bind(f)),f.config.fullScreenEnabled&&f.imagesSelector.on("click",s.bind(f)),f.zoomInButton.on("click",s.bind(f))),r&&r.hideViewer(),f.$stickySelector=h(".mol-sticky-sidebar"),f.sticky=0<f.$stickySelector.length?f.$stickySelector.first().molStickySidebar().data().molStickySidebar:null,f.$stickyInner=h(".mol-sticky-inner-sidebar"),f.$selectionDetails.addClass("attached-to-sticky"),f.$sectionReviews.hasClass("section-top")?h([f.$sectionReviews[0],f.$section2[0],f.$section3[0]]).appendTo(f.$stickyInner):(h([f.$section2[0],f.$section3[0]]).appendTo(f.$stickyInner),n&&f.$section2.after(f.$sectionReviews.eq(0))),w()||f.$section1.height()<I()&&h([f.$section1[0],f.$section4[0]]).appendTo(f.$mainPanelWrapper),WCS_CONFIG.get("PDP::pdpDeliveryInformationOpenAccordion")||h(".delivery-information, .find-store-js").on("click",v.bind(f)),h(document).on("open.fndtn.reveal","[data-reveal]",v.bind(f)),h(document).on("closed.fndtn.reveal","[data-reveal]",function(){b()}),f.$contentBanner&&0<f.$contentBanner.length&&0<f.$section4.find(".mol-media-gallery__cell__content__banner").length&&f.$contentBanner.prependTo(f.$lastGalleryContainer),f.subProductView||(f.subProductView=h.pubsub("subscribe","vfdp.wcs.product_reviews.loaded",k.bind(f))),f.subAccordionChange||(f.subAccordionChange=h.pubsub("subscribe","vfdp.wcs.mol-accordion.change",function(){f.config.listViewEnabled?b(!0):f.sticky.checkForManualResize()&&(k(),f.sticky.recalculateProperBottom())}.bind(f))),0<f.$molVideoPlayPause.length&&f.$molVideoPlayPause.on("click",function(e){var i=e.currentTarget;e.preventDefault(),e.stopPropagation(),i.paused?i.play():i.pause()}.bind(f)),f.config.isVideoPresent&&!f.config.useNativeVideo&&o(["videojs"]),k(),h.pubsub("subscribe","window.scroll",function(e,i){I()===f.stickyHeight&&C()===f.mainBodyHeight||k(),f.config.listViewEnabled&&"small"!==d.size()&&y()}),f.config.listViewEnabled?y(e,!0):c()),f.accordionsInitialized||(f.$reviewAccordionHeader=h(".accordion-power-review > .mol-accordion__header"),f.$mainReviewHeader=h("#pr-container .rating-reviews-loader h3"),h(f.$mainReviewHeader).prependTo(f.$reviewAccordionHeader),f.$drawerTitle=h(".product-details-drawer>.title"),h(".accordion-espot > .mol-accordion__header > span").first().text(f.$drawerTitle.text()),f.$drawerTitle.text(""),f.accordionsInitialized=!0),h(".find-store-js").length||h(".product-content-form-product-actions-primary").addClass("full-width"),h.pubsub("publish","vfdp.mol-media-gallery.LOADED")}}function k(){f.mainBodyHeight=C(),f.stickyHeight=I(),f.$stickyInner.css("min-height",f.stickyHeight+"px"),b()}function C(){return Math.ceil(f.$section1.outerHeight(!0)+f.$section4.outerHeight(!0))}function I(){var e=0;return 0<h(".mol-sticky-sidebar .section-reviews").length&&(e=h(".mol-sticky-sidebar .section-reviews").outerHeight(!0)),Math.ceil(f.$section2.outerHeight(!0)+f.$section3.outerHeight()+e)}return _(),h.pubsub("subscribe","window.resize.breakpoint",function(){_()}),{init:_,moveOutImage:p,moveOverImage:g,_hideElement:function(e){e.style.display="none"},_showElement:function(e){e.style.display="inline-block"},config:f.config,_calculateBackgroundPosition:u,_setupDotScroller:$,self:f}});
//# sourceMappingURL=../../../maps/js/shared/molecules/mol-media-gallery.hash-f4b46bf8868786fcef6447a7199952ea.js.map