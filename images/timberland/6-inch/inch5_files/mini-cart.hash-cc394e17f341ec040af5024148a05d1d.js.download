define(["require","jquery","shared.main.screen","wcs.mini-list","wcs.mobile-panel","wcs.context","wcs.alert","handlebars-loader","promise!wcs.lang-msg","pubsub","promise!wcs.zmetrics"],function(n,l,a,c,e,d,t,i){function s(t,i){this.element=t,this.$element=l(t),this.options=i,this.metadata=l(this.element).data("minicart-options")}var o="minicart";s.defaults=(s.prototype={defaults:{wishlistPanel:"#wishlist-notification-panel",topnav:".topnav-header",topnavWrapper:"div.topnav",cartWishlistPanel:".global-cart-wishlist-panels-js, .topnav-minicart-panel",cmsTopNavMiniCart:".topnav-minicart",rightMiniCartPanel:".mini-cart-section.l-right",minicartMessage:{template:"html.mini-cart.messaging",cartPanelNotification:".global-cart-wishlist-panels-js .notification, .topnav-minicart-panel .notification",wishlistPanelNotification:"#wishlist-notification-panel .notification",loadParameters:{target:".global-cart-wishlist-panels-js .notification, .topnav-minicart-panel .notification",pluginFN:"minicartMessage",requireModule:"minicart-message"}}},init:function(){this.config=l.extend({},this.defaults,this.options,this.metadata);var t=this;if(t.isCMSTopNav=t.element===l(t.config.topnavWrapper)[0],t._miniCartLocation=WCS_CONFIG.get("global::miniCartLocation"),t.autoHideTime=parseInt(WCS_CONFIG.get("global::miniCartAutoHideTime")),t.mobileShowAsModal=WCS_CONFIG.get("global::miniCartMobileShowAsModal"),t.mobileApplePayButtonEnabled=WCS_CONFIG.get("applePay::applePayPDPMobileCTAEnabled"),t.overlayVisible=!1,t.manuallyClosed=!1,t.disableMiniCart=!!l("body").data("disableMiniCart")&&l("body").data("disableMiniCart"),t.isSmallScreen=function(){return"small"===a.size()},t.notificationTimer="",t._build(),t.isTopMiniCart="top"===t._miniCartLocation||t.isCMSTopNav,t.$globalCartWishlistPanels=l(t.config.cartWishlistPanel),t.$miniCartPanels=l("#global-cart-wishlist-panels, .topnav-minicart-panel"),new i(t.config.minicartMessage),l(document).on("click",".continue-shopping-link",function(){l("#global-cart-wishlist-panels").addClass("hide")}),0===l(".shopcart-js").length)return t.isTopMiniCart?n(["wcs.top-panel"],function(){t.initializeMinicartComponents(),t.updateContentEvents(),t.disableMiniCart||t.minicartUpdateShopcartEvents()}):(t.initializeMinicartComponents(),t.updateContentEvents(),t.disableMiniCart||t.minicartUpdateShopcartEvents()),t.events(),t},events:function(){l("body").on("click",this,this.miniCartGlobalClickHandler)},initializeMinicartComponents:function(){var i=this;i.isSmallScreen()?e.init():i.isTopMiniCart||n(["wcs.right-panel"],function(t){i.$globalCartWishlistPanels.rightPanels()})},showMinicartPanel:function(){var t=this;t.isSmallScreen()?(t.toggleOverlay(),t.$globalCartWishlistPanels.find(".notification").removeClass("hide"),t.$globalCartWishlistPanels.removeClass("hide"),t.isTopMiniCart||t.$globalCartWishlistPanels.show(),l("html,body").animate({scrollTop:0},"fast"),l.pubsub("publish","vfdp.wcs.minicart.mobile_notification_panel_opened")):(t.isTopMiniCart||t.$globalCartWishlistPanels.show(),t.$globalCartWishlistPanels.removeClass("hide"))},hideMinicartPanel:function(){var t=this;t.isSmallScreen()?(t.$globalCartWishlistPanels.find(".notification").addClass("hide"),t.isTopMiniCart?t.$globalCartWishlistPanels.addClass("hide"):t.$globalCartWishlistPanels.fadeOut(),t.toggleOverlay()):(t.isTopMiniCart||t.$globalCartWishlistPanels.hide(),t.$globalCartWishlistPanels.addClass("hide"))},getProductName:function(t){var i=this;return t=t||{},Array.isArray(t.product)?t.product[0].name:"object"==typeof t.product&&"string"==typeof t.product.name?t.product.name:0<l("body.wishlist, body.wishlist-shared").length?i._getProductNameFromWishlistPage(t):0<l(".product-form-js").length?i._getProductNameFromProductForm():0<l(".custom-order-item-form-js").length?i._getProductNameFromDYOForm():void 0},_getProductNameFromWishlistPage:function(t){if(t&&t.productName)return t.productName},_getProductNameFromProductForm:function(){return l(".product-form-js .attr-box.selected .color-swatch-button-content").attr("data-product-name")},_getProductNameFromDYOForm:function(){var t=l(".custom-order-item-form-js").data("product-name");return t.length<=0&&0<l(".breadcrumb-product-name").length&&(t=l(".breadcrumb-product-name").text()),t},minicartUpdateShopcartEvents:function(){var a=this;l.pubsub("subscribe","SHOPCART_UPDATED",function(t,i){i=i||{};a.getProductName(i);if(a.isSmallScreen()){if(!e.shopcartUpdateCheck)return}else if("delete"===i.action)return void a.showRemoveItemMessage();a.isSmallScreen()&&(a.manuallyClosed=!1,clearTimeout(a.notificationTimer),a.showMinicartPanel(),l(a.$globalCartWishlistPanels).one("click",".mini-cart-icon-close-js",function(){a.isTopMiniCart?a.$globalCartWishlistPanels.addClass("hide"):a.$globalCartWishlistPanels.fadeOut(),a.toggleOverlay(!0)}),a.notificationTimer=setTimeout(function(){a.hideMinicartPanel()},a.autoHideTime))})},updateContentEvents:function(){var e=this;l.pubsub("subscribe","WISHLIST_UPDATED",function(t,i){"delete"===i?e.showRemoveItemMessage():e.isSmallScreen()&&(l(".notification",e.config.wishlistPanel),clearTimeout(e.notificationTimer),l(e.config.wishlistPanel).show())}),l.pubsub("subscribe","MINICART_CONTENT_RENDER_COMPLETE",function(t,i){var a=l(".reveal",e.$miniCartPanels);0<l("*[data-open]",e.$miniCartPanels).length&&a.each(function(t,i){var a=l(i);l("body > #"+a.attr("id")).length<=0&&l("body").append(a)}),l(".share-cart-js",e.$miniCartPanels).on("click",function(){l(".tags .active",e.$miniCartPanels).trigger("click")}),WCS_CONFIG.get("global::miniCartVisaCheckoutEnabled")&&l.pubsub("publish","VISA_CHECKOUT_CONTENT_READY"),0<l(".email-me-my-cart-form-container-js").length&&n(["wcs.email-me-my-cart"],function(){l(".email-me-my-cart-form-container-js").emailMeMyCart()}),0<l(".apple-pay-button").length&&n(["wcs.applepay-button"],function(){l(".apple-pay-button").applePay()})}),0<l(".email-me-my-cart-form-js").length&&e.isSmallScreen()&&l.pubsub("subscribe","ORDER_ID_UPDATED",function(t,i){l('.email-me-my-cart-email-only-form.email-me-my-cart-form-js input[name="orderId"]').val(i.orderId)}),l.pubsub("subscribe","EMAIL_ME_MY_CART_ACTION",function(){clearTimeout(e.notificationTimer)}),l.pubsub("subscribe","EMAIL_ME_MY_CART_FINISHED",function(){e.$globalCartWishlistPanels.find(".notification");autoHideTimer=setTimeout(function(){e.hideMinicartPanel()},e.autoHideTime)}),l.pubsub("subscribe","vfdp.wcs.free_gift.offer_loading",function(){l(".cart-js.mini-cart-tag-shopcart.active").trigger("click")}),l.pubsub("subscribe","vfdp.wcs.product_form.add_to_cart_succeeded",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&l(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")}),l.pubsub("subscribe","vfdp.wcs.wishlist.add_to_cart_succeeded",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&l(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")}),l.pubsub("subscribe","vfdp.wcs.free_gift.offer_complete",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&l(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")})},showRemoveItemMessage:function(){var t=this,i=t.$globalCartWishlistPanels.find(".notification");"small"!==a.size()&&l(".minicart-sr-text-js").remove(),t.isTopMiniCart?(clearTimeout(t.notificationTimer),i.removeClass("hide")):i.addClass("show-for-sr").removeClass("hide")},toggleOverlay:function(t){l("#global-body-overlay").length<1&&l("header").append('<div id="global-body-overlay" title="Click to close"></div>');var i=this,a=l("#global-body-overlay");(i.mobileShowAsModal||i.isCMSTopNav)&&(i.manuallyClosed||(i.overlayVisible?a.fadeOut(500).delay(500).css({width:"0%"}):a.hide().css({width:"100%"}).fadeIn(500),t&&(i.manuallyClosed=!0),i.overlayVisible=!i.overlayVisible))},miniCartGlobalClickHandler:function(t){var i,a,e,n=t.data;if($target=l(t.target),"right"===n._miniCartLocation&&$target.hasClass("cart-js")&&$target.hasClass("active-js")||$target.parents().hasClass("cart-js")&&$target.parents().hasClass("active-js"))i=ACTION_URLS.MINI_SHOPPING_URL,a={storeId:d.getStoreId(),langId:d.getLangId(),catalogId:d.getCatalogId()},e={title:LANG_MSG["DEAFULT_MINICART.SHOPPING.title"],page:"shopcart",container:l(".global-cart-wishlist-panels-js .shopcart.cart-list")},c.renderMiniListItems(i,a,e);else if($target.hasClass("wishlist-js")&&$target.hasClass("active-js")||$target.parents().hasClass("wishlist-js")&&$target.parents().hasClass("active-js"))i=ACTION_URLS.MINI_WISHLIST_URL,a={storeId:d.getStoreId(),langId:d.getLangId()},e={title:LANG_MSG["DEAFULT_MINICART.WISHLIST.title"],page:"wishlist",container:l(".global-cart-wishlist-panels-js .wishlist.cart-list")},c.renderMiniListItems(i,a,e);else if(0<$target.parents(".remove-item-js").length){var s=$target.parents(".cart-item-js").find(".cart-item-row"),o="";s.find(".item-attr-js").each(function(){o+=(0<o.length?" / ":"")+l(this).text()});var r={currency:WCS_CONFIG.get("global::currencyCode"),productName:s.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:s.find(".product-info-js").data("partNumber"),itemId:s.find(".product-info-js").data("itemPartnumber"),bundleId:s.find(".product-info-js").data("bundlePartnumber"),styleCode:s.find(".product-info-js").data("styleCode"),colorCode:s.find(".item-attr-info-js").data("colorCode"),colorDescription:s.find(".item-attr-info-js").data("colorDescription"),size:s.find(".item-attr-info-js").data("size"),unitPrice:s.find(".item-price-js").data("unitPrice"),definingAttributes:l.trim(o),quantity:s.find(".item-qty-js").data("qty"),isProductRemoval:!0};zm.trackRemovedItem(r)}},_build:function(){var t=this;t.isCMSTopNav&&(l(t.config.rightMiniCartPanel).remove(),t._miniCartLocation="top",0===l(t.config.cmsTopNavMiniCart).length&&l(t.config.topnav).append('<section class="topnav-minicart"><div class="topnav-minicart-panel hide"><div class="topnav-minicart-notification notification hide"></div><div class="topnav-minicart-content content"><article class="topnav-minicart-content-container shopcart cart-list" data-tabcontent="shopcart"></article></div></div></section>'))}}).defaults,l.fn.minicart=function(i){return this.each(function(){var t=l(this).data(o);t||(t=new s(this,i).init(),l(this).data(o,t))})}});
//# sourceMappingURL=../../../maps/js/wcs/view/mini-cart.hash-ef4b3389599b73b17c3d393680c03220.js.map