define(["jquery","pubsub","wcs.alert","promise!wcs.zmetrics","datalayer.wcs.mini-list","coremetrics.wcs.mini-list","promise!wcs.lang-msg"],function(N,t,e){var c=!1,m=!1,n=!1,u=0,f=0,H=WCS_CONFIG.get("global::miniCartLocation"),o=0<N(".topnav-header").length||"top"===H;function M(){o?e.showLoadingNotification("p"):"right"===H&&e.showLoadingNotificationByPosition("l",".global-cart-wishlist-panels-js")}function P(){o?e.hideLoadingNotification():"right"===H&&e.hideLoadingNotificationByPosition(".global-cart-wishlist-panels-js")}function r(t,e){var i=t||LANG_MSG.GENERIC_ERROR_MESSAGE;e.container.html('<div class="message error text-center columns">'+i+"</div>")}function i(t){var e,i,a,n,r,s=N(t.target);if("delete"===s.data("action")||"add to cart"===s.data("action")){t.preventDefault();var o=s.parents(".cart-list"),c={title:o.find(".page-title").text(),page:o.data("tabcontent"),container:o},d="add to cart"===s.data("action")?LANG_MSG["DEFAULT_MINICART.MSG.movedToShoppingCart"]:void 0,l=s.parents(".cart-item-js").find(".cart-item-row"),m="";l.find(".item-attr-js.defining").each(function(){m+=(0<m.length?" / ":"")+N(this).text()});var u=l.find(".product-info-js").data("seoCategory"),f=l.find(".product-info-js").data("bundlePartnumber"),h=l.find(".product-info-js").data("itemPartnumber"),p=l.find(".product-info-js").data("masterCategory"),g=l.find(".product-info-js").data("parentProductId"),v=l.find(".product-info-js").data("childProductId"),b=l.find(".product-info-js").data("partNumber"),C=l.find(".product-info-js").data("styleCode"),j=l.find(".item-attr-info-js").data("colorCode"),I=l.find(".item-attr-info-js").data("colorDescription"),y=l.find(".item-attr-info-js").data("size"),w=l.find(".item-price-js").data("unitPrice"),x={currency:WCS_CONFIG.get("global::currencyCode"),productName:l.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:b||"",unitPrice:w||"",definingAttributes:N.trim(m),quantity:l.find(".item-qty-js").data("qty"),categoryId:"",masterCategoryId:p||"",childPartNumber:h||"",parentProductId:g||"",childProductId:v||"",bundlePartNumber:f||"",seoCategory:u||"",isQuickView:!1,isSearch:!1,styleCode:C||"",colorCode:j||"",colorDescription:I||"",size:y||""};e=s.attr("href"),i=c,a=d,n=s.data("action"),r=x,n=n||"remove",M(),N.ajax({url:e,type:"POST",dataType:"html",success:function(t){"wishlist"===i.page?(E(t,i,a,n),N.pubsub("publish","WISHLIST_UPDATED.remove",data={product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}]}),"add to cart"===n&&(0<N(".shopcart-js").length&&(window.location.href=N(".btn-shoppingbag-js").attr("href")),orderId&&N.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_succeeded",r))):"shopcart"===i.page&&"delete"===n&&orderId&&"right"===H&&E(t,i,a,n);var e="delete"==n||"remove"==n?"remove":"add";N.pubsub("publish","SHOPCART_UPDATED."+e,{product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}],rewardEligibility:{orderId:orderId,rewardOptionEligible:rewardOptionEligible,rewardsAdded:rewardsAdded},action:n})}}).always(function(t){P()}),"add to cart"===s.data("action")&&(N.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_clicked"),zm.trackAddedItem(x))}}function E(t,e,i,a){function o(t){var e=t.css("top")||"auto";return"auto"==e&&(e="0px"),parseFloat(e.replace(/[^-\d\.]/g,""))}function n(t){var e=N(t.target);if(e.hasClass("cart-item-container-js")||0<e.parents(".cart-item-container-js").length){var i=-t.originalEvent.deltaY,a=Math.max(-1,Math.min(1,i));return a<0?l.container.find(".cart-item-nav.next").hasClass("hide")||l.container.find(".cart-item-nav.next").hasClass("disabled")||l.container.find(".cart-item-nav.next").trigger("click"):0<a&&(l.container.find(".cart-item-nav.prev").hasClass("hide")||l.container.find(".cart-item-nav.prev").hasClass("disabled")||l.container.find(".cart-item-nav.prev").trigger("click")),!1}return!0}var l;e.container.html(t),"add to cart"===a&&e.container.find(".ajax-messaging").html('<p class="message success">'+i+"</p>"),s(l=e),l.container.find(".cart-item-nav.prev").on("click",function(){if(!N(this).hasClass("ready"))return!1;if(N(this).hasClass("disabled"))return!1;var t=o(N(this).closest(".cart-list").find(".cart-item-slide-js")),e=N(this).closest(".cart-list").find(".cart-item").outerHeight(!0);N(this).removeClass("ready"),N(this).closest(".cart-list").find(".cart-item-nav.next").removeClass("disabled"),N(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"+="+Math.min(-t,e)},300,function(){N(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("ready"),0<=o(N(this).closest(".cart-list").find(".cart-item-slide-js"))&&N(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("disabled")})}).on("keydown",function(t){32!==t.keyCode&&13!==t.keyCode||(t.preventDefault(),N(this).click())}),l.container.find(".cart-item-nav.next").on("click",function(){if(!N(this).hasClass("ready"))return!1;var t,e=l.container.find(".cart-item-slide-js").outerHeight(!1),i=l.container.find(".cart-item-container-js").outerHeight(!0),a=o(N(this).closest(".cart-list").find(".cart-item-slide-js")),n=N(this).closest(".cart-list").find(".cart-item-js").outerHeight(!0);if(e+parseInt(a)<=i)return!1;newTop=e+parseInt(a)-n,t=newTop<=i?n-(i-newTop):n,N(this).removeClass("ready"),N(this).closest(".cart-list").find(".cart-item-nav.prev").removeClass("disabled"),N(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"-="+t},300,function(){N(this).closest(".cart-list").find(".cart-item-nav.next").addClass("ready");var t=l.container.find(".cart-item-slide-js").outerHeight(!0),e=l.container.find(".cart-item-container-js").outerHeight(!0),i=o(N(this).closest(".cart-list").find(".cart-item-slide-js"));t+parseInt(i)<=e&&N(this).closest(".cart-list").find(".cart-item-nav.next").addClass("disabled")})}).on("keydown",function(t){32!==t.keyCode&&13!==t.keyCode||(t.preventDefault(),N(this).click())}),l.container.find(".cart-item-container-js").on({wheel:n,touchstart:function(t){var e=N(this).closest(".cart-list").find(".cart-item-slide-js");e.stop(),c=!0,u=t.originalEvent.touches[0].clientY,f=o(e)},touchmove:function(t){m=!0,t.preventDefault();var e=N(this).closest(".cart-list").find(".cart-item-slide-js"),i=N(this).closest(".cart-list").find(".cart-item-container-js"),a=e.outerHeight(!0),n=i.outerHeight(!0),r=t.originalEvent.touches[0].clientY-u,s=f+r,o=Math.min(0,n-a),c=l.container.find(".cart-item-nav.prev"),d=l.container.find(".cart-item-nav.next");s<0&&o<s?(e.css("top",s+"px"),c.hasClass("disabled")&&c.removeClass("disabled"),d.hasClass("disabled")&&d.removeClass("disabled")):0<=s?(e.css("top",s/2+"px"),c.hasClass("disabled")||c.addClass("disabled")):s<=o&&(e.css("top",s/2+o/2+"px"),d.hasClass("disabled")||d.addClass("disabled"))},touchend:function(t){if(c&&m){var e=N(this).closest(".cart-list").find(".cart-item-slide-js"),i=N(this).closest(".cart-list").find(".cart-item-container-js"),a=e.outerHeight(!0),n=i.outerHeight(!0),r=n-a,s=o(e);0<s||0<n-a?e.animate({top:"0px"},400):s<n-a&&e.animate({top:r+"px"},400)}m=c=!1,u=t.originalEvent.changedTouches[0].clientY}}),l.container.on({touchmove:function(t){t.preventDefault()}}),N(document).on("mousewheel",n),N(window).on("resize",function(){s(l);var t=l.container.find(".cart-item-slide-js").outerHeight(!0),e=d(l),i=o(l.container.find(".cart-item-slide-js"));t+parseInt(i)<e-50?l.container.find(".cart-item-nav.next").addClass("disabled"):l.container.find(".cart-item-nav.next").removeClass("disabled")}),N.pubsub("publish","MINICART_CONTENT_RENDER_COMPLETE",i)}function d(t){var e=t.container.height(),i=0,a=t.container.find(".content-head"),n=parseInt(a.css("margin-top"),10),r=parseInt(a.css("margin-bottom"),10),s=a.find(".section-title"),o=parseInt(s.css("margin-top"),10),c=s.outerHeight(!1),d=a.find(".page-title"),l=parseInt(d.css("margin-top"),10),m=d.outerHeight(!1),u=t.container.find(".cart-actions, .wishlist-actions").outerHeight(!0),f=0,h=0,p=0,g=t.container.find(".waved-line-sep"),v=parseInt(g.css("margin-top"),10),b=g.outerHeight(!0),C=Math.max(n,o);i=C+c+l+m+r,i=Math.max(C+r,i);var j=t.container.find(".free-shipping-promo"),I=t.container.find(".mini-cart-promo-header");return 0<j.length?(f=parseInt(j.css("margin-top"),10),h=j.outerHeight(!1),p=parseInt(j.css("margin-bottom"),10)):0<I.length&&I.each(function(){var t=N(this);if(0<t.parents(".cart-item-container-js").length)return!1;f=parseInt(t.css("margin-top"),10),h=parseInt(t.parents(".espot-container").outerHeight(!1)),p=parseInt(t.parents(".espot-container").find("p").css("margin-bottom"),10)}),e-i-u-b-(h=f+h+p)+Math.min(p,v)}function s(t){var e=t.container.find(".cart-item-slide-js").outerHeight(!0),i=document.querySelectorAll(".cart-item-js"),a=d(t);if(o){var n=t.container.find(".cart-item-js").length,r=N("#miniCartCustomHead"),s=Array.prototype.map.call(i,function(t){return t.offsetHeight});a=(e=Math.max.apply(Math,s))*Math.min(2,n),0<r.length&&(a+=r.outerHeight(!0)),t.container.find(".cart-item-container-js").css({height:a+"px"}),2<n?t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"):t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))}else e<=a?(t.container.find(".cart-item-container-js").css("height",a+"px"),t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))):(t.container.find(".cart-item-container-js").css("height",a-70+"px"),t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"))}return N(document).on("click",".mini-cart-action-remove-item-js, .mini-cart-action-add-to-cart-js",function(t){i(t)}),{renderMiniListItems:function(t,e,i,a){if(M(),!n)return n=!0,N.ajax({url:t,dataType:"html",data:e}).done(function(t){t.includes("errorMessage")?r((t=JSON.parse(t)).errorMessage,i):o?E(t,i,a):E(t,i)}).fail(function(t){t.responseText.includes("errorMessage")&&(t=JSON.parse(t.responseText)),r(t.errorMessage,i)}).always(function(t){P(),n=!1})},initCarousel:s}});
//# sourceMappingURL=../../../maps/js/wcs/view/mini-list.hash-02d03d71dae712d7961dd01133656c21.js.map