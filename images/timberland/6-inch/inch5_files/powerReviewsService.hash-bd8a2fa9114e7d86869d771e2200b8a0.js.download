define(["require","jquery","pubsub"],function(n,s,e){function t(e,i){this.element=e,this.options=i}var o="powerReviewsService";t.defaults=(t.prototype={defaults:{},init:function(){var e=this;return e.metadata=s(e.element).data(o+"Options"),e.config=s.extend({},e.defaults,e.options,e.metadata),e.events(),e},initPowerReviews:function(e){var n=this;n.powerReviewsConfig=[],n.hasFullview=!1,n.config.prDisplay4URL?("fullview"in e&&(n.hasFullview=!0,n._setPowerReviewsFullviewConfiguration()),s.each(e,function(e,i){"fullview"!==e&&(!i||0<s("#"+i).length)&&n._setPowerReviewsComponentConfiguration(e,i)}),n._renderPowerReviewsComponents()):n.initPowerReviewsOldVersion()},initPowerReviewsOldVersion:function(e){var i=this;e=""===e||e?e:"pwr/engine/js/full.js",n([i.config.pwrDir+e],function(){POWERREVIEWS.display.engine({write:function(e){s("div#rating_reviews").append(e),s("div#rating_reviews  div.pr-review-engine div[itemtype='http://schema.org/Product']").removeAttr("itemtype").removeAttr("itemscope")}},{pr_page_id:i.config.prPageID,pr_write_review:i.config.writeReviewUrl}),i.config.qaEnabled&&i.initQuestionsAnswers(),i.config.whyDidYouBuyProd&&i.initWhyDidYouBuy()})},_setPowerReviewsFullviewConfiguration:function(){var e=this,i=e._getPowerReviewsGlobalConfiguration();s.extend(i,e._getPowerReviewsElementConfiguration(),e._getPowerReviewsFullviewFeatureConfiguration()),e.powerReviewsConfig.push(i)},_setPowerReviewsComponentConfiguration:function(t,e){var i,o=this,r=o._getPowerReviewsGlobalConfiguration();if(e?i=s("#"+e):e=(i=s(o.element)).prop("id"),e){var n=s("[id^="+e+"-"+t.toLowerCase()+"-]");0===n.length?!0===o.hasFullview?o.powerReviewsConfig[0].components[t]=e:(s.extend(r,o._getPowerReviewsElementConfiguration()),r.components[t]=e,o.powerReviewsConfig.push(r)):n.each(function(){var e=s(this);if(0===e.children(".p-w-r").length){var i=e.data();o.config.prPageID=i.powerReviewsServiceOptionPrPageId,o.config.writeReviewUrl=i.powerReviewsServiceOptionWriteReviewUrl;var n=s.extend(!0,{},r,o._getPowerReviewsElementConfiguration());n.components[t]=e.attr("id"),o.powerReviewsConfig.push(n)}}),"ReviewSnippet"===t&&s.pubsub("subscribe","vfdp.wcs.product_reviews.loaded",o._setReviewSnippetLayout.bind(i))}},_getPowerReviewsGlobalConfiguration:function(){var e=this;return{api_key:e.config.prAPIKey,locale:e.config.prLocale,merchant_group_id:e.config.merchantGroupId,merchant_id:e.config.merchantId,REVIEW_DISPLAY_SNAPSHOT_TYPE:e.config.prDisplaySnapshotType,on_render:function(e,i){s.pubsub("publish","vfdp.wcs.product_reviews.loaded",{config:e,data:i})},components:{}}},_getPowerReviewsElementConfiguration:function(){return{page_id:this.config.prPageID,review_wrapper_url:this.config.writeReviewUrl}},_getPowerReviewsFullviewFeatureConfiguration:function(){var e=this,i={};return e.config.prFeedlessEnabled&&(i.product={name:e.config.productName,url:e.config.canonicalProductURL,image_url:e.config.metaImageURL,description:e.config.productLongDescription,category_name:e.config.seoCategoryName,manufacturer_id:"",upc:e.config.upc,brand_name:e.config.brandStoreName,price:e.config.ogPrice,in_stock:e.config.productPublished}),e.config.prDisplay4SnapshotAboveOlapic?i.components={ReviewList:"rating_reviews",ReviewSnapshot:"pr-snapshot-container",ReviewImageDisplay:e.config.prDisplay4IncludeImageDisplay?"rating_reviews":null}:i.components={ReviewDisplay:"rating_reviews"},e.config.qaEnabled&&(i.components.QuestionDisplay="rating_questions"),e.config.whyDidYouBuyProd&&(i.components.WhydYouBuyDisplay="pr-wyb-display"),i},_renderPowerReviewsComponents:function(){var e=this;n([e.config.prDisplay4URL],function(){POWERREVIEWS.display.render(e.powerReviewsConfig)})},_renderSizeFitComponent:function(){var e=this;if(e.powerReviewsConfig){var i=null;!0===e.hasFullview?(i=[])[0]=Object.assign({},e.powerReviewsConfig[0],{components:{SizeFitSnippet:e.powerReviewsConfig[0].components.SizeFitSnippet,ReviewDisplay:null}}):i=Object.assign({},e.powerReviewsConfig,{components:{SizeFitSnippet:e.powerReviewsConfig.components.SizeFitSnippet,ReviewDisplay:null}}),i&&n([e.config.prDisplay4URL],function(){POWERREVIEWS.display.render(i)})}},_setReviewSnippetLayout:function(e,i){if(0,"ReviewSnippet"===e.component){var n=this.find(".pr-snippet-stars-container"),t=this.find(".pr-snippet-read-and-write");0<i.review_count?t.find(".pr-snippet-write-review-link").addClass("hide"):(n.addClass("hide"),t.find(".pr-snippet-review-count").addClass("hide"))}},initQuestionsAnswers:function(){var e=this;POWERREVIEWS.display.productAnswers({write:function(e){s("div#rating_questions").append(e)}},{pr_page_id:e.config.prPageID,pr_ask_question:e.config.writeQuestionUrl,pr_answer_question:e.config.writeAnswerUrl})},initWhyDidYouBuy:function(){POWERREVIEWS.display.whydYouBuy(document,{pr_page_id:this.config.prPageID,pr_locale:this.config.prLocale})},events:function(){var e=this;if(e.config.prTabbedViewEnabled){var i=s(".review-tabs-container"),n=s("#pr-tab-reviews"),t=s("#pr-tab-qa"),o=s("#rating_reviews"),r=s("#rating_questions");n.hasClass("active")?r.hide():o.hide(),i.on("click",function(e){"pr-tab-reviews"===e.target.id?(t.hasClass("active")&&(t.removeClass("active"),r.hide()),n.hasClass("active")||(n.addClass("active"),o.show())):"pr-tab-qa"===e.target.id&&(n.hasClass("active")&&(n.removeClass("active"),o.hide()),t.hasClass("active")||(t.addClass("active"),r.show()))})}s.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.FORM_UPDATE",function(){e._renderSizeFitComponent(),s.pubsub("publish","vfdp.wcs.product_sizefit.refreshed")})}}).defaults,s.fn[o]=function(i){return this.each(function(){var e=s(this).data(o);e||(e=new t(this,i).init(),s(this).data(o,e))})}});
//# sourceMappingURL=../../maps/js/vfdp/powerReviewsService.hash-641ecb78c6a58e7099bc81e3321c88b7.js.map