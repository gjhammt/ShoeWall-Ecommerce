define(["jquery","pubsub","jquery.hoverintent","shared.main.screen","wcs.utils"],function(w,e,o,t,a){var n;return(n={defaults:{el:".topnav-mainnav",activeItem:".active",dataAttr:"topnav-more-dropdown-options",dropdownCloseButton:"topnav-mainnav-more-dropdown-close",dropdownWrapper:"topnav-mainnav-more-dropdown-wrapper",itemLink:".topnav-accordion-item-link",moreItem:".l1.topnav-list, .l1.more",moreLink:" > a",moreDropdown:".topnav-dropdown-list, .topnav-mainnav-more-dropdown",moreDropdownClose:".topnav-mainnav-more-dropdown-close",moreDropdownL1s:".topnav-mainnav-more-menu .l1",moreMenu:".topnav-mainnav-more-menu",rateLimit:150},init:function(){var e=this;return e.deferred=w.Deferred(),e.$element=w(e.defaults.el),e.metadata=e.$element.data(e.defaults.dataAttr),e.config=w.extend({},e.defaults,e.metadata),e.events(),e.keyPressCounterReset=0,e.keyPressCounter=e.keyPressCounterReset,e.menuStatus="inactive",e.deferred.resolve(),e},events:function(){var n=this,t=w(n.config.moreItem);w.pubsub("subscribe","window.resize.breakpoint",function(e,o){n.hideMoreDropdown(t)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.remove.list",function(e,o){n.bindDropdownMenuEvents(o)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.add.list",function(e,o){n.unbindDropdownMenuEvents(o)}),n.bindDropdownMenuEvents(t),t.find(n.config.moreDropdownClose).on("click touch",function(e){e.preventDefault(),e.stopPropagation();var o=w(this).closest(n.config.activeItem);n.hideMoreDropdown(o)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.updated",function(e,o){n.addTabIndexToDropdownElements()}),w.pubsub("subscribe","vfdp.aem.topnav.dropdown.opened",function(e,o){t.hasClass("active")&&n.hideMoreDropdown(t)})},unbindDropdownMenuEvents:function(e){e.off("mouseenter mouseleave"),e.find(this.config.moreLink).off("tap"),e.off("keydown")},bindDropdownMenuEvents:function(e){var n=this;e.find(n.config.moreLink).on("tap",function(e){if("small"!==t.size()){e.preventDefault();var o=w(this).closest(n.config.moreItem);o.hasClass("active")?n.animateMoreClosed(o):n.animateMoreOpen(o)}}),e.hoverIntent({over:function(){"small"!==t.size()&&n.animateMoreOpen(w(this))},out:function(e){"small"!==t.size()&&n.hideMoreDropdown(w(this))},timeout:n.config.rateLimit}),e.on("keydown",n,n.topnavMoreMenuKeyDownHandler)},addTabIndexToDropdownElements:function(){for(var e=w(".topnav-mainnav-more-dropdown .l1 > a"),o=0;o<e.length;o++)w(e[o]).attr("tabindex",o+1)},calculateMoreDropdownPosition:function(e,o){var n=e.offset(),t=e.outerWidth(),i=o.outerWidth(),r=n.left-i/2+t/2,s=w(window).outerWidth();return(r=Math.min(r,s-i))<0&&(r=0),r},hideMoreDropdown:function(e){var o=this,n=e.find(o.config.moreLink),t=e.find(o.config.moreDropdown);n.attr({"aria-expanded":"false"}),a.interruptTransitions(t,function(){e.removeClass("active"),t.css({display:"",height:""})}),w("body").off("click touchstart scroll scrollstart",o.handleDismissMoreDropdown),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.closed")},showMoreDropdown:function(e){var o=this,n=e.find(o.config.moreLink),t=e.find(o.config.moreDropdown);e.addClass("active"),n.attr({"aria-expanded":"true"}),t.css("left",o.calculateMoreDropdownPosition(n,t)),w("body").on("click touchstart scroll scrollstart",o,o.handleDismissMoreDropdown),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.opened")},animateMoreOpen:function(e){var o,n,t=this,i=e.find(t.config.moreLink),r=e.find(t.config.moreDropdown);if(i.attr({"aria-expanded":"true"}),!e.hasClass("active")){o=r[0].style.transition,r[0].style.transition="",e.addClass("active"),r.css({display:"block",height:"0"}),r[0].style.transition=o,n=r[0].scrollHeight,r.css("left",t.calculateMoreDropdownPosition(i,r));var s=function(){r[0].style.height="",r[0].removeEventListener("transitionend",s)};r[0].addEventListener("transitionend",s),a.interruptTransitions(r,function(){r[0].style.height=n+"px"}),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.opened")}w("body").on("click touchstart scroll scrollstart",t,t.handleDismissMoreDropdown)},animateMoreClosed:function(e){var o,n,t=e.find(this.config.moreLink),i=e.find(this.config.moreDropdown);t.attr({"aria-expanded":"false"}),o=i[0].scrollHeight,n=i[0].style.transition,i[0].style.transition="";var r=function(){i[0].style.display="",i[0].style.height="",i.closest(".l1").removeClass("active"),i[0].removeEventListener("transitionend",r)};requestAnimationFrame(function(){a.interruptTransitions(i,function(){i[0].style.height=o+"px",i[0].style.transition=n}),requestAnimationFrame(function(){i[0].addEventListener("transitionend",r),i[0].style.height="0px"})}),w("body").off("click touchstart scroll scrollstart",this.handleDismissMoreDropdown)},handleDismissMoreDropdown:function(e){var o=e.data;w(e.target).closest(o.config.moreItem).length||w(e.target).closest(o.config.moreDropdown).length||o.hideMoreDropdown(w(o.config.moreItem))},topnavMoreMenuKeyDownHandler:function(e){var o,n,t=e.data,i=w(this),r=i.find(w(":focus")),s=r.parent(),a=s.closest("."+t.config.dropdownWrapper),d=s.hasClass("more")||s.hasClass("topnav-list"),l=40,c=13,f=27,p=37,u=39,m=32,v=9,h=38;switch(e.keyCode){case c:case m:d?(e.preventDefault(),s.hasClass("active")?t.hideMoreDropdown(i):(t.showMoreDropdown(i),s.find("."+t.config.dropdownCloseButton).focus())):r.hasClass(t.config.dropdownCloseButton)&&(e.preventDefault(),t.hideMoreDropdown(i),r.closest(".more").find(t.config.moreLink).focus());break;case v:r.hasClass(t.config.dropdownCloseButton)&&(e.preventDefault(),a.find(t.config.itemLink).first().focus());break;case l:e.preventDefault(),d?(t.showMoreDropdown(i),s.find("."+t.config.dropdownCloseButton).focus()):r.hasClass(t.config.dropdownCloseButton)?a.find(t.config.itemLink).first().focus():((o=s.next().find("> a")).length||(o=a.find(t.config.itemLink).first()),o.focus());break;case h:e.preventDefault(),!d&&s.hasClass("l1")&&((o=s.prev().find("> a")).length||(o=a.find(t.config.itemLink+":visible").last()),o.focus());break;case u:d&&((o=s.next().find("> a")).length||(o=t.$element.find(".l1").first().find("> a")),o.focus());break;case p:d&&((n=s.prev().find("> a")).length||(n=t.$element.find(".l1").last().find("> a")),n.focus());break;case f:a.closest(".l1").hasClass("active")&&(e.preventDefault(),t.hideMoreDropdown(i),r.closest(".more").find(t.config.moreLink).focus())}}}).init(),n});
//# sourceMappingURL=../../../maps/js/cms/nav/moreDropdown.hash-c74260322b3b15a2116c32935750e42c.js.map