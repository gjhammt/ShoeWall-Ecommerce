define(["jquery","wcs.context","state-manager","pubsub","wcs.product-price-util","wcs.product-price-service"],function(o,t,r,e,i,u){function s(t,e){o(t).is(".product-form-js")?o(t):o(t).find(".product-form-js")}var n="wcsproductPrices";s.defaults=(s.prototype={defaults:{},init:function(){var t=this,e=o(".product-form-js");return t.stateManager=this.stateManager||new r,u.$productForm&&0!==u.$productForm.length&&-1!==e.index(u.$productForm)||u.init(),this.metadata=u.$productForm.data("product-pricing-options"),this.productFormIndex=e.index(u.$productForm),t._checkInitialState(),t._initPubSubEvents(),t},_checkInitialState:function(){void 0!==window.productFormState?(this.stateManager.setProperty({productFormState:window.productFormState[this.productFormIndex]}),-1!==this.productFormIndex&&this.stateManager.getProperty("productFormState").getProperty("isPreselectedProduct")?(u.parseProductFormAttributes(),this._resolveAttributeSelections()):u.parseProductFormAttributes()):u.parseProductFormAttributes()},_initPubSubEvents:function(){var r=this;o.pubsub("unsubscribe",this.newColorwayProductEventToken),o.pubsub("unsubscribe",this.productFormAttributeMouseLeaveToken),o.pubsub("unsubscribe",this.productFormAttributeChangeCompleteEventToken),this.newColorwayProductEventToken=o.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.NEW",function(t,e){e.formIndex===r.productFormIndex&&r.init()}),this.productFormAttributeMouseLeaveToken=o.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",function(t,e){!0===WCS_CONFIG.get("PDP::pdpUpdatePriceOnColorSwatchHover")&&r.attrBoxMouseLeaveHandler(e)}),this.productFormAttributeChangeCompleteEventToken=o.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",function(t,e){e.updateItemPrice&&r._resolveAttributeSelections(e.obj)})},reset:function(){u._isInitialized=!1,u._firstLoad=WCS_CONFIG.get("PDP::ignoreSelectionOnFirstLoad")},_resolveAttributeSelections:function(t){if(0<(t=t||u.$productForm.find(".clicked.selected").first()).parents(".qty-step-js").length)return!0;if(u._isInitialized){var e=o(".product-form-js").index(u.$productForm),r=t.parents(".attr-container-js").find(".selected [data-product-id]").data("product-id")||t.hasClass("clicked")&&t.data("product-id");if(!0!==u._isBuyable[e])return u._showProductPrice(e,null),!0;u._isColorBundle&&r?(u._productId[e]=r,u._itemPricingJSONCache[u._productId[e]]?u._handleItemPricing(e,u._productId[e]):(u._possibleProducts[e]=[],u.parseProductFormAttributes())):u._resetPrice(e)}},attrBoxMouseLeaveHandler:function(t){if(u._isInitialized){var e=u.$productForm.index(t.closest(".product-form-js"));!0===u._isBuyable[e]?u._resetPrice(e):u._showProductPrice(e,null)}}}).defaults,o.fn.productPrices=function(t){return this.each(function(){var t=o(this).data(n);t||(t=new s(this).init(),o(this).data(n,t))})}});
//# sourceMappingURL=../../../maps/js/wcs/view/product-price.hash-d2717042f71972bcae1250dc101d6419.js.map