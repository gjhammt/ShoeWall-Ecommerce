define(["jquery","pubsub","shared.main.screen","wcs.utils"],function(m,n,l,a){var e;return(e={defaults:{dataAttr:"menu-button-options",accordionLink:".topnav-accordion .has-children > a",topNavDropdown:".topnav-dropdown",accordion:".topnav-accordion",accordionItem:".topnav-accordion-item",l1ShopAll:'.topnav-accordion-shopall:not(".l2 .topnav-accordion-shopall")',speed:250,easing:"swing",imageGrid:".topnav-dropdown-imagegrid",drilldown:"topnav-drilldown",drilldownMenu:".drilldown-menu",drilldownContainer:".drilldown-container",drilldownBackLink:".drilldown-back-link",drodownWrapper:".topnav-dropdown-wrapper",shopAll:"topnav-accordion-shopall",shopAllLink:"topnav-accordion-shopall-link"},init:function(){var n=this;return n.deferred=m.Deferred(),n.$element=m(n.defaults.accordion),n.metadata=n.$element.data(n.defaults.dataAttr),n.config=m.extend({},n.defaults,n.metadata),n.defaultMenuType="accordion",n.$menu=n.$element,n.menuType=n.$menu.data("mobile-menu-type"),n.l2Counter=0,n.l3Counter=0,n.boundToElement=!1,n.$accordion=m(n.config.accordion),n.$mainnav=m(n.config.mainnav),"drilldown"===n.menuType&&(n.$drilldownContainer=n.$menu.find(n.config.drilldownContainer),n.$drilldownMenus=n.$drilldownContainer.find(n.config.drilldownMenu),n.$drilldownRoot=n.$drilldownMenus.filter(".root"),n.$drilldownBackLinks=n.$drilldownContainer.find(n.config.drilldownBackLink),n.enableDrilldownMenu()),n.events(),n.menuStatus="inactive",n.deferred.resolve(),n},events:function(){var i=this;m(i.config.accordionLink).on("click touch",m(this),function(n){"small"===l.size()&&(n.preventDefault(),i.toggleMenu(m(this)))}),m.pubsub("subscribe","window.resize.breakpoint",function(n,e){"small"!==e.now&&i.resetMenu(i.$accordion),"drilldown"===i.menuType&&("small"===e.now?i.enableDrilldownMenu():i.disableDrilldownMenu()),i.toggleKeyboardMenuEvents(i.$accordion)}),"drilldown"===i.menuType&&i.$drilldownBackLinks.on("click touch",function(n){n.preventDefault(),i.goToPrevMenu()}),i.toggleKeyboardMenuEvents(i.$accordion),m.pubsub("subscribe","vfdp.aem.topnav.accordion.close",function(){i.resetMenu(i.$accordion)})},toggleKeyboardMenuEvents:function(n){var e=this;n.off("keydown",e,e.topnavMenuKeyDownHandler),e.boundToElement=!1,"small"===l.size()&&(n.on("keydown",e,e.topnavMenuKeyDownHandler),e.boundToElement=!0)},toggleMenu:function(n){n.parent().hasClass("active")?this.hideMenuLinks(n):this.showMenuLinks(n)},showMenuLinks:function(n){var e,i=this,l=n.parent(),o=l.get(0),t=0;if("drilldown"!==i.menuType){e=n.closest("li").hasClass("l1")?l.find(i.config.topNavDropdown):n.siblings(),n.attr({"aria-expanded":"true"});var s=function(){e.height("auto").addClass("active"),l.height("auto"),o.removeEventListener("transitionend",s)};o.addEventListener("transitionend",s),a.interruptTransitions(l,function(){l.css({height:0,overflow:"hidden",display:"block"}).addClass("active"),e.css({display:"block"}),t=o.scrollHeight}),o.style.height=t+"px"}else i.goToNextMenu(l.find(i.config.drilldownMenu).first())},hideMenuLinks:function(n){var e,i=(e=n.closest("li").hasClass("l1")?n.closest(".l1"):n.closest(".l2")).get(0),l=i.scrollHeight,o=n.height()+2*parseInt(n.parent().css("padding-top"));n.attr({"aria-expanded":"false"});var t=function(){e.find(".active").css({display:"",height:"",overflow:""}).removeClass("active"),e.removeClass("active").css({display:"",height:"",overflow:""}),i.removeEventListener("transitionend",t)};requestAnimationFrame(function(){a.interruptTransitions(e,function(){i.style.height=l+"px"}),requestAnimationFrame(function(){i.addEventListener("transitionend",t),i.style.height=o+"px"})})},resetMenu:function(n){var e=this;n.find(".active").css({display:"",height:"","padding-top":""}).removeClass("active"),n.find(e.config.l1ShopAll).css({display:""}),"drilldown"===e.menuType&&e.resetDrilldownMenu()},navigate:function(n,e,i){return 40==i?(m("[tabindex="+e[n]+"]").trigger("focus"),n++):m("[tabindex="+e[--n]+"]").trigger("focus"),n},navigateL1:function(n,e,i,l,o){n.length?n.trigger("focus"):e.find("> a").trigger("focus"),e.hasClass("active")&&(this.hideMenuLinks(l),i.hasClass("active")&&this.hideMenuLinks(o))},collapseDropdown:function(n){this.hideMenuLinks(n),n.closest(".l1").children("a").trigger("focus")},topnavMenuKeyDownHandler:function(n){var e=n.data,i=m(this).find(m(":focus")),l=i.parent(),o=l.hasClass("has-children"),t=40,s=13,a=27,d=32,r=38;switch(n.keyCode){case d:case s:o&&(n.preventDefault(),l.hasClass("active")?e.hideMenuLinks(i):e.showMenuLinks(i));break;case t:n.preventDefault();var c=l.next();if(c.hasClass("more"))c=l.siblings().first();else if(i.hasClass(e.config.shopAllLink))c=l.hasClass(e.config.shopAll)?l.siblings().find(".l3").first():l.closest(e.config.drodownWrapper).find(".l2").first();else if(l.hasClass("l2")&&l.is(":last-child")){var u=l.closest(".columns"),f=u.next();u.is(":last-child")||f.is(":hidden:last-child")?(c=l.closest(e.config.drodownWrapper).find("."+e.config.shopAll+" .columns")).length||(c=u.siblings().first().find(".l2").first()):c=f.find(".l2").first()}else l.hasClass("l3")&&l.is(":last-child")&&((c=l.closest(".l2").find("."+e.config.shopAll)).length||(c=l.siblings().first()));c.find("> a").focus();break;case r:n.preventDefault();var h=l.prev();if(l.hasClass("l1")&&l.is(":first-child"))(h=l.siblings().last()).hasClass("more")&&(h=h.prev());else if(i.hasClass(e.config.shopAllLink))if(l.hasClass(e.config.shopAll))h=l.siblings().find(".l3").last();else{var v=l.closest(e.config.drodownWrapper).find(">.row .columns").last();h=v.find(".l2").last(),v.is(":hidden")&&(h=v.prev().find(".l2").last())}else if(l.hasClass("l2")&&l.is(":first-child")){var p=l.closest(".columns"),g=p.prev();p.is(":first-child")?(h=l.closest(e.config.drodownWrapper).find("."+e.config.shopAll+" .columns")).length||(h=p.siblings().last().find(".l2").last()):h=g.find(".l2").last()}else l.hasClass("l3")&&l.is(":first-child")&&((h=l.closest(".l2").find("."+e.config.shopAll)).length||(h=l.siblings().last()));h.find("> a").focus();break;case a:n.preventDefault();var w=i.closest(e.config.accordionItem+".active");w.length&&(w.find("> a").focus(),e.hideMenuLinks(w))}},enableDrilldownMenu:function(){var n=this;return"small"===l.size()&&(n.$accordion.addClass(n.config.drilldown),n.resetDrilldownMenu(),n.deferred.resolve()),n.deferred},disableDrilldownMenu:function(){var n=this;return"small"!==l.size()&&(n.$accordion.removeClass(n.config.drilldown),n.resetDrilldownMenu(),n.deferred.resolve()),n.deferred},resetDrilldownMenu:function(){var n=this;n.$drilldownMenus.removeClass("active"),n.$drilldownRoot.attr("data-menu-level",0),n.$drilldownActiveMenu=n.$drilldownRoot,n.setDrilldownHeight()},setDrilldownHeight:function(){var n=this;if("small"===l.size()){var e=n.$drilldownActiveMenu.data("height");if(!e){if(0===(e=n.$drilldownActiveMenu.outerHeight())){var i=n.$accordion.is(":visible")?null:n.$accordion;e=a.getHiddenElementSize(n.$drilldownActiveMenu,i).height}n.$drilldownActiveMenu.data("height",e)}n.$drilldownContainer.css({height:e})}else n.$drilldownContainer.css({height:""})},goToNextMenu:function(n){var e=this;e.$drilldownActiveMenu=n,e.$drilldownActiveMenu.addClass("active"),e.setDrilldownHeight();var i=parseInt(e.$drilldownRoot.attr("data-menu-level"))+1;if(e.$drilldownRoot.attr("data-menu-level",i),1==i&&!e.$drilldownActiveMenu.attr("data-category")){var l=e.$drilldownActiveMenu.siblings(".topnav-accordion-item-link").text();e.$drilldownActiveMenu.attr("data-category",l),e.$drilldownActiveMenu.find(".topnav-dropdown-l3 .drilldown-back-text").text(l)}},goToPrevMenu:function(){var n=this,e=n.$drilldownActiveMenu;n.$drilldownActiveMenu=e.parents(n.config.drilldownMenu).first();var i=function(){e.removeClass("active"),n.$drilldownRoot[0].removeEventListener("transitionend",i)};n.$drilldownRoot[0].addEventListener("transitionend",i),n.setDrilldownHeight(),n.$drilldownRoot.attr("data-menu-level",parseInt(n.$drilldownRoot.attr("data-menu-level"))-1)}}).init(),e});
//# sourceMappingURL=../../../maps/js/cms/nav/topnavAccordion.hash-42363ac1cbfb92811a6092990e1b50ff.js.map