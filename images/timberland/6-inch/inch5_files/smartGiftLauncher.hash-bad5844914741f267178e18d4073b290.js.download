define(["jquery","Handlebars","handlebars-core","pubsub","wcs.product-price-service"],function(a,t,e,i,n){function o(t,e){this.element=t,this.options=e}var r="smartGiftLauncher";o.defaults=(o.prototype={defaults:{targetContainer:"#ecom-product-actions",template:"html.smart-gift-launcher.smart-gift-launcher",buttonLabel:"SEND WITH SMART GIFT",quantity:1,skuCode:"",skuUrl:"",price:"",productImageUrl:"",isColorwayEnabled:!1,skuFieldSelector:"",dataConfigSelector:"",smartGiftOptions:{merchantCode:"timberland",scriptUrl:"",customParameters:"",lang:"en-us"},isOutOfStock:!1,isSizeSelectionRequired:!1,addToCartSelector:".add-to-bag-js",behaveAsAddToCart:!1},init:function(){var t=this;return t.metadata=a(t.element).data(r+"Options"),t.config=a.extend({},t.defaults,t.options,t.metadata),t.events(),t._build(),t},_build:function(){var t=this;return t.loadAndCompileTemplate().done(function(){t.$targetContainer||t.render(t.config)})},render:function(t){var e=this;e.smartGiftInit(e.config.smartGiftOptions.scriptUrl,e.config.smartGiftOptions.merchantCode),a(e.config.targetContainer).after(e.compiledTemplate(t)),e.$selector=a(".smart-gift-button-js"),e.obtainProductParameters(),e.$selector.on("click",e.launchSmartGift.bind(e))},events:function(){var t=this;a.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.UPDATE",t.obtainProductParameters.bind(t)),a.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.FORM_UPDATE",t._build.bind(t)),a.pubsub("subscribe","product.price.updated",t.updatePrice.bind(t)),a.pubsub("subscribe","WCS.PRODUCTFORM.CURRENT_SELECTION.HAS_INVENTORY",t.handleInStock.bind(t)),a.pubsub("subscribe","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY",t.handleOutOfStock.bind(t)),a.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",t.handleOnAttrMouseLeave.bind(t))},smartGiftInit:function(t,e){var i=this;if(t){var o=document.createElement("script");o.async=1,o.src=t,o.onload=function(){SmartGiftWidget.mount(e,{lang:i.config.smartGiftOptions.lang})};var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}},launchSmartGift:function(t){var e=this,i=a(e.config.addToCartSelector);t.preventDefault(),t.stopPropagation(),SGBasket||console.error("Smart gift basket not initialized!"),e.config.isOutOfStock||(e.config.behaveAsAddToCart&&e.$selector.hasClass("disabled")?i.click():SGBasket.addItem({skuCode:e.config.skuCode,skuUrl:e.config.skuUrl,price:e.config.price,name:e.config.name,image:e.config.image,quantity:e.config.quantity,customParameters:e.config.smartGiftOptions.customParameters}))},obtainProductParameters:function(){var t=this,e=a(t.config.dataConfigSelector).data();if(e){var i=e[t.config.skuFieldSelector];if(!i&&"itemSku"==t.config.skuFieldSelector){if(void 0===a(".product-form-js").data("AddToCartForm"))return void t.handleSizeSelectionRequired();var o=a(".product-form-js").data("AddToCartForm").catEntryId;i=a(".product-form-js").data("AddToCartForm").productAvailability.getPartNumber(o)}t.config.skuUrl=t.getProductURL(e),t.config.skuCode=i,t.config.name=e.productName,t.config.image=e.main,t.config.price=n.lowPriceNumeric,t.handleSizeSelectionRequired()}},toggleDisableButton:function(t){var e=this;t?(e.$selector.addClass("disabled"),e.config.behaveAsAddToCart||e.$selector.attr("disabled",!0)):(e.$selector.removeClass("disabled"),e.config.behaveAsAddToCart||e.$selector.removeAttr("disabled"))},handleOutOfStock:function(){this.config.isOutOfStock=!0,this.toggleDisableButton(!0)},handleInStock:function(){this.config.isOutOfStock=!1,this.toggleDisableButton()},handleOnAttrMouseLeave:function(){var t=this;a("#buttonAddToBag").hasClass("btn-out-of-stock")?t.handleOutOfStock():t.config.isSizeSelectionRequired?t.handleSizeSelectionRequired():t.handleInStock()},updatePrice:function(){this.config.price=n.lowPriceNumeric},getProductURL:function(t){return this.config.isColorwayEnabled?t.productUrl+"?variationId="+t.variationId:t.productUrl},handleSizeSelectionRequired:function(){var t=this;t.config.isSizeSelectionRequired&&(0<a(".attr-size .attribute-value-selected").length?t.toggleDisableButton():t.toggleDisableButton(!0))}}).defaults,o.prototype=a.extend({},e,o.prototype),a.fn[r]=function(e){return this.each(function(){var t=a(this).data(r);t||(t=new o(this,e).init(),a(this).data(r,t))})}});
//# sourceMappingURL=../../maps/js/vfdp/smartGiftLauncher.hash-2142bf4a54acb854784557677641f6d5.js.map