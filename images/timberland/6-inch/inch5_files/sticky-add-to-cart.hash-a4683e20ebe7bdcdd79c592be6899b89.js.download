define(["jquery","handlebars-core","shared.main.screen","pubsub","shared.main.resize","foundation.reveal","wcs.tooltip"],function(g,t,h){"use strict";function e(t,i){var o;return this.element=t,this.options=i||{},this.metadata=g(this.element).data("sticky-options"),this.data={},this.defaults={elementSelector:".add-to-bag-js",template:"html.add-to-cart.sticky",showFor:["small"],location:{above:"top",inview:"hide",below:"hide"},customLocations:[],buttonText:"Add to Cart",productPrice:{enabled:!0},productPromo:{enabled:!1,selector:".discount-container"},quantity:{enabled:!1,title:"Please enter valid quantity",label:"Quantity:",default:"1",error:"Please enter valid quantity",errorState:!1,className:".quantity-js",idName:"#sticky-quantity-id"},img:{enabled:!0,label:!1,scrollOnClick:!1},productInfo:{enabled:!0},navigation:{enabled:!1,links:[{label:"Overview",url:"#container-4",modal:!1,tooltip:{enabled:!1}},{label:"Reviews",url:"#pr-review-display",modal:!1,tooltip:{enabled:!1}},{label:"Warranty",modal:!1,tooltip:{enabled:!0,content:"We stand by our packs for a lifetime and since we've been making packs since 1967, that's a guarantee you can stand by.",className:"product-content-form-guarantee-tooltip tooltip-js"}}]},errorMessaging:{enabled:!1,closeAriaLabel:"Close",className:".errorMessage",idName:"#sticky-add-to-cart-error"},sizeSelection:{enabled:!1,initialLabelSelector:"#buttonAddToBag",isDropdown:!1,label:!1,sizeAsSeparateContainer:!1,displayEmpty:!1,scrollOnClick:!1},containerClass:".sticky-add-to-cart",favoritesButton:{enabled:!1,isWishlist:!1,isHideOnSizeNotSelect:!1,icon:"icon-favorite",iconOutline:"icon-favorite",iconFilled:"icon-favorite-filled",iconOutlineAnimatedClass:"favorites-icon-outline-animated",iconFilledAnimatedClass:"favorites-icon-filled-animated",selector:".add-to-favorite.favorites-js",addFavoritesButtonSelector:"#sticky-favorites-button > .sticky-icon"},scrollOnAddToCartAction:{enabled:!1,selector:"",duration:"slow"},scrollToError:{enabled:!1},signInButtonConfig:{enabled:!1,selector:"#signInModalButton",hideStickyOnMobile:!1},overrideConfig:{}},this.config=g.extend(!0,{},this.defaults,this.options,this.metadata),this.config.overrideConfig[h.size()]&&(this.config=g.extend(!0,this.config,this.config.overrideConfig[h.size()])),!this.config.useAddToCartLabel||(o=0<g("#buttonAddToBag").length?g("#buttonAddToBag").data():g(this.element).data()).addToCartText&&(this.config.buttonText=o.addToCartText),this.$element=g(this.element),this}var n="StickyAddToCart",b=window.DEBUG||!1;e.prototype={init:function(){var t=this;return b&&console.log("$.fn.StickyAddToCart init"),this.loadAndCompileTemplate().done(function(){t.config.signInButtonConfig.enabled&&(t.$signInButton=g(t.config.signInButtonConfig.selector)),t.bindEventHandlers(),t.updateAll(),t.updateSizeSelection(),t.updateAddToFavorites()}),this},updateSelectedColorSwatch:function(){if(b&&console.log("$.fn.StickyAddToCart updateSelectedColorSwatch"),!1!==this.config.img.enabled)if(!0===this.config.img.useMetaImage){var t=g('meta[property="og:image"]').attr("content"),i=g(".color-swatches-js").find(".attr-box.selected img");this.config.img.src=i.length?i.data("main"):t,this.config.img.alt=i.length?i.attr("alt"):t}else{var o=g(".color-swatches-js .selected img");this.config.img.src=o.attr("src"),this.config.img.alt=o.attr("alt")}},updateProductName:function(){b&&console.log("$.fn.StickyAddToCart updateProductName"),this.config.name=g("h1.product-info-js").text()},updateProductColor:function(){b&&console.log("$.fn.StickyAddToCart updateProductColor"),this.config.color=g(".color-swatches-js .selected").data("attribute-value")},updateProductSize:function(){b&&console.log("$.fn.StickyAddToCart updateProductSize");var t=g(".attr-size h2").text()?g(".attr-size h2").text()+": ":"",i=g("#attr-size option:selected:not(.attr-size-deselected-js)").val()||g(".attr-size .attr-box.selected").text();this.config.sizeSelection.label?this.config.size=i:this.config.size=i?t+i:i},updateProductPrice:function(){b&&console.log("$.fn.StickyAddToCart updateProductPrice"),this.config.price=g(".product-content-info-price").html()},updateProductPromo:function(){var t=this;t.config.productPromo.enabled&&(t.config.promo=g(t.config.productPromo.selector).html())},updateProductQuantity:function(){this.config.quantity.enabled&&(b&&console.log("$.fn.StickyAddToCart updateProductQuantity"),this.config.isSticky?(this.config.quantity.default=this.config.quantity.stickyValue,g("#quantity-item").val(this.config.quantity.default)):this.config.quantity.default=g("#quantity-item").val())},initSizeSelection:function(){var o=this;this.config.sizeSelection.enabled&&(g.pubsub("subscribe","PDP_ADD_TO_CART_SELECTED",function(t,i){o.updateSizeSelection(i),o.updateAll()}),this.isSizeSelected=!1,0<g(".attr-size .attribute-value-selected").length&&(this.isSizeSelected=!0),this.config.originalButtonText=this.config.buttonText,this.config.sizeSelectionLabel=g(this.config.sizeSelection.initialLabelSelector).data("stickySelectSizeLabel")||g(this.element).data("stickySelectSizeLabel")||LANG_MSG.PDP_STICKY_SELECT_SIZE_LABEL,!1===this.isSizeSelected&&(this.config.buttonText=this.config.sizeSelectionLabel))},updateAddToFavorites:function(){var t=this;this.config.favoritesButton.enabled&&(t.config.favoritesButton.isWishlist||(t.$addToFavoritesButtonMain=g(t.config.favoritesButton.selector),t.$addToFavoritesButtonSpan=g(t.config.favoritesButton.addFavoritesButtonSelector),t.isFavored=!t.$addToFavoritesButtonMain.data().favored),t.toggleFavoriteState())},toggleFavoriteState:function(){var t=this;t.$addToFavoritesButtonSpan=g(t.config.favoritesButton.addFavoritesButtonSelector),t.config.favoritesButton.isWishlist?t.isFavored&&(t.$addToFavoritesButtonSpan.removeClass(t.config.favoritesButton.iconOutline).addClass(t.config.favoritesButton.iconFilled),t.triggerAnimation(t.config.favoritesButton.iconFilledAnimatedClass)):(t.isFavored=!t.isFavored,!0===t.isFavored&&!0===t.$addToFavoritesButtonSpan.hasClass(t.config.favoritesButton.iconOutline)?(t.config.favoritesButton.icon=t.config.favoritesButton.iconFilled,t.$addToFavoritesButtonSpan.removeClass(t.config.favoritesButton.iconOutline).addClass(t.config.favoritesButton.iconFilled),t.triggerAnimation(t.config.favoritesButton.iconFilledAnimatedClass)):!0===t.$addToFavoritesButtonSpan.hasClass(t.config.favoritesButton.iconFilled)&&(t.config.favoritesButton.icon=t.config.favoritesButton.iconOutline,t.$addToFavoritesButtonSpan.removeClass(t.config.favoritesButton.iconFilled).addClass(t.config.favoritesButton.iconOutline),t.triggerAnimation(t.config.favoritesButton.iconOutlineAnimatedClass)))},triggerAnimation:function(t){var i=this;i.$addToFavoritesButtonSpan.addClass(t),setTimeout(function(){i.$addToFavoritesButtonSpan.removeClass(t)},700)},toggleWishlistButtonVisibility:function(){b&&console.log("$.fn.StickyAddToCart toggleWishlistButtonVisibility");var t=this;t.$addToFavoritesButtonSpan=g(t.config.favoritesButton.addFavoritesButtonSelector),t.config.favoritesButton.isHideOnSizeNotSelect&&(t.isSizeSelected?t.$addToFavoritesButtonSpan.parent().removeClass("hide"):t.$addToFavoritesButtonSpan.parent().addClass("hide"))},updateSizeSelection:function(t){if(this.config.sizeSelection.enabled){if(b&&console.log("$.fn.StickyAddToCart sizeSelection"),t&&t.target)g(t.target).hasClass("out-of-stock")?this.isSelectionOutOfStock=!0:this.isSelectionOutOfStock=!1;else if(t&&t.obj&&this.config.sizeSelection.isDropdown){this.isSelectionOutOfStock=!1,g(t.obj).hasClass("out-of-stock")&&(this.isSelectionOutOfStock=!0)}var i=g(".attr-size").length,o=g(".product-content-form-size-btn-label.selected").length;this.isSizeSelected=i===o,!1===this.isSizeSelected?this.config.buttonText=this.config.sizeSelectionLabel:this.config.buttonText=this.config.originalButtonText}},render:function(t){b&&console.log("$.fn.StickyAddToCart render"),t=t||this.config,this.container&&this.container.remove(),this.container=g(this.compiledTemplate(t)).appendTo("body"),this.updateView(),this.isToolTipEnabled(),g(this.config.errorMessaging.idName).foundation()},updateView:function(t){var o=this;if(t=t||h.size(),b&&console.log("$.fn.StickyAddToCart updateView"),this.container)if(0<o.$element.length&&!o.$element[0].isConnected&&(o.$element=g(o.config.elementSelector)),!o.$element.hasClass("disabled")&&!o.$element.prop("disabled")||this.config.signInButtonConfig.enabled&&0<this.$signInButton.length)if(this.config.sizeSelection.enabled&&this.isSelectionOutOfStock)this.container.addClass("hide");else if(this.config.signInButtonConfig.enabled&&this.config.signInButtonConfig.hideStickyOnMobile&&0!==this.$signInButton.length)this.container.addClass("hide");else{var i=o.$element;this.config.signInButtonConfig.enabled&&"none"===i.css("display")&&0!==this.$signInButton.length&&(i=this.$signInButton);var e=g(window).scrollTop(),n=i.offset().top,s=g(window).height(),a=n<e?"above":e<n-s?"below":"inview";if(o.config.customLocations&&0<o.config.customLocations.length)for(var c=0;c<o.config.customLocations.length;c++){var l=o.config.customLocations[c],r=g(l.selector);if(0!==r.length)r.offset().top-s<=e&&(a=l.state)}-1<this.config.showFor.indexOf(t)?this.container.removeClass(function(){return Object.keys(o.config.location).reduce(function(t,i){return t+(" "+o.config.location[i])},"hide")}).addClass(this.config.location[a]):this.container.addClass("hide");var d=this.container.find("#sticky-add-to-cart-button"),u=d.offset().top,f=d.outerHeight();g(".footer").offset().top<=u+f?this.container.css("visibility","hidden"):this.container.css("visibility","visible")}else this.container.addClass("hide")},updateButtonText:function(t){this.data.buttonText=t||this.config.buttonText},updateAll:function(){b&&console.log("$.fn.StickyAddToCart updateAll"),this.updateSizeSelection(),this.updateSelectedColorSwatch(),this.updateProductName(),this.updateProductColor(),this.updateProductSize(),this.updateProductPrice(),this.updateProductPromo(),this.updateProductQuantity(),this.updateButtonText(),this.render(),this.updateAddToFavorites(),this.toggleWishlistButtonVisibility()},isToolTipEnabled:function(){var o=!1;g.each(this.config.navigation.links,function(t,i){i.tooltip.enabled&&(o=!0)}),!0===o&&g.pubsub("publish","STICKYCART_TOOLTIPSTERS")},isSticky:function(){var t=this;g(t.config.containerClass).hasClass("hide")?t.config.isSticky=!1:t.config.isSticky=!0},scrollToError:function(t){var i=t.unselectedSizes,o=g(i[0]);g("html, body").animate({scrollTop:o.offset().top-o.outerHeight(!0)},"slow")},toggleSignInVisibility:function(t,i){var o=this;if(!0!==i.wasHover){var e,n=g("#sticky-add-to-cart-button");if(0!==n.length)e=!0===i.signInVisible?(o.originalText=o.config.buttonText,o.config.buttonText=o.$signInButton.text(),o.$signInButton.css("background-color")):(o.config.buttonText=g(o.element).text(),g(o.element).css("background-color")),n.find(".sticky-text").text(o.config.buttonText),n.css("background-color",e),o.updateButtonText()}},scrollToAttrContainer:function(t){var i=g(t),o=i.offset().top,e=i.outerHeight();g("html, body").animate({scrollTop:o-e},500)},bindEventHandlers:function(){b&&console.log("$.fn.StickyAddToCart bindEventHandlers");var e=this;if(g.pubsub("subscribe","product-form.attr.swatch.click",function(t,i){e.updateAll()}),g.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",function(t,i){(i.originateFromClick||e.config.sizeSelection.isDropdown)&&(e.updateSizeSelection(i),e.updateAll())}),g.pubsub("subscribe","product.price.updated",function(t,i){e.updateProductPrice(),e.container&&e.container.find(".product-price").html(e.config.price)}),g(document).on("click","#sticky-add-to-cart-button",function(t){t.preventDefault();var i=g(e.config.elementSelector);if(!0===i.is(":hidden")&&e.config.signInButtonConfig.enabled?!0===e.$signInButton.is(":visible")&&e.$signInButton.trigger("click"):i.trigger("click"),e.config.scrollOnAddToCartAction.enabled){var o=0<e.config.scrollOnAddToCartAction.selector.length?g(e.config.scrollOnAddToCartAction.selector).position().top:g(e.element).position().top;g("body, html").animate({scrollTop:o},e.config.scrollOnAddToCartAction.duration)}}),g(document).on("click","#sticky-favorites-button",function(t){t.preventDefault(),g.pubsub("publish","STICKYCART.WISHLIST.CLICKED",{suppressNotification:!0})}),g.pubsub("subscribe","window.resize.breakpoint",function(t,i){e.updateView(i.now)}),g(window).on("scroll",function(){e.updateView(),e.isSticky()}),g.pubsub("subscribe","WISHLIST_UPDATED.add",function(t,i){e.isFavored=!0,e.toggleFavoriteState()}),g.pubsub("subscribe","WISHLIST_UPDATED.remove",function(t,i){e.isFavored=!1,e.toggleFavoriteState()}),e.config.quantity.enabled){var i=!1;g(document).on("focusout",e.config.quantity.className,function(t){i||(i=!0,e.config.isSticky&&(e.config.quantity.stickyValue=g(t.currentTarget).val()),e.updateAll(),i=!1)}),g(document).on("keyup",e.config.quantity.idName,function(t){g.pubsub("publish","WCS.PRODUCTFORM.QUANTITY.KEYUP",t.currentTarget)}),g(document).on("mouseout",e.config.quantity.idName,function(t){e.config.quantity.errorState||g(this).focusout()}),g.pubsub("subscribe","WCS.PRODUCTFORM.QUANTITY.ERROR",function(t,i){"show"===i?e.config.quantity.errorState=!0:"hide"===i&&(e.config.quantity.errorState=!1)})}g.pubsub("subscribe","WCS.PRODUCTFORM.ERRORMESSAGE",function(t,i){var o=g(e.config.errorMessaging.idName);e.config.isSticky&&(o.find(e.config.errorMessaging.className).html(i).end().foundation("open"),g(o).on("open.zf.reveal",function(t){o.removeClass("hide")}))}),e.config.productPromo.enabled&&g.pubsub("subscribe","WCS.PRODUCT_FORM.PROMO.RENDER.COMPLETE",function(){e.updateAll()}),!e.config.scrollOnAddToCartAction.enabled&&e.config.scrollToError.enabled&&g.pubsub("subscribe","PDP_ADD_TO_CART_UNSELECTED_SIZES",function(t,i){e.scrollToError(i)}),e.config.signInButtonConfig.enabled&&g.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.SIGNIN.VISIBILITY.CHANGE",e.toggleSignInVisibility.bind(e)),e.config.img.scrollOnClick&&g(document).on("click",".product-swatch",function(t){e.scrollToAttrContainer(".attr-color-js")}),e.config.sizeSelection.scrollOnClick&&g(document).on("click",".product-size",function(t){e.scrollToAttrContainer(".attr-size")}),this.initSizeSelection()}},e.prototype=g.extend({},t,e.prototype),g.fn.StickyAddToCart=function(i){b&&console.log("$.fn.StickyAddToCart",i);var o=arguments;return this.each(function(){var t=g(this).data(n);t||(t=new e(this,i).init(),g(this).data(n,t)),"string"==typeof i&&t.hasOwnProperty(i)&&"function"==typeof t[i]&&t[i].apply(t,Array.prototype.slice.call(o,1))})}});
//# sourceMappingURL=../../../../maps/js/wcs/view/product-form/sticky-add-to-cart.hash-48a1316528ac217d1ade47aa9605dfa8.js.map