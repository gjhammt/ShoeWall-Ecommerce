define(["require","jquery","pubsub","shared.main.plugins","state-manager","wcs.context","wcs.product-availability","wcs.alert","wcs.utils","wcs.find-in-store-model","wcs.product-availability-ajax","wcs.product-price","wcs.product-form-util","promise!wcs.zmetrics","datalayer.wcs.product-form","jquery.tooltipster","coremetrics.wcs.product-form","promise!wcs.lang-msg"],function(i,u,t,e,s,a,o,r,n,d,l){var c,h=n.getURLParam(window.location.href,"token"),p=u(".product-form-js").data("redeem-gift-enabled")&&0<h.length,b=WCS_CONFIG.get("PDP::authOnlineDealerEnabled")&&0===u(".quickview-box-js").length&&!p,f=WCS_CONFIG.get("quickView::quickViewNotifyMeEnabled"),m=WCS_CONFIG.get("PDP::notifyMeEnabled")&&0===u(".quickview-box-js").length||f,C=!1,v=WCS_CONFIG.get("PDP::pdpSizeSelectorBoxDisplayEnabled"),S=(u("body.pdp-drawer, .quickview-box.pdp-drawer").length||!1)&&v||!1,y=WCS_CONFIG.get("PDP::pdpShowStockAvailabilityDisclaimerEnabled"),g=WCS_CONFIG.get("PDP::pdpMixedCategoryProductsDisplayEnabled"),O=WCS_CONFIG.get("PDP::pdpUseInlineErrorEnabled")||!1,T=WCS_CONFIG.get("PDP::pdpRenderPromotion")||!1,I=!1,A=function(){return this instanceof A?this:new A};return A.prototype={initProductFormCore:function(){return console.log("Initializing Product Form"),this.setInitialState(),this.findElements(),p&&this.getGiftRedemptionJSON(),this.cacheSelectors(),this.unbindSharedProductFormEvents(),this.initSharedProductFormEvents(),this.initChildren(),this.initModelMeasurements(),this.isOneSizeProduct||this.isPreselectedProduct||this.disableFindInStoreAndAddToWishlist(),this.stockDisclaimerRangesMap=u.map(this.stockDisclaimer.children(),function(t,e){var i=u(t).data("quantity-range");if(i&&i.length)return{min:u(t).data("quantity-range")[0],max:u(t).data("quantity-range")[1],elementIndex:e}}),WCS_CONFIG.PDP.pdpEnablePerformanceMarks&&performance.mark("PDP Form Init ready"),this},setInitialState:function(){return this.productFormIndex=u(".product-form-js").index(this.productForm),void 0===window.productFormState?(this.stateManager=new s("productFormState"),window.productFormState=[],window.productFormState[this.productFormIndex]=this.stateManager):this.stateManager=window.productFormState[this.productFormIndex],this.stateManager.setProperty({productFormIndex:this.productFormIndex}),this.state=this.stateManager.getState(),this},selectAttributes:function(){return this.isColorWayBundle?this.productForm.find(".selection-js[data-attribute-id]"):this.productForm.find(".selection-js[data-attribute-id]:visible")},findElements:function(){this.templateType=WCS_CONFIG.get("PDP::pdpTemplateType"),this.isPDPSwatches="swatches"===this.templateType,this.isColorWayBundle="basic"===this.templateType,this.isDrawer="drawer"===this.templateType,this.productAvailJSON=null,this.$attributes=this.selectAttributes(),this.$attrValueMap=null,this.categoryId=a.getCategoryId(),this.storeId=a.getStoreId(),this.langId=a.getLangId(),this.productId=this.productForm.find("input[name=catEntryId]").val(),this.productAvailability=null,this.onlineDealer=null,this.catEntryId=null,this.catalogId=a.getCatalogId(),this.availabilityUrl=a.getURLWithContextRoot("VFAjaxProductAvailabilityView"),this.productNotifyMeShopperEmail=a.getURLWithContextRoot("VFAjaxProductNotifyMeShopperEmailView"),this.onlineDealerURL=null,this.firstLoad=null,this.quantity=null,this.tooltipsterObj=null,this.btnOutOfStockText=null,this.styleColorNumberJSON=null,this.isOneSizeProduct=1===u(".attr-size .attr-box-js").length,this.isPreselectedProduct=!1,this.onlineDealersPlugin=this.productForm.find(".online-dealer-js").data("OnlineDealers")||{},this.hasAgeVerification=0<u(".age-verify-js").length,this.productForm.hasClass("first-load-js")?(this.firstLoad=!0,this.productForm.removeClass("first-load-js")):this.firstLoad=!1,this.productForm.removeClass("context-changed-js"),this.productForm.data("avail-url")&&(this.availabilityUrl=a.getURLWithContextRoot(this.productForm.data("avail-url"))),this.isShopTheLook=0<u("body.catalog.bundle, body.catalog.bundle-detail-page-js").length,this.quantity=this.productForm.find(".quantity"),this.$quantityBox=this.productForm.find(".quantity-js"),this.$crossSellItem=u(".cross-sell-step-container");var t=u(".quickview-box-js");0<this.$crossSellItem.length&&0<t.length&&(this.$crossSellItem.find(".cross-sell-link").on("click",this.crossSellToggleContentVisibility.bind(this)),this.$modalCrossSell=u("#pdp-cross-sell-modal"),t.append(this.$modalCrossSell),this.$modalCrossSell.addClass("cross-sell-quick-view-modal"),this.$modalCrossSell.removeClass("reveal"),this.$modalCrossSell.find(".icon-close").on("click",this.crossSellToggleContentVisibility.bind(this)),this.$modalCrossSell.find(".cross-sell-modal--close-button").on("click",this.crossSellToggleContentVisibility.bind(this)))},crossSellToggleContentVisibility:function(t){t.preventDefault(),t.stopPropagation();var i=this;i.$modalCrossSell.slideToggle(function(){var t=u(this),e=i.$modalCrossSell.offset().top;t.is(":visible")&&(t.css("display","inline-block"),e=u(".product-form-js").offset().top),u("html, body, .reveal-overlay:visible").animate({scrollTop:e},500)})},cacheSelectors:function(){this.addToCartButton=this.productForm.find(".add-to-bag-js"),this.addToCartText=this.addToCartButton.text(),this.addToWishlistButton=this.productForm.find(".add-to-wishlist-js"),this.updateItemButton=this.productForm.find(".shopcart-update-js"),this.nonBuyableIndicator=this.productForm.find(".pdp-nonbuyable-js"),this.outOfStockIndicator=this.productForm.find(".pdp-outofstock-js"),this.outOfStockMessageContainer=this.productForm.find(".out-of-stock-js"),this.availableNotifcationSection=this.productForm.find(".available-notification-section-js"),this.formSellingSection=this.productForm.find(".selling-form-section-js"),this.findInStore=u(".find-store-js, .find-in-store-inline-link-js"),this.$findInStoreInlineContainer=u(".find-in-store-container.in-line"),this.$colorSwatches=u(".color-swatches-js .attr-box"),this.$colorLabel=u(".attr-color .attr-primary-name-js .attribute-label-value-js"),this.$fabricLabel=u(".attr-color .sub-attr-name-js .sub-attr-selected-js"),this.isOnlineOnly=this.$colorSwatches.filter(".selected").data("onlineonly"),this.$notHiddenColorSwatches=u(".product-content-form-step-container.step-container.selection-js.attribute-value-selected:not(.hide)").filter(".color-swatches-js .attr-box"),this.stockDisclaimer=this.productForm.find(".stock-availability-disclaimer"),this.isFindInStoreAltDisplay=this.findInStore.data("findInStoreAltDisplay")},initModelMeasurements:function(){var t=u(".model-measurements-text");if(t.length){var e=t.data().measurementsText;if(e&&1!==e.measurements.length){var i=e.measurements.join("<br/>").replace(/&amp;#034;/g,'"').replace(/&amp;#039;/g,"'");t.html(i)}}},initChildren:function(){var e=this;this.productId&&this.initProductAvailability().done(function(t){t&&e.handleAvailabilityResponse(t)})},getGiftRedemptionJSON:function(){var t={},e=a.getContextRoot()+"VFAjaxGiftRedeemAPI",i=this;t.storeId=this.storeId,t.langId=this.langId,t.token=h,t.challenge=n.getURLParam(window.location.href,"challenge"),u.ajax({type:"POST",url:e,data:t,dataType:"json"}).done(function(t){u(".product-form-js").attr("data-gift-redemption",JSON.stringify(t)),i.updateGiftRedeemMessage(t)}).fail(function(t){i.handleRedeemAPIError(t)})},handleRedeemAPIError:function(t){var e=u("#buttonGetEgift").data("view-egift-card-detail-txt"),i=u([".find-store-js",".product-content-info-write-review-link",".product-content-info-see-product-details-link",".product-content-info-rating",".product-content-form-product-form-wrapper section:not(.selling-form-section-js)",".add-to-bag-js",".product-gift-message-available-product-details-container"].join()),s=u(".product-gift-message-unavailable-product-container, .product-gift-action-get-egift-card-js");u(".product-gift-message-unavailable-product-container").text(LANG_MSG.ERR_GIFT_REDEEM_API),i.addClass("hidden"),s.removeClass("hidden"),u(".product-actions-primary").addClass("unavailable"),u(".product-gift-action-get-egift-card-js").removeClass("secondary").addClass("primary unavailable redeem-as-gift-api-error").text(e)},updateGiftRedeemMessage:function(t){var e=u(".product-gift-message-available-product-details-container").data("redeem-gift-available-msg"),i=u(".product-gift-message-unavailable-product-container").data("redeem-gift-uanavailable-msg"),s=t.egc.message.from?t.egc.message.from:"";e=e.replace("{0}",s),u(".product-gift-message-available-product-text").text(e),i=i.replace("{0}",s),u(".product-gift-message-unavailable-product-container").html(i)},unbindSharedProductFormEvents:function(){this.$quantityBox.off("keyup"),u.pubsub("unsubscribe",this.newColorWayProductEvent),u.pubsub("unsubscribe",this.newColorWayProductFormUpdateEvent),u.pubsub("unsubscribe",this.productFormMouseLeaveEvent),u.pubsub("unsubscribe",this.productFormAttributeChangeCompleteEvent),u.pubsub("unsubscribe",this.productAvailabilityAllSetEvent),u.pubsub("unsubscribe",this.productContentSizeRenderCompleteEvent)},initSharedProductFormEvents:function(){var i=this;u(document).on("closed","#modal, .quickview-modal","[data-reveal]",function(t){i.unbindSharedProductFormEvents()}),this.firstLoad&&this.addToWishlistButton.on("click",function(t){i.addToWishList(t),i.addToWishListMessaging(t)}),u.pubsub("subscribe","STICKYCART.WISHLIST.CLICKED",function(t,e){i.addToWishList(t,e)}),WCS_CONFIG.get("PDP::ROBISEnabled")||u(".find-store-js, .find-in-store-inline-link-js").on("click",function(){i.checkAllAttributeSelection()}),this.$quantityBox.on("keyup",this.handleQuantityTextFieldInputChange),i.formServerUpdate=WCS_CONFIG.get("PDP::pdpFormServerUpdateEnabled"),this.newColorWayProductEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.NEW",function(t,e){i.colorWayEventData=e,i.handleColorChange(e,!i.formServerUpdate)}),this.newColorWayProductFormUpdateEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.FORM_UPDATE",function(t,e){i.productForm=u(e.updatedForm),i.handleColorChange(i.colorWayEventData,!0)}),this.productFormMouseLeaveEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",function(){i.initProductAvailability()}),this.productFormResolveQuantityEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.RESOLVEQUANTITY",function(t,e){e===i.productFormIndex&&i.resolveQuantity()}),this.productFormAttributeChangeCompleteEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",function(t,e){e.formIndex===i.productFormIndex&&(i.handleAttributeChangeComplete(e),i.initModelMeasurements()),!e.originateFromClick&&"change"!=e.eventType||i.isOnlineOnly||this.findInStoreAltDisplay||i.findInStore.removeClass("disabled").removeClass("hide")}),this.productAvailabilityAllSetEvent||(this.productAvailabilityAllSetEvent=u.pubsub("subscribe","WCS.PRODUCT_AVAILABILITY.ALL_AVAILABLE_SET",function(t,e){e===i.productFormIndex&&i.handleProductAvailabilityAllSet()})),this.stickyCartQuantityKeyUp=u.pubsub("subscribe","WCS.PRODUCTFORM.QUANTITY.KEYUP",function(t,e){i.handleQuantityTextFieldInputChange(e)}),(C=(!0!==this.firstLoad&&!this.productForm.hasClass("context-changed-js")||!0===this.firstLoad&&0<u(".stock-availability-disclaimer").length)&&i.isPDPSwatches&&!u(".context-trigger-js").length)&&(this.productContentSizeRenderCompleteEvent=u.pubsub("subscribe","product-content-size.attribute.render.finished",function(){i.enableAddToCartButton()})),this.checkAllAttributeSelectionEvent=u.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHECK",function(t){i.checkAllAttributeSelection()}),this.lastSelectedSizeEvent=u.pubsub("subscribe","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.SIZESELECTED",function(t,e){i.lastSelectedWidthValue=e.lastSelectedWidthValue})},handleColorChange:function(t,e){t.formIndex===this.productFormIndex&&(C&&this.disableAddToCartButton(),this.formServerUpdate&&!e||this.initProductFormCore())},handleQuantityTextFieldInputChange:function(t){var e=t.originalEvent?this:t,i=e.value,s=u(e).parents().find(".invalid-quantity-error-js");/^[1-9][0-9]*$/.test(i)?(s.addClass("hide"),u.pubsub("publish","WCS.PRODUCTFORM.QUANTITY.ERROR","hide")):(e.value="",s.removeClass("hide"),u.pubsub("publish","WCS.PRODUCTFORM.QUANTITY.ERROR","show"))},initAttributeValues:function(){var e=this;this.$attributes.each(function(){var t=u(this);t.find("[data-attribute-value]").each(function(){e.productAvailability.addAttributeValue(u.productFormUtil.attributeName(t),u.productFormUtil.attributeValue(u(this)))})})},initPreselectedValues:function(){var e=this;this.$attributes.each(function(){var t=u(this);e.productAvailability.select(u.productFormUtil.attributeName(t),u.productFormUtil.attributeValue(t.find(".selected"))),u.productFormUtil.attributeValue(t.find(".selected"))?(t.addClass("attribute-value-selected"),e.isPreselectedProduct=!0):e.isPreselectedProduct=!1}),this.stateManager&&this.stateManager.setProperty({isPreselectedProduct:this.isPreselectedProduct}),u.pubsub("publish","WCS.PRODUCTFORM.PRESELECTED_VALUES.INIT",e.isPreselectedProduct)},handleAttrFirstLoad:function(){this.firstLoad&&(this.setupAttrValueMap(),u(".quickview-box-js")||(u(".pdp-swatches .attr-color .selected").addClass("clicked"),u(".pdp-swatches .attr-size .selected").addClass("clicked")))},initProductAvailability:function(){this.productAvailability=new o(this.productFormIndex);var e=this,i=u.Deferred(),t=this.$notHiddenColorSwatches.filter(".selected").data();return this.initAttributeValues(),this.handleAttrFirstLoad(),this.initPreselectedValues(),u(".full-attr-color-select").length&&t&&(this.$colorLabel.html(t.attributeValue),this.$fabricLabel.html(t.subAttributeValue)),null!==this.styleColorNumberJSON&&u(".full-attr-color-select").length&&this.setStyleColorNumber(this.styleColorNumberJSON),this.productAvailability.onChange(this,this.handleAvailabilityChange),(this.isColorWayBundle||this.isDrawer||S)&&(this.productAvailJSON=null),S&&(this.productId=u("input[name=catEntryId]").val()),this.productAvailJSON?this.handleAvailabilityResponse(this.productAvailJSON):e._initialAvailabilityFetched?e.makeAvailabilityAjaxCall(i):(e._initialAvailabilityFetched=!0,l.done(function(t){e.handleSuccess(t,i)}).fail(function(t){e.makeAvailabilityAjaxCall(i)})),i.promise()},makeAvailabilityAjaxCall:function(e){var i=this;u.ajax({url:i.availabilityUrl,data:{storeId:i.storeId,langId:i.langId,productId:i.productId},context:this,async:!1}).done(function(t){i.handleSuccess(t,e)})},handleSuccess:function(t,e){t.hasOwnProperty("stock")&&this.stateManager.setProperty({pdpStock:t.stock}),t.hasOwnProperty("upcs")&&this.stateManager.setProperty({upcs:t.upcs}),e.resolve(t)},setBuyableFlag:function(t){return"false"==t.buyable?(this.hideFormSectionsForNotBuyable(),!1):(this.nonBuyableIndicator.addClass("hide"),!0)},hideFormSectionsForNotBuyable:function(){this.formSellingSection.each(function(){u(this).addClass("hide")}),this.outOfStockIndicator.addClass("hide"),this.nonBuyableIndicator.removeClass("hide")},handleInventoryData:function(t){this.outOfStockMessageContainer.addClass("hide"),this.hasInventory(t)?this.handleInStockInventoryDataReturn():this.handleOutOfStockInventoryDataReturn(t.availabilityDate,t.formattedAvailMonth)},hasInventory:function(e){return I=!0,!!e.stock&&Object.keys(e.stock).some(function(t){if(0<e.stock[t])return!(I=!1)})},handleInStockInventoryDataReturn:function(){p&&u(".product-gift-message-available-product-details-container").removeClass("hidden"),this.availableNotifcationSection.addClass("hide"),this.outOfStockIndicator.addClass("hide"),this.formSellingSection.each(function(){u(this).removeClass("hide")})},handleOutOfStockInventoryDataReturn:function(t,e){var i=u.trim(t),s=""!==i?new Date(i):null,a=new Date;if(WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")&&this.hideSellingFormSections(),p&&this.handleRedeemGiftForOutOfStock(),null!==s&&a<s)return u("#product-availability-date",this.productForm).text(u.trim(e)),this.availableNotifcationSection.removeClass("hide"),void this.outOfStockIndicator.addClass("hide");WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")&&this.outOfStockIndicator.removeClass("hide"),this.availableNotifcationSection.addClass("hide")},handleRedeemGiftForOutOfStock:function(){var t=u("#buttonGetEgift").data("view-egift-card-detail-txt"),e=u(".find-store-js, .product-content-info-write-review-link, .product-content-info-see-product-details-link, .product-content-info-rating, .product-content-form-product-form-wrapper section:not(.selling-form-section-js), .add-to-bag-js"),i=u(".product-gift-message-unavailable-product-container, .product-gift-action-get-egift-card-js");e.addClass("hidden"),i.removeClass("hidden"),u(".product-actions-primary").addClass("unavailable"),u(".product-gift-action-get-egift-card-js").removeClass("secondary").addClass("primary unavailable").text(t)},hideSellingFormSections:function(){this.formSellingSection.each(function(){u(this).hasClass("disable-inventory-hide-js")||u(this).addClass("hide")})},handleAvailabilityResponse:function(t){var e=this.setBuyableFlag(t),i=t.crossSellItemStock;if(e){if(this.productAvailJSON=t,this.productAvailJSON&&this.productAvailJSON.attributes&&(this.styleColorNumberJSON=this.productAvailJSON.attributes.STYLE_COLOR_NUMBER),!0===this.firstLoad||this.productForm.hasClass("context-changed-js")||(this.rebuildSizeOptions(t),this.productForm.addClass("context-changed-js")),!0===this.firstLoad&&0<u(".stock-availability-disclaimer").length&&this.rebuildSizeOptions(t),t.availablePromotions&&(this.isDrawer||this.isColorWayBundle||T)&&this.setPromotionContainerHTML(t.availablePromotions),this.handleProductExcludedMessaging(t.exclusionMessage),productNMWA="true"===t.productNotifyMeWhenAvailable,this.handleInventoryData(t),d.setProductAvailabilityJSON(t),!t.stock)return this.productAvailability.update(),void this.resolveItemAndResetButtons();this.parseAvailabilityDataReturn(t),this.initPreselectedValues(),t.productPartNumber&&this.productForm.data("product-part-number",t.productPartNumber),i&&this.updateCrossSellItem(i)}},rebuildSizeOptions:function(t){var e,i,s;i=u(".attr-input-js option, .attr-size .attr-box",this.productForm),this.$parentSection=i.parents(".step-container.selection-js"),this.$visibleParentSections=this.$parentSection.filter(":visible"),this.$parentSection=0<this.$visibleParentSections.length?this.$visibleParentSections:this.$parentSection,s=this.$parentSection.attr("data-attribute-id"),e=t.attributes[s],stock=t.stock,this.isPDPSwatches&&!u(".context-trigger-js").length?this.parseSizeOptionsForPDPSwatches(e,stock):this.parseSizeOptionsForNonPDPSwatches(e,stock),u(".step-container.selection-js").removeClass("attribute-value-selected"),this.setupAttrValueMap()},parseSizeOptionsForPDPSwatches:function(t,e){if(this.firstLoad||g){u(".attr-size .attr-box, .attr-size .attr-box-js",this.productForm).remove();var i={action:"append",attrSizes:t,attrStock:e,productForm:this.productForm,handleColorway:S,showStockEnabled:y,mixedCategoryProductsDisplayEnabled:g,isOneSizeProduct:this.isOneSizeProduct,notifyMeEnabled:m,template:"html.product-content.size-attribute",loadParameters:{target:".product-content-form-step-container.step-container.attr-size",pluginFN:"productContentSizeAttribute",requireModule:"product-content-size-attribute"}};main.handleBarsModulesInit(i)}u.pubsub("publish","product-form.attr.swatch.changed",{sizes:t,stock:e})},parseSizeOptionsForNonPDPSwatches:function(t,o){var r=this;u("select[id$=attr-size] > option:gt(0)",this.productForm).remove(),t.map(function(t,e){var i=u("<option />");if(i.val(t.display),i.attr("data-attribute-value",t.display),i.text(t.display),0<u(".stock-availability-disclaimer").length){u(".stock-availability-disclaimer").children().hide();var s=t.catentryId[0],a=o[s];i.attr("data-attribute-stock",a)}u(".attr-input-js",r.productForm).append(i)}),u.pubsub("publish","WCS.PRODUCT_FORM.SIZES.PARSE_COMPLETE",t)},parseAvailabilityDataReturn:function(i){var a=this;Object.keys(i.stock).forEach(function(t,e){a.productAvailability.addAvailableItem(t,i.stock[t])}),Object.keys(i.attributes).forEach(function(s,t){i.attributes[s].map(function(i,t){i.catentryId.map(function(t,e){a.productAvailability.addItemAttributeValue(t,s,i.display)})})}),Object.keys(i.partNumbers).forEach(function(t,e){a.productAvailability.addItemPartNumber(t,i.partNumbers[t])}),this.productAvailability.update();var s=WCS_CONFIG.get("PDP::pdpFormUpdateDefaultSelectionL1"),o=WCS_CONFIG.get("PDP::pdpFormUpdateHideOOSL1"),t=u(".step-content-width").find("button:not(.out-of-stock).attr-box.selected.clicked"),e=!0;a.lastSelectedWidthValue&&(e=!1,u(".step-content-width").find('.attr-box[data-attribute-value="'+a.lastSelectedWidthValue+'"]').hasClass("out-of-stock")&&(e=!0));if((0<t.length||!1===e)&&(s=!1),1<Object.keys(this.productAvailability.attributes).length){var r=Object.keys(this.productAvailability.attributes)[0],n=this.productAvailability.attributes[r],d=null,l=!1;Object.keys(n.values).forEach(function(t,e){(d=n.values[t]).available&&!1===l&&!0===s&&(d.defaultSelected=!0,l=!0),!1===d.available&&!0===o&&(d.isHidden=!0),d.setDefault(d.available,d.defaultSelected,d.isHidden)})}this.resolveItemAndResetButtons()},setPromotionContainerHTML:function(t){u(".pdp-drawer .discount-container-js").each(function(){u(this).html(t)}),u.pubsub("publish","WCS.PRODUCT_FORM.PROMO.RENDER.COMPLETE"),e.loadPlugins({name:"wcs.tooltip",selector:".tooltip-js"})},setupAttrValueMap:function(){var i=this;i.$attrValueMap={},i.$attributes.each(function(){var e=u(this);i.$attrValueMap[u.productFormUtil.attributeName(e)]={},e.find("[data-attribute-value]").each(function(){var t=u(this);(i.$attrValueMap[u.productFormUtil.attributeName(e)][u.productFormUtil.attributeValue(t)]=t).siblings().hasClass("large")&&t.addClass("large")})})},handleAttributeChangeComplete:function(t){var e,i;this.productAvailability.select(t.attribute,t.attributeValue),this.productAvailability.update(!0);var s=this.productAvailability.resolveItem(),a=this.productAvailability.resolveItems();if(this.resolveItemAndResetButtons(t.eventType),this.isPDPSwatches&&this.isShopTheLook&&this.checkForOutOfStockSizes(),null!==this.styleColorNumberJSON&&u(".full-attr-color-select").length&&this.setStyleColorNumber(this.styleColorNumberJSON),b&&"false"!==this.productAvailJSON.buyable&&(e=u(".attr-color .selected",this.productForm).attr("data-attribute-value"),i=u(".attr-size .selected",this.productForm).attr("data-attribute-value"),this.onlineDealersPlugin.getProductColorCode(this.productAvailJSON,e,i)),u("#uclw").length&&(this.selectChangeComplete=!0),0<u(".stock-availability-disclaimer").length){var o=t.itemStockAttributeValue||u(".attr-size .selected").attr("data-attribute-stock")||0;this.handleStockAvailabilityMsg(o)}t.originateFromClick&&u.pubsub("publish","vfdp.wcs.product_form.find_locally.product_update",this.state);var r=t.obj.hasClass("clicked");u.pubsub("publish","WCS.PRODUCTFORM.COLOR.ITEM.AVAILABILITY",{quantity:a[s],isClicked:r,itemKey:s})},handleStockAvailabilityMsg:function(t){var e=parseInt(t,10)||0;this.stockDisclaimer.children().hide();for(var i=0;i<this.stockDisclaimerRangesMap.length;i++)if(e>=this.stockDisclaimerRangesMap[i].min&&e<=this.stockDisclaimerRangesMap[i].max){this.stockDisclaimer.children().eq(this.stockDisclaimerRangesMap[i].elementIndex).show();break}},resolveItemAndResetButtons:function(t){var e=0===this.$attributes.not(".attribute-value-selected").filter(":visible").length,i=this.productAvailability.resolveItem();this.isPDPSwatches&&(this.enableAddToCartButton(),this.cleanAddToCartButtonForPDPSwatches()),e&&i?(this.catEntryId=i,u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.EXIST"),this.resolveButtonsForAllAttributesSelected()):e&&!i?(u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.NOT_EXIST"),this.handleSelectionNotExist()):(u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_ALL_SELECTED"),this.resolveButtonsForNotAllAttributesSelected()),this.setAndResolveMaxQuantity(),this.productForm.find(".notify-me-response-js").removeClass("message").html(""),"click"!==t&&"change"!==t||(this.stateManager.setProperty({areAllAttributesSelected:e}).setProperty({selections:this.productAvailability.selections}).setProperty({selectionExists:null!=i}).setProperty({catEntryId:null!=i?i:null}).setProperty({selectionHasInventory:0<this.productAvailability.checkInventory(i)}).setProperty({partNumber:this.productAvailability.getPartNumber(i)}),u.pubsub("publish","WCS.PRODUCTFORM.SELECTION.UPDATED",this.state))},resolveButtonsForAllAttributesSelected:function(){var t=0<this.productAvailability.checkInventory(this.catEntryId);this.setFindInStoreURL(),this.updateCatEntryIdDataAttributesAndHiddenFields(),null!==this.styleColorNumberJSON&&u(".full-attr-color-select").length&&this.setStyleColorNumber(this.styleColorNumberJSON),this.hasAgeVerification&&this.updateAgeVerification(),b&&(c=this.onlineDealersPlugin.getOnlineDealers(this.catEntryId)),t?(u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.HAS_INVENTORY",this.productFormIndex),this.enableAddToCartButtonForInStockSelection()):(u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY",this.catEntryId),this.resolveSelectionForNotHasInventory()),this.stateManager.setProperty({isOnlineOnly:this.isOnlineOnly}).setProperty({catEntryId:this.catEntryId}).setProperty({partNumber:this.productAvailability.getPartNumber(this.catEntryId)}),this.addToWishlistButton.removeClass("disabled"),u.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_message",{formAction:"reset"})},updateCatEntryIdDataAttributesAndHiddenFields:function(){u(".find-store-container-js .find-retail-store-catentryid-js").val(this.catEntryId),this.productForm.data("child-catentry-id",this.catEntryId),this.productForm.data("child-part-number",this.productAvailability.getPartNumber(this.catEntryId))},disableFormErrorMessage:function(){u(".select-size-error-js",this.productForm).addClass("hide"),u(".size-step-container",this.productForm).removeClass("error")},enableAddToCartButtonForInStockSelection:function(){var t=this.addToCartButton.attr("data-add-to-cart-text")||this.addToCartText,e=this.addToCartButton.attr("data-out-of-stock-text")||LANG_MSG.OUT_OF_STOCK,i=this.addToCartButton.attr("data-get-this-gift-text")||LANG_MSG.GET_THIS_GIFT;this.productForm.find(".availability-information").hide(),this.addToCartButton.removeClass("notify-me-active"),void 0!==e&&(p?this.addToCartButton.removeClass("disabled btn-out-of-stock").text(i):this.addToCartButton.removeClass("disabled btn-out-of-stock").text(t)),this.hasAgeVerification?this.updateAgeVerification():(this.addToCartButton.removeClass("disabled hide"),this.updateItemButton.show().removeClass("disabled"),this.productForm.find(".customize-button-js").show()),this.productForm.find(".quantity-text-js")&&this.updateItemButton.show().removeClass("disabled"),this.productForm.is(".authorized-retailer")||this.productForm.find(".find-brand-store-js").hide(),this.productForm.find(".notify-me-button-container-js").addClass("hide"),this.productForm.find(".qty-step-js").removeClass("hide"),this.productForm.find(".out-of-stock-js").addClass("hide")},resolveSelectionForNoInventoryOnPDPSwatchesQuickView:function(t){var e;e=this.addToCartButton.attr("data-qv-out-of-stock"),this.addToCartButton.text(e).addClass("disabled"),this.updateItemButton.addClass("disabled"),this.addToWishlistButton.removeClass("disabled")},getEmailIdThroughServiceCall:function(t){var e="krypto= "+t+"&storeId="+this.storeId;return u.ajax({url:this.productNotifyMeShopperEmail,dataType:"json",method:"GET",processData:!1,data:e,context:this,async:!0})},resolveSelectionForNotHasInventory:function(){var t=this.productForm.closest(".quickview-box-js");if(t.length&&this.isPDPSwatches)this.resolveSelectionForNoInventoryOnPDPSwatchesQuickView(t);else{if(this.updateAddToCartOutOfStockText(),n.hasURLParam(window.location.href,"krypto")){var e=n.getURLParam(window.location.href,"krypto");this.getEmailIdThroughServiceCall(e).complete(function(t){if(t&&t.shopperEmailId){var e={shopperEmailId:t.shopperEmailId};u.pubsub("publish","WCS.PRODUCTFORM.EVENT.NOTIFYME.ACTIVE",e)}})}this.btnOutOfStockText?(this.addToCartButton.text(this.btnOutOfStockText).addClass("btn-out-of-stock"),this.updateNotifyMeAvailabilityDate(),this.updateAddToCartButtonClassesForOutOfStock(),this.addToCartButton.removeClass("hide"),this.productForm.find(".notify-me-button-container-js").addClass("hide"),this.productForm.find(".out-of-stock-js").addClass("hide")):this.updatePDPDrawerAddToCartButtonForOutOfStock()}},setStyleColorNumber:function(t){var e=this.catEntryId,i=this.$attributes.not(".attribute-value-selected").filter(":visible"),s="";if(e&&!i.length)for(var a=0;a<t.length;a++){var o=t[a];if(-1<o.catentryId.indexOf(parseInt(e))){s="("+o.display+")";break}}u(".attr-color .attr-selected-color-identifier").html(s)},updateAddToCartOutOfStockText:function(){var t=this.productAvailJSON.skuNotifyMeWhenAvailable||{};u("#quickview-box").length&&!this.isDrawer&&(this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK),b&&0<c.length?this.btnOutOfStockText=this.addToCartButton.attr("data-bfd-text"):m?Object.keys(t).length&&t.hasOwnProperty(this.catEntryId)?t[this.catEntryId]?this.updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled():this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK:!0===productNMWA?this.updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled():this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK:this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK},updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled:function(){void 0!==this.addToCartButton.attr("data-notify-me-text")?this.btnOutOfStockText=this.addToCartButton.attr("data-notify-me-text"):this.btnOutOfStockText=this.addToCartButton.attr("data-out-of-stock-text"),u(".notify-me-catentryid-js",".pdp-swatches-notify-me-form-js").val(this.catEntryId)},updatePDPDrawerAddToCartButtonForOutOfStock:function(){var t=this;t.addToCartButton.addClass("disabled hide"),t.productForm.find(".find-brand-store-js").show(),t.productForm.find(".customize-button-js").hide(),t.productForm.find(".qty-step-js").addClass("hide"),t.outOfStockMessageContainer.removeClass("hide"),t.productForm.find(".notify-me-button-container-js").removeClass("hide"),i(["wcs.product-form-notify"],function(){t.productForm.closest(".product-content-form").NotifyMe({catEntryId:t.catEntryId})})},updateAddToCartButtonClassesForOutOfStock:function(){b&&0<c.length?(this.addToCartButton.addClass("bfd-active"),this.addToCartButton.removeClass("disabled")):m?this.productAvailJSON.skuNotifyMeWhenAvailable?this.productAvailJSON.skuNotifyMeWhenAvailable[this.catEntryId]?(this.addToCartButton.addClass("notify-me-active"),this.addToCartButton.removeClass("disabled")):(this.updateItemButton.addClass("disabled"),this.addToCartButton.addClass("disabled")):!0===productNMWA?(this.addToCartButton.addClass("notify-me-active"),this.addToCartButton.removeClass("disabled")):(this.updateItemButton.addClass("disabled"),this.addToCartButton.addClass("disabled")):(this.updateItemButton.addClass("disabled"),this.addToCartButton.addClass("disabled")),u.pubsub("publish","WCS.PRODUCTFORM.DISABLE_ADD_TO_CART_BUTTON")},updateNotifyMeAvailabilityDate:function(){var t=this.addToCartButton.attr("data-pdp-available-txt"),e=this.addToCartButton.attr("data-out-of-stock-text"),i=this.addToCartButton.attr("data-product-availability-date");this.btnOutOfStockText===e&&(i?(this.productForm.find(".available").text(t),this.productForm.find(".availability-date").text(i),this.productForm.find(".availability-information").show()):this.productForm.find(".availability-information").hide())},resolveButtonsForNotAllAttributesSelected:function(){this.isColorWayBundle?this.enableAddToCartButton():(this.disableFindInStoreAndAddToWishlist(),this.hideAddToCartButtonForAllItemsOutOfStock(),this.disableAddToCartButtonForNotAllSelected(),this.productForm.find(".notify-me-button-container-js").addClass("hide"),this.isDrawer&&this.updatePDPDrawerLayoutForNotAllSelected(),!0===I&&u.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY",this.catEntryId))},updatePDPDrawerLayoutForNotAllSelected:function(){this.productForm.find(".notify-me-button-container-js").addClass("hide"),this.productForm.find(".customize-button-js").show(),this.productForm.find(".find-brand-store-js").hide()},hideAddToCartButtonForAllItemsOutOfStock:function(){WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")&&this.productAvailJSON&&!this.hasInventory(this.productAvailJSON)?(this.addToCartButton.addClass("hide"),this.outOfStockMessageContainer.removeClass("hide")):this.productAvailJSON&&!this.hasInventory(this.productAvailJSON)?this.disableAddToCartButtonAndSetTextToOutOfStock():this.addToCartButton.removeClass("hide")},disableAddToCartButtonForNotAllSelected:function(){if(0,this.addToCartButton.hasClass("disabled")||this.isPDPSwatches||this.isDrawer||this.addToCartButton.addClass("disabled"),!this.addToCartButton.hasClass("disabled")&&this.isPDPSwatches){var t=this.addToCartButton.data("add-to-cart-text");p&&(t=this.addToCartButton.data("get-this-gift-text")),this.addToCartButton.removeClass("bfd-active").removeClass("notify-me-active").text(t),this.productForm.find(".availability-information").hide()}this.updateItemButton.addClass("disabled")},handleSelectionNotExist:function(){this.disableAddToCartButtonAndSetTextToOutOfStock(),0<this.$attributes.length?(this.catEntryId=null,this.disableFindInStoreAndAddToWishlist()):this.catEntryId=this.productId},disableFindInStoreAndAddToWishlist:function(){this.isOnlineOnly?this.findInStore.addClass("hide"):(this.findInStore.removeClass("hide"),this.isFindInStoreAltDisplay||this.findInStore.addClass("disabled"));var e=this;if(0<this.$findInStoreInlineContainer.length){var t=u(".in-line .find-store-container-js");0<t.length&&!t.hasClass("hide")&&(t.addClass("hide"),i(["wcs.find-in-store-util"],function(t){t.closeFindInStoreContainer(e.$findInStoreInlineContainer)})),this.isOnlineOnly?this.findInStore.addClass("hide"):this.findInStore.addClass("disabled").removeClass("hide")}this.addToWishlistButton.addClass("disabled")},enableAddToCartButton:function(){var i=this,s=i.addToCartButton.data("add-to-cart-text")||i.addToCartText,a=i.addToCartButton.data("out-of-stock-text")||LANG_MSG.OUT_OF_STOCK,o=i.addToCartButton.data("get-this-gift-text")||LANG_MSG.GET_THIS_GIFT;u(".attr-size").each(function(t,e){u(this).hasClass("attribute-value-selected")||void 0!==a&&(p?i.addToCartButton.removeClass("disabled").text(o):i.addToCartButton.removeClass("disabled").text(s))}),this.isColorWayBundle&&this.addToCartButton.removeClass("disabled")},cleanAddToCartButtonForPDPSwatches:function(){this.addToCartButton.removeClass("notify-me-active"),this.addToCartButton.removeClass("bfd-active")},updateAgeVerification:function(){u(".age-verify-js").prop("checked")?(u(".age-verify .add-to-bag-js").removeClass("disabled"),this.addToCartButton.hasClass("btn-out-of-stock")&&!this.addToCartButton.is(":visible")||u.pubsub("publish","WCS.PRODUCTFORM.AGE_VERIFICATION.UPDATE",{isAgeVerified:!0})):(u(".age-verify .add-to-bag-js").addClass("disabled"),u.pubsub("publish","WCS.PRODUCTFORM.AGE_VERIFICATION.UPDATE",{isAgeVerified:!1}))},disableAddToCartButton:function(){this.addToCartButton.addClass("disabled btn-out-of-stock"),this.updateItemButton.addClass("disabled")},disableAddToCartButtonAndSetTextToOutOfStock:function(){if(0,this.addToCartButton.data("force-notify-me")){var t=this.addToCartButton.data("notify-me-text")||this.addToCartButton.data("out-of-stock-text");this.addToCartButton.text(t),this.addToCartButton.addClass("notify-me-active")}else{var e=LANG_MSG.OUT_OF_STOCK;this.addToCartButton.text(e),this.disableAddToCartButton()}},setAndResolveMaxQuantity:function(){var t=this.productForm.find(".quantity-js").attr("data-max-qty");this.resolveQuantity(this.catEntryId,t)},setFindInStoreURL:function(){var t="ProductDisplay?catalogId="+a.getCatalogId()+"&storeId="+a.getStoreId()+"&productId="+this.catEntryId+"&langId="+a.getLangId()+"&errorViewName=ProductDisplayErrorView&urlLangId="+a.getLangId()+"#action=findInStore";u(".find-store-url-js").attr("href",t),0<this.$findInStoreInlineContainer.length&&(this.isOnlineOnly||this.findInStore.removeClass("hide").removeClass("disabled"))},handleAvailabilityChange:function(t,e,i,s,a){var o,r;(o=this.$attrValueMap[t])&&(r=o[e])&&(i?this.enableAttribute(r):this.disableAttribute(r),!0===a&&r.addClass("hide"),!0===s&&(r.addClass("clicked"),r.addClass("selected")))},enableAttribute:function(t){t.removeClass("out-of-stock hide").prop("disabled",!1).removeProp("disabled")},disableAttribute:function(t){WCS_CONFIG.get("PDP::pdpShowOutOfStockSizesWhenNotifyMeNotPresent")&&!1===productNMWA||WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")||!0===productNMWA?(t.addClass("out-of-stock"),WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")&&t.prop("disabled",!0)):t.remove(),this.isPDPSwatches&&!this.isShopTheLook||this.addOutOfStockMessageToSelectDropDowns()},addOutOfStockMessageToSelectDropDowns:function(){"undefined"!=typeof outOfStock&&productNMWA||WCS_CONFIG.PDP.pdpShowOOSInSizeDropDown?(u("#attr-size > option").each(function(){u("#attr-size option[value='"+this.value+"']").text(this.value)}),u("#attr-size option[class*=out-of-stock]").append(" "+outOfStock)):productNMWA||WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")||u("#attr-size option[class*=out-of-stock]").addClass("hide")},checkForOutOfStockSizes:function(){var t=this.productForm.find("#attr-size > option:selected").hasClass("out-of-stock");this.productForm.find("#attr-size > option").length-1!==this.productForm.find("#attr-size > option.out-of-stock").length&&!t||this.disableAddToCartButtonAndSetTextToOutOfStock()},handleProductAvailabilityAllSet:function(){this.productForm.find(".product-content-form-size-step-attr-size").removeClass("disabled").prop("disabled",!1),this.productForm.find(".inventory-loading-message-js").addClass("hidden"),this.stateManager.setProperty({isOneSizeProduct:this.isOneSizeProduct}).setProperty({isPreselectedProduct:this.isPreselectedProduct}).setProperty({catEntryId:this.catEntryId}).setProperty({partNumber:this.productAvailability.getPartNumber(this.catEntryId)})},checkAllAttributeSelection:function(){var t=this.$attributes.not(".attribute-value-selected").filter(":visible");return t.length?(this.isPDPSwatches&&!O&&this.handlePDPSwatchesUnselecteds(t),(0<u("#attr-size",this.productForm).length||O)&&(0<t.length&&t.each(function(t,e){u(e).find(".select-size-error-js").removeClass("hide")}),u(".size-step-container",this.productForm).addClass("error"))):(u(".select-size-error-js",this.productForm).addClass("hide"),u(".size-step-container",this.productForm).removeClass("error")),u.pubsub("publish","PDP_ADD_TO_CART_UNSELECTED_SIZES",{unselectedSizes:t}),u.productFormUtil.showHideQuantityErrorMessage(this.productForm),!Boolean(t.length)},renderSwatchUnselectedToolTips:function(t){var e=this;t.each(function(t){e.initUnselectedToolTips(this,t)}).tooltipster("show",function(){t.one("mouseout click hover mouseover",function(t){u(this).closest(".tooltip-js").tooltipster("hide")}),t.find(".attr-box").one("click",function(t){u(this).closest(".tooltip-js").tooltipster("disable")}),u(document).one("closed.zf.reveal","[data-reveal]",function(){t.data("tooltipster-ns")&&t.tooltipster("disable")})})},handlePDPSwatchesUnselecteds:function(t){var e=this;return 0<u(".selection-js.tooltip-js").length&&u("html, body").animate({scrollTop:t.first().offset().top-t.first().outerHeight()},700,function(){e.renderSwatchUnselectedToolTips(t)}),!1},isValidForm:function(){return!!this.checkAllAttributeSelection()&&(!!u.productFormUtil.isValidQuantity(this.productForm)||(this.handleProductFormInvalidQuantity(),!1))},handleProductExcludedMessaging:function(t){u(".promo-excluded-message").text(t||"")},handleProductFormInvalidQuantity:function(){this.productForm.find(".quantity .invalid-quantity-error-js",this.productForm).removeClass("hide")},submitForm:function(t,e,i){WCS_CONFIG.get("global::useCustomLoadingNotification")||r.showLoadingNotification("p"),u.ajax({type:"POST",url:e,data:t,dataType:"json"}).always(function(){WCS_CONFIG.get("global::useCustomLoadingNotification")||r.hideLoadingNotification()}).done(i)},initUnselectedToolTips:function(t,e){var i,s=u(t),a=s.attr("title"),o=0===e?"top-left":"bottom-left",r=s.offset().top-s.find(".attr-container-js").offset().top;s.closest(".reveal").length&&(r=isNaN(r)?r:r+parseInt(u("html").css("top"),10)),a&&(s.data("tooltipster-ns")&&s.tooltipster("destroy"),i=0<=a.indexOf("icon-error")?a:'<span class="pdp-error-icon icon-error"></span><span class="error-message">'+a+"</span>",s.tooltipster({contentAsHTML:!0,content:i,animation:"fade",position:o,trigger:"custom",interactive:!1,theme:"tooltipster-pdp-swatch",offsetY:r}),a&&s.attr("title",a))},resolveQuantity:function(t,e){this.isPDPSwatches&&!this.isShopTheLook?this._resolvePDPSwatchesQuantity():(this.resolveItem=t,this.maxQuantity=e||5,this._resolveQuantitySelect())},_resolvePDPSwatchesQuantity:function(){var t=this;""!==t.$quantityBox.attr("data-default-qty")&&(t.$quantityBox.find("option").each(function(){u(this).val()==t.$quantityBox.attr("data-default-qty")&&(u(this).prop("selected","selected"),u(this).trigger("updateSkin"))}),t.$quantityBox.attr("data-default-qty",""))},_resolveQuantitySelect:function(){var t,e,i,s,a=WCS_CONFIG.get("checkout::checkoutShopcartSaveForLaterEnabled")&&0!==this.productForm.find("input[name=sflItemId]").length;t=this.$quantityBox.find("option").length-1,t-=this.$quantityBox.find('option[value="0"]').length,i=this.productAvailability.checkInventory(this.resolveItem),s=0===(e=a?this.maxQuantity:i)?0:Math.abs(t-e),this.$quantityBox.removeClass("disabled"),void 0===this.resolveItem?this.$quantityBox.find("option:gt(0)").remove():s&&s!=t||t<e?(this.$quantityBox.find("option:gt(0)").remove(),this.$quantityBox.append(u.productFormUtil.generateQuantityOptions(e,this.maxQuantity))):e<1&&(this.$quantityBox.find("option:gt(0)").remove(),this.$quantityBox.addClass("disabled"),this.$quantityBox.append(u.productFormUtil.generateQuantityOptions(e,this.maxQuantity))),this.$quantityBox.data("ui-listener")&&this.$quantityBox.next(".ui-select").trigger(this.$quantityBox.data("ui-listener"))},updateCrossSellItem:function(t){t[this.$crossSellItem.find(".cross-sell-checkbox").val()]<=0?this.$crossSellItem.addClass("hide"):this.$crossSellItem.removeClass("hide")}},A});
//# sourceMappingURL=../../../../maps/js/wcs/view/product-form/product-form-core-logic.hash-0056de3dc83ddd84ae2f9fa97c1a6eb0.js.map