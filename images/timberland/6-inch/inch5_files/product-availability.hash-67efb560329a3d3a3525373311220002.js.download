define(["wcs.find-in-store-model","pubsub"],function(t){var a,u,e=function(t){return this instanceof e?(this.attributes={},this.availableItems={},this.selections={},this.subscribers=[],this.partNumbers={},this.parentProductFormIndex=t,this):new e};return(a=function(t,e){this.parent=t,this.name=e,this.values={}}).prototype={name:null,values:{},onChange:function(t,e,i,s){this.parent.fireChange(this.name,t,e,i,s)}},(u=function(t,e){this.parent=t,this.value=e,this.items={}}).prototype={available:null,defaultSelected:null,isHidden:null,setAvailable:function(t){var e=this.available!==t;this.available=t,e&&this.parent.onChange(this.value,t,this.defaultSelected,this.isHidden)},setDefault:function(t,e,i){this.parent.onChange(this.value,t,e,i)}},e.prototype={addAvailableItem:function(t,e){this.availableItems[t]=e},addAttributeValue:function(t,e){this.addItemAttributeValue(null,t,e)},addItemAttributeValue:function(t,e,i){var s,n;(s=this.attributes[e])||(s=new a(this,e),this.attributes[e]=s),(n=s.values[i])||(n=new u(s,i),s.values[i]=n),t&&(n.items[t]=t)},addItemPartNumber:function(t,e){this.partNumbers[t]=e},onChange:function(t,e){"function"==typeof t&&(e=t,t=this),this.subscribers.push({context:t,fn:e})},fireChange:function(i,s,n,a,u){var r,l=this;Object.keys(l.subscribers).forEach(function(t,e){(r=l.subscribers[e]).fn.apply(r.context,[i,s,n,a,u])})},isAvailable:function(t,e){var i,s;return!!(i=this.attributes[t])&&(!!(s=i.values[e])&&!0===s.available)},select:function(t,e){void 0!==e&&(this.selections[t]=e)},resolveItems:function(e,i){var s,n,a,u,r=this;return e=e||this.selections,s=this.availableItems,t.setProductSelection(e),Object.keys(e).map(function(t){return t in r.attributes&&(n=r.attributes[t],!!(a=n.values[e[t]])&&(u={},Object.keys(a.items).forEach(function(t){s.hasOwnProperty(t)&&(!i||0<s[t])&&(u[t]=s[t])}),void(s=u)))}),s},resolveItem:function(t){var e,i,s,n=0;for(s in t=t||this.selections)++n;if(0<n)for(i in e=this.resolveItems(t,!1))if(e.hasOwnProperty(i))return i;return null},checkInventory:function(t){return t?this.availableItems[t]:0},getPartNumber:function(t){return t?this.partNumbers[t]:null},update:function(i){var s,n,a,u,r,l=this;Object.keys(l.attributes).forEach(function(e){n={},Object.keys(l.attributes).forEach(function(t){e!==t&&l.selections[t]&&(n[t]=l.selections[t])}),s=l.resolveItems(n,!0),a=l.attributes[e],Object.keys(a.values).forEach(function(t){u=a.values[t],r=Object.keys(u.items).some(function(t){return s[t]}),!0===i&&(u.defaultSelected=!1),u.setAvailable(r)}),$.pubsub("publish","WCS.PRODUCT_AVAILABILITY.ALL_AVAILABLE_SET",l.parentProductFormIndex),0})}},e});
//# sourceMappingURL=../../../maps/js/wcs/util/product-availability.hash-6429c42414bfbd1362ad818eb02a815d.js.map