/*!************************************************************************
* Portions copyright (c) 2016 Adobe Systems Incorporated
**************************************************************************/
(function(a){a.pkg("s7sdk.libs.hls");(function(b){a.Hls=b()})(function(){return(function(b){var c={};function d(f){if(c[f]){return c[f].exports}var e=c[f]={i:f,l:false,exports:{}};b[f].call(e.exports,e,e.exports,d);e.l=true;return e.exports}d.m=b;d.c=c;d.d=function(f,g,e){if(!d.o(f,g)){Object.defineProperty(f,g,{configurable:false,enumerable:true,get:e})}};d.n=function(f){var e=f&&f.__esModule?function g(){return f["default"]}:function h(){return f};d.d(e,"a",e);return e};d.o=function(e,f){return Object.prototype.hasOwnProperty.call(e,f)};d.p="/dist/";return d(d.s=8)})([(function(d,g,c){c.d(g,"a",function(){return h});c.d(g,"b",function(){return k});var e=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function l(){}var f={trace:l,debug:l,log:l,warn:l,info:l,error:l};var b=f;function m(n,o){o="["+n+"] > "+o;return o}function j(n){var o=self.console[n];if(o){return function(){for(var p=arguments.length,q=Array(p),r=0;r<p;r++){q[r]=arguments[r]}if(q[0]){q[0]=m(n,q[0])}o.apply(self.console,q)}}return l}function i(p){for(var n=arguments.length,q=Array(n>1?n-1:0),o=1;o<n;o++){q[o-1]=arguments[o]}q.forEach(function(r){b[r]=p[r]?p[r].bind(p):j(r)})}var h=function h(n){if(n===true||(typeof n==="undefined"?"undefined":e(n))==="object"){i(n,"debug","log","info","warn","error");try{b.log()}catch(o){b=f}}else{b=f}};var k=b}),(function(b,c,d){c.a=({MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"})}),(function(d,e,f){f.d(e,"b",function(){return c});f.d(e,"a",function(){return b});var c={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"};var b={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}}),(function(c,b){}),(function(d,e,g){function f(h,i){if(!(h instanceof i)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function v(){f(this,v)}v.isHeader=function h(w,x){if(x+10<=w.length){if(w[x]===73&&w[x+1]===68&&w[x+2]===51){if(w[x+3]<255&&w[x+4]<255){if(w[x+6]<128&&w[x+7]<128&&w[x+8]<128&&w[x+9]<128){return true}}}}return false};v.isFooter=function m(w,x){if(x+10<=w.length){if(w[x]===51&&w[x+1]===68&&w[x+2]===73){if(w[x+3]<255&&w[x+4]<255){if(w[x+6]<128&&w[x+7]<128&&w[x+8]<128&&w[x+9]<128){return true}}}}return false};v.getID3Data=function s(z,A){var y=A;var x=0;while(v.isHeader(z,A)){x+=10;var w=v._readSize(z,A+6);x+=w;if(v.isFooter(z,A+10)){x+=10}A+=x}if(x>0){return z.subarray(y,y+x)}return undefined};v._readSize=function r(x,y){var w=0;w=(x[y]&127)<<21;w|=(x[y+1]&127)<<14;w|=(x[y+2]&127)<<7;w|=x[y+3]&127;return w};v.getTimeStamp=function u(x){var z=v.getID3Frames(x);for(var w=0;w<z.length;w++){var y=z[w];if(v.isTimeStampFrame(y)){return v._readTimeStamp(y)}}return undefined};v.isTimeStampFrame=function o(w){return w&&w.key==="PRIV"&&w.info==="com.apple.streaming.transportStreamTimestamp"};v._getFrameData=function k(y){var x=String.fromCharCode(y[0],y[1],y[2],y[3]);var w=v._readSize(y,4);var z=10;return{type:x,size:w,data:y.subarray(z,z+w)}};v.getID3Frames=function i(x){var C=0;var B=[];while(v.isHeader(x,C)){var y=v._readSize(x,C+6);C+=10;var w=C+y;while(C+8<w){var z=v._getFrameData(x.subarray(C));var A=v._decodeFrame(z);if(A){B.push(A)}C+=z.size+10}if(v.isFooter(x,C)){C+=10}}return B};v._decodeFrame=function n(w){if(w.type==="PRIV"){return v._decodePrivFrame(w)}else{if(w.type[0]==="T"){return v._decodeTextFrame(w)}else{if(w.type[0]==="W"){return v._decodeURLFrame(w)}}}return undefined};v._readTimeStamp=function l(z){if(z.data.byteLength===8){var y=new Uint8Array(z.data);var w=y[3]&1;var x=(y[4]<<23)+(y[5]<<15)+(y[6]<<7)+y[7];x/=45;if(w){x+=47721858.84}return Math.round(x)}return undefined};v._decodePrivFrame=function q(y){if(y.size<2){return undefined}var w=v._utf8ArrayToStr(y.data,true);var x=new Uint8Array(y.data.subarray(w.length+1));return{key:y.type,info:w,data:x.buffer}};v._decodeTextFrame=function j(A){if(A.size<2){return undefined}if(A.type==="TXXX"){var w=1;var x=v._utf8ArrayToStr(A.data.subarray(w));w+=x.length+1;var y=v._utf8ArrayToStr(A.data.subarray(w));return{key:A.type,info:x,data:y}}else{var z=v._utf8ArrayToStr(A.data.subarray(1));return{key:A.type,data:z}}};v._decodeURLFrame=function p(A){if(A.type==="WXXX"){if(A.size<2){return undefined}var x=1;var y=v._utf8ArrayToStr(A.data.subarray(x));x+=y.length+1;var z=v._utf8ArrayToStr(A.data.subarray(x));return{key:A.type,info:y,data:z}}else{var w=v._utf8ArrayToStr(A.data);return{key:A.type,data:w}}};v._utf8ArrayToStr=function t(D){var x=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var w=D.length;var C=void 0;var B=void 0;var A=void 0;var y="";var z=0;while(z<w){C=D[z++];if(C===0&&x){return y}else{if(C===0||C===3){continue}}switch(C>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:y+=String.fromCharCode(C);break;case 12:case 13:B=D[z++];y+=String.fromCharCode((C&31)<<6|B&63);break;case 14:B=D[z++];A=D[z++];y+=String.fromCharCode((C&15)<<12|(B&63)<<6|(A&63)<<0);break;default:}}return y};return v}();var b=c._utf8ArrayToStr;e.a=(c)}),(function(f,d){function g(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}f.exports=g;g.EventEmitter=g;g.prototype._events=undefined;g.prototype._maxListeners=undefined;g.defaultMaxListeners=10;g.prototype.setMaxListeners=function(i){if(!e(i)||i<0||isNaN(i)){throw TypeError("n must be a positive number")}this._maxListeners=i;return this};g.prototype.emit=function(o){var q,n,j,k,l,m;if(!this._events){this._events={}}if(o==="error"){if(!this._events.error||(b(this._events.error)&&!this._events.error.length)){q=arguments[1];if(q instanceof Error){throw q}else{var p=new Error('Uncaught, unspecified "error" event. ('+q+")");p.context=q;throw p}}}n=this._events[o];if(c(n)){return false}if(h(n)){switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:k=Array.prototype.slice.call(arguments,1);n.apply(this,k)}}else{if(b(n)){k=Array.prototype.slice.call(arguments,1);m=n.slice();j=m.length;for(l=0;l<j;l++){m[l].apply(this,k)}}}return true};g.prototype.addListener=function(j,k){var i;if(!h(k)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",j,h(k.listener)?k.listener:k)}if(!this._events[j]){this._events[j]=k}else{if(b(this._events[j])){this._events[j].push(k)}else{this._events[j]=[this._events[j],k]}}if(b(this._events[j])&&!this._events[j].warned){if(!c(this._maxListeners)){i=this._maxListeners}else{i=g.defaultMaxListeners}if(i&&i>0&&this._events[j].length>i){this._events[j].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[j].length);if(typeof console.trace==="function"){console.trace()}}}return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(i,k){if(!h(k)){throw TypeError("listener must be a function")}var l=false;function j(){this.removeListener(i,j);if(!l){l=true;k.apply(this,arguments)}}j.listener=k;this.on(i,j);return this};g.prototype.removeListener=function(l,o){var n,j,m,k;if(!h(o)){throw TypeError("listener must be a function")}if(!this._events||!this._events[l]){return this}n=this._events[l];m=n.length;j=-1;if(n===o||(h(n.listener)&&n.listener===o)){delete this._events[l];if(this._events.removeListener){this.emit("removeListener",l,o)}}else{if(b(n)){for(k=m;k-->0;){if(n[k]===o||(n[k].listener&&n[k].listener===o)){j=k;break}}if(j<0){return this}if(n.length===1){n.length=0;delete this._events[l]}else{n.splice(j,1)}if(this._events.removeListener){this.emit("removeListener",l,o)}}}return this};g.prototype.removeAllListeners=function(k){var i,j;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[k]){delete this._events[k]}}return this}if(arguments.length===0){for(i in this._events){if(i==="removeListener"){continue}this.removeAllListeners(i)}this.removeAllListeners("removeListener");this._events={};return this}j=this._events[k];if(h(j)){this.removeListener(k,j)}else{if(j){while(j.length){this.removeListener(k,j[j.length-1])}}}delete this._events[k];return this};g.prototype.listeners=function(j){var i;if(!this._events||!this._events[j]){i=[]}else{if(h(this._events[j])){i=[this._events[j]]}else{i=this._events[j].slice()}}return i};g.prototype.listenerCount=function(i){if(this._events){var j=this._events[i];if(h(j)){return 1}else{if(j){return j.length}}}return 0};g.listenerCount=function(j,i){return j.listenerCount(i)};function h(i){return typeof i==="function"}function e(i){return typeof i==="number"}function b(i){return typeof i==="object"&&i!==null}function c(i){return i===void 0}}),(function(c,b,d){(function(g){var j=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/;var i=/^([^\/;?#]*)(.*)$/;var f=/(?:\/|^)\.(?=\/)/g;var h=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;var e={buildAbsoluteURL:function(l,m,k){k=k||{};l=l.trim();m=m.trim();if(!m){if(!k.alwaysNormalize){return l}var o=this.parseURL(l);if(!q){throw new Error("Error trying to parse base URL.")}o.path=e.normalizePath(o.path);return e.buildURLFromParts(o)}var s=this.parseURL(m);if(!s){throw new Error("Error trying to parse relative URL.")}if(s.scheme){if(!k.alwaysNormalize){return m}s.path=e.normalizePath(s.path);return e.buildURLFromParts(s)}var q=this.parseURL(l);if(!q){throw new Error("Error trying to parse base URL.")}if(!q.netLoc&&q.path&&q.path[0]!=="/"){var t=i.exec(q.path);q.netLoc=t[1];q.path=t[2]}if(q.netLoc&&!q.path){q.path="/"}var n={scheme:q.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc){n.netLoc=q.netLoc;if(s.path[0]!=="/"){if(!s.path){n.path=q.path;if(!s.params){n.params=q.params;if(!s.query){n.query=q.query}}}else{var r=q.path;var p=r.substring(0,r.lastIndexOf("/")+1)+s.path;n.path=e.normalizePath(p)}}}if(n.path===null){n.path=k.alwaysNormalize?e.normalizePath(s.path):s.path}return e.buildURLFromParts(n)},parseURL:function(k){var l=j.exec(k);if(!l){return null}return{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}},normalizePath:function(k){k=k.split("").reverse().join("").replace(f,"");while(k.length!==(k=k.replace(h,"")).length){}return k.split("").reverse().join("")},buildURLFromParts:function(k){return k.scheme+k.netLoc+k.path+k.params+k.query+k.fragment}};if(true){c.exports=e}else{if(typeof define==="function"&&define.amd){define([],function(){return e})}else{if(typeof b==="object"){b.URLToolkit=e}else{g.URLToolkit=e}}}})(this)}),(function(f,ad,p){var O=p(1);var I=p(2);function ac(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var z=function(){function av(aw,ax){ac(this,av);this.subtle=aw;this.aesIV=ax}av.prototype.decrypt=function au(ax,aw){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},aw,ax)};return av}();var at=(z);function A(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var ar=function(){function au(aw,ax){A(this,au);this.subtle=aw;this.key=ax}au.prototype.expandKey=function av(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},false,["encrypt","decrypt"])};return au}();var x=(ar);function aj(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var y=function(){function aA(){aj(this,aA);this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}aA.prototype.uint8ArrayToUint32Array_=function az(aE){var aC=new DataView(aE);var aB=new Uint32Array(4);for(var aD=0;aD<4;aD++){aB[aD]=aC.getUint32(aD*4)}return aB};aA.prototype.initTable=function ax(){var aV=this.sBox;var aB=this.invSBox;var aM=this.subMix;var aT=aM[0];var aQ=aM[1];var aP=aM[2];var aN=aM[3];var aD=this.invSubMix;var aL=aD[0];var aJ=aD[1];var aH=aD[2];var aG=aD[3];var aU=new Uint32Array(256);var aC=0;var aI=0;var aR=0;for(aR=0;aR<256;aR++){if(aR<128){aU[aR]=aR<<1}else{aU[aR]=aR<<1^283}}for(aR=0;aR<256;aR++){var aF=aI^aI<<1^aI<<2^aI<<3^aI<<4;aF=aF>>>8^aF&255^99;aV[aC]=aF;aB[aF]=aC;var aS=aU[aC];var aO=aU[aS];var aK=aU[aO];var aE=aU[aF]*257^aF*16843008;aT[aC]=aE<<24|aE>>>8;aQ[aC]=aE<<16|aE>>>16;aP[aC]=aE<<8|aE>>>24;aN[aC]=aE;aE=aK*16843009^aO*65537^aS*257^aC*16843008;aL[aF]=aE<<24|aE>>>8;aJ[aF]=aE<<16|aE>>>16;aH[aF]=aE<<8|aE>>>24;aG[aF]=aE;if(!aC){aC=aI=1}else{aC=aS^aU[aU[aU[aK^aS]]];aI^=aU[aU[aI]]}}};aA.prototype.expandKey=function ay(aD){var aT=this.uint8ArrayToUint32Array_(aD);var aG=true;var aC=0;while(aC<aT.length&&aG){aG=aT[aC]===this.key[aC];aC++}if(aG){return}this.key=aT;var aR=this.keySize=aT.length;if(aR!==4&&aR!==6&&aR!==8){throw new Error("Invalid aes key size="+aR)}var aN=this.ksRows=(aR+6+1)*4;var aO=void 0;var aP=void 0;var aQ=this.keySchedule=new Uint32Array(aN);var aS=this.invKeySchedule=new Uint32Array(aN);var aH=this.sBox;var aB=this.rcon;var aE=this.invSubMix;var aM=aE[0];var aL=aE[1];var aK=aE[2];var aI=aE[3];var aJ=void 0;var aF=void 0;for(aO=0;aO<aN;aO++){if(aO<aR){aJ=aQ[aO]=aT[aO];continue}aF=aJ;if(aO%aR===0){aF=aF<<8|aF>>>24;aF=aH[aF>>>24]<<24|aH[aF>>>16&255]<<16|aH[aF>>>8&255]<<8|aH[aF&255];aF^=aB[aO/aR|0]<<24}else{if(aR>6&&aO%aR===4){aF=aH[aF>>>24]<<24|aH[aF>>>16&255]<<16|aH[aF>>>8&255]<<8|aH[aF&255]}}aQ[aO]=aJ=(aQ[aO-aR]^aF)>>>0}for(aP=0;aP<aN;aP++){aO=aN-aP;if(aP&3){aF=aQ[aO]}else{aF=aQ[aO-4]}if(aP<4||aO<=4){aS[aP]=aF}else{aS[aP]=aM[aH[aF>>>24]]^aL[aH[aF>>>16&255]]^aK[aH[aF>>>8&255]]^aI[aH[aF&255]]}aS[aP]=aS[aP]>>>0}};aA.prototype.networkToHostOrderSwap=function au(aB){return aB<<24|(aB&65280)<<8|(aB&16711680)>>8|aB>>>24};aA.prototype.decrypt=function av(aB,aH,aV){var a0=this.keySize+6;var a7=this.invKeySchedule;var a5=this.invSBox;var aR=this.invSubMix;var aZ=aR[0];var aY=aR[1];var aX=aR[2];var aW=aR[3];var a3=this.uint8ArrayToUint32Array_(aV);var aT=a3[0];var aQ=a3[1];var aN=a3[2];var aK=a3[3];var a4=new Int32Array(aB);var a6=new Int32Array(a4.length);var aP=void 0,aM=void 0,aJ=void 0,aI=void 0;var aF=void 0,aE=void 0,aD=void 0,aC=void 0;var aU=void 0,aS=void 0,aO=void 0,aL=void 0;var a2,a1;var aG=this.networkToHostOrderSwap;while(aH<a4.length){aU=aG(a4[aH]);aS=aG(a4[aH+1]);aO=aG(a4[aH+2]);aL=aG(a4[aH+3]);aF=aU^a7[0];aE=aL^a7[1];aD=aO^a7[2];aC=aS^a7[3];a2=4;for(a1=1;a1<a0;a1++){aP=aZ[aF>>>24]^aY[aE>>16&255]^aX[aD>>8&255]^aW[aC&255]^a7[a2];aM=aZ[aE>>>24]^aY[aD>>16&255]^aX[aC>>8&255]^aW[aF&255]^a7[a2+1];aJ=aZ[aD>>>24]^aY[aC>>16&255]^aX[aF>>8&255]^aW[aE&255]^a7[a2+2];aI=aZ[aC>>>24]^aY[aF>>16&255]^aX[aE>>8&255]^aW[aD&255]^a7[a2+3];aF=aP;aE=aM;aD=aJ;aC=aI;a2=a2+4}aP=a5[aF>>>24]<<24^a5[aE>>16&255]<<16^a5[aD>>8&255]<<8^a5[aC&255]^a7[a2];aM=a5[aE>>>24]<<24^a5[aD>>16&255]<<16^a5[aC>>8&255]<<8^a5[aF&255]^a7[a2+1];aJ=a5[aD>>>24]<<24^a5[aC>>16&255]<<16^a5[aF>>8&255]<<8^a5[aE&255]^a7[a2+2];aI=a5[aC>>>24]<<24^a5[aF>>16&255]<<16^a5[aE>>8&255]<<8^a5[aD&255]^a7[a2+3];a2=a2+3;a6[aH]=aG(aP^aT);a6[aH+1]=aG(aI^aQ);a6[aH+2]=aG(aJ^aN);a6[aH+3]=aG(aM^aK);aT=aU;aQ=aS;aN=aO;aK=aL;aH=aH+4}return a6.buffer};aA.prototype.destroy=function aw(){this.key=undefined;this.keySize=undefined;this.ksRows=undefined;this.sBox=undefined;this.invSBox=undefined;this.subMix=undefined;this.invSubMix=undefined;this.keySchedule=undefined;this.invKeySchedule=undefined;this.rcon=undefined};return aA}();var aq=(y);var S=p(0);function o(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var Y=function(){function ay(aA,aB){o(this,ay);this.observer=aA;this.config=aB;this.logEnabled=true;try{var az=crypto?crypto:self.crypto;this.subtle=az.subtle||az.webkitSubtle}catch(aC){}this.disableWebCrypto=!this.subtle}ay.prototype.isSync=function ax(){return this.disableWebCrypto&&this.config.enableSoftwareAES};ay.prototype.decrypt=function av(aD,aB,aA,aF){var aE=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){if(this.logEnabled){S.b.log("JS AES decrypt");this.logEnabled=false}var aC=this.decryptor;if(!aC){this.decryptor=aC=new aq()}aC.expandKey(aB);aF(aC.decrypt(aD,0,aA))}else{if(this.logEnabled){S.b.log("WebCrypto AES decrypt");this.logEnabled=false}var az=this.subtle;if(this.key!==aB){this.key=aB;this.fastAesKey=new x(az,aB)}this.fastAesKey.expandKey().then(function(aG){var aH=new at(az,aA);aH.decrypt(aD,aG)._catch(function(aI){aE.onWebCryptoError(aI,aD,aB,aA,aF)}).then(function(aI){aF(aI)})})._catch(function(aG){aE.onWebCryptoError(aG,aD,aB,aA,aF)})}};ay.prototype.onWebCryptoError=function au(aB,aC,aA,az,aD){if(this.config.enableSoftwareAES){S.b.log("WebCrypto Error, disable WebCrypto API");this.disableWebCrypto=true;this.logEnabled=true;this.decrypt(aC,aA,az,aD)}else{S.b.error("decrypting error : "+aB.message);this.observer.trigger(Event.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_DECRYPT_ERROR,fatal:true,reason:aB.message})}};ay.prototype.destroy=function aw(){var az=this.decryptor;if(az){az.destroy();this.decryptor=undefined}};return ay}();var l=(Y);function C(aA,ax,aw,aF){var aB,az,ay,av,au,aE=navigator.userAgent.toLowerCase(),aD=aF,aC=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];aB=((ax[aw+2]&192)>>>6)+1;az=(ax[aw+2]&60)>>>2;if(az>aC.length-1){aA.trigger(Event.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+az});return}av=(ax[aw+2]&1)<<2;av|=(ax[aw+3]&192)>>>6;S.b.log("manifest codec:"+aF+",ADTS data:type:"+aB+",sampleingIndex:"+az+"["+aC[az]+"Hz],channelConfig:"+av);if(/firefox/i.test(aE)){if(az>=6){aB=5;au=new Array(4);ay=az-3}else{aB=2;au=new Array(2);ay=az}}else{if(aE.indexOf("android")!==-1){aB=2;au=new Array(2);ay=az}else{aB=5;au=new Array(4);if(aF&&(aF.indexOf("mp4a.40.29")!==-1||aF.indexOf("mp4a.40.5")!==-1)||!aF&&az>=6){ay=az-3}else{if(aF&&aF.indexOf("mp4a.40.2")!==-1&&(az>=6&&av===1||/vivaldi/i.test(aE))||!aF&&av===1){aB=2;au=new Array(2)}ay=az}}}au[0]=aB<<3;au[0]|=(az&14)>>1;au[1]|=(az&1)<<7;au[1]|=av<<3;if(aB===5){au[1]|=(ay&14)>>1;au[2]=(ay&1)<<7;au[2]|=2<<2;au[3]=0}return{config:au,samplerate:aC[az],channelCount:av,codec:"mp4a.40."+aB,manifestCodec:aD}}function n(au,av){return au[av]===255&&(au[av+1]&246)===240}function W(au,av){return !!(au[av+1]&1)?7:9}function H(au,av){return(au[av+3]&3)<<11|au[av+4]<<3|(au[av+5]&224)>>>5}function i(au,av){if(av+1<au.length&&n(au,av)){return true}return false}function B(av,ax){if(ax+1<av.length&&n(av,ax)){var au=W(av,ax);var aw=au;if(ax+5<av.length){aw=H(av,ax)}var ay=ax+aw;if(ay===av.length||ay+1<av.length&&n(av,ay)){return true}}return false}function G(au,av,ax,az,ay){if(!au.samplerate){var aw=C(av,ax,az,ay);au.config=aw.config;au.samplerate=aw.samplerate;au.channelCount=aw.channelCount;au.codec=aw.codec;au.manifestCodec=aw.manifestCodec;S.b.log("parsed codec:"+au.codec+",rate:"+aw.samplerate+",nb channel:"+aw.channelCount)}}function ai(au){return 1024*90000/au}function e(az,ay,aC,ax,au){var aB,aA,av;var aw=az.length;aB=W(az,ay);aA=H(az,ay);aA-=aB;if(aA>0&&ay+aB+aA<=aw){av=aC+ax*au;return{headerLength:aB,frameLength:aA,stamp:av}}return undefined}function al(ax,aA,az,aE,aw){var au=ai(ax.samplerate);var aB=e(aA,az,aE,aw,au);if(aB){var av=aB.stamp;var aD=aB.headerLength;var aC=aB.frameLength;var ay={unit:aA.subarray(az+aD,az+aD+aC),pts:av,dts:av};ax.samples.push(ay);ax.len+=aC;return{sample:ay,length:aC+aD}}return undefined}var X=p(4);function j(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var U=function(){function az(aB,aA,aC){j(this,az);this.observer=aB;this.config=aC;this.remuxer=aA}az.prototype.resetInitSegment=function aw(aD,aC,aA,aB){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:true,samples:[],len:0,manifestCodec:aC,duration:aB,inputTimeScale:90000}};az.prototype.resetTimeStamp=function ax(){};az.probe=function av(aC){if(!aC){return false}var aA=X.a.getID3Data(aC,0)||[];var aD=aA.length;for(var aB=aC.length;aD<aB;aD++){if(B(aC,aD)){S.b.log("ADTS sync word found !");return true}}return false};az.prototype.append=function au(aI,aM,aB,aG){var aF=this._audioTrack;var aL=X.a.getID3Data(aI,0)||[];var aJ=X.a.getTimeStamp(aL);var aN=aJ?90*aJ:aM*90000;var aE=0;var aA=aN;var aD=aI.length;var aH=aL.length;var aK=[{pts:aA,dts:aA,data:aL}];while(aH<aD-1){if(i(aI,aH)&&aH+5<aD){G(aF,this.observer,aI,aH,aF.manifestCodec);var aC=al(aF,aI,aH,aN,aE);if(aC){aH+=aC.length;aA=aC.sample.pts;aE++}else{S.b.log("Unable to parse AAC frame");break}}else{if(X.a.isHeader(aI,aH)){aL=X.a.getID3Data(aI,aH);aK.push({pts:aA,dts:aA,data:aL});aH+=aL.length}else{aH++}}}this.remuxer.remux(aF,{samples:[]},{samples:aK,inputTimeScale:90000},{samples:[]},aM,aB,aG)};az.prototype.destroy=function ay(){};return az}();var aa=(U);function K(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var V=Math.pow(2,32)-1;var h=function(){function aG(aI,aH){K(this,aG);this.observer=aI;this.remuxer=aH}aG.prototype.resetTimeStamp=function aA(aH){this.initPTS=aH};aG.prototype.resetInitSegment=function aw(aM,aL,aI,aK){if(aM&&aM.byteLength){var aH=this.initData=aG.parseInitSegment(aM);if(aL==null){aL="mp4a.40.5"}if(aI==null){aI="avc1.42e01e"}var aJ={};if(aH.audio&&aH.video){aJ.audiovideo={container:"video/mp4",codec:aL+","+aI,initSegment:aK?aM:null}}else{if(aH.audio){aJ.audio={container:"audio/mp4",codec:aL,initSegment:aK?aM:null}}if(aH.video){aJ.video={container:"video/mp4",codec:aI,initSegment:aK?aM:null}}}this.observer.trigger(O.a.FRAG_PARSING_INIT_SEGMENT,{tracks:aJ})}else{if(aL){this.audioCodec=aL}if(aI){this.videoCodec=aI}}};aG.probe=function av(aH){return aG.findBox({data:aH,start:0,end:Math.min(aH.length,16384)},["moof"]).length>0};aG.bin2str=function ay(aH){return String.fromCharCode.apply(null,aH)};aG.readUint32=function aF(aH,aJ){if(aH.data){aJ+=aH.start;aH=aH.data}var aI=aH[aJ]<<24|aH[aJ+1]<<16|aH[aJ+2]<<8|aH[aJ+3];return aI<0?4294967296+aI:aI};aG.writeUint32=function aB(aH,aJ,aI){if(aH.data){aJ+=aH.start;aH=aH.data}aH[aJ]=aI>>24;aH[aJ+1]=aI>>16&255;aH[aJ+2]=aI>>8&255;aH[aJ+3]=aI&255};aG.findBox=function az(aJ,aP){var aK=[],aL,aQ,aM,aI,aO,aH,aN;if(aJ.data){aH=aJ.start;aI=aJ.end;aJ=aJ.data}else{aH=0;aI=aJ.byteLength}if(!aP.length){return null}for(aL=aH;aL<aI;){aQ=aG.readUint32(aJ,aL);aM=aG.bin2str(aJ.subarray(aL+4,aL+8));aN=aQ>1?aL+aQ:aI;if(aM===aP[0]){if(aP.length===1){aK.push({data:aJ,start:aL+8,end:aN})}else{aO=aG.findBox({data:aJ,start:aL+8,end:aN},aP.slice(1));if(aO.length){aK=aK.concat(aO)}}}aL=aN}return aK};aG.parseInitSegment=function aE(aJ){var aH=[];var aI=aG.findBox(aJ,["moov","trak"]);aI.forEach(function(aL){var aN=aG.findBox(aL,["tkhd"])[0];if(aN){var aQ=aN.data[aN.start];var aP=aQ===0?12:20;var aM=aG.readUint32(aN,aP);var aS=aG.findBox(aL,["mdia","mdhd"])[0];if(aS){aQ=aS.data[aS.start];aP=aQ===0?12:20;var aT=aG.readUint32(aS,aP);var aK=aG.findBox(aL,["mdia","hdlr"])[0];if(aK){var aU=aG.bin2str(aK.data.subarray(aK.start+8,aK.start+12));var aR={soun:"audio",vide:"video"}[aU];if(aR){var aV=aG.findBox(aL,["mdia","minf","stbl","stsd"]);if(aV.length){aV=aV[0];var aO=aG.bin2str(aV.data.subarray(aV.start+12,aV.start+16));S.b.log("MP4Demuxer:"+aR+":"+aO+" found")}aH[aM]={timescale:aT,type:aR};aH[aR]={timescale:aT,id:aM}}}}}});return aH};aG.getStartDTS=function ax(aI,aJ){var aL,aK,aH;aL=aG.findBox(aJ,["moof","traf"]);aK=[].concat.apply([],aL.map(function(aM){return aG.findBox(aM,["tfhd"]).map(function(aN){var aQ,aO,aP;aQ=aG.readUint32(aN,4);aO=aI[aQ].timescale||90000;aP=aG.findBox(aM,["tfdt"]).map(function(aT){var aS,aR;aS=aT.data[aT.start];aR=aG.readUint32(aT,4);if(aS===1){aR*=Math.pow(2,32);aR+=aG.readUint32(aT,8)}return aR})[0];return aP/aO})}));aH=Math.min.apply(null,aK);return isFinite(aH)?aH:0};aG.offsetStartDTS=function aC(aI,aJ,aH){aG.findBox(aJ,["moof","traf"]).map(function(aK){return aG.findBox(aK,["tfhd"]).map(function(aL){var aN=aG.readUint32(aL,4);var aM=aI[aN].timescale||90000;aG.findBox(aK,["tfdt"]).map(function(aS){var aO=aS.data[aS.start];var aR=aG.readUint32(aS,4);if(aO===0){aG.writeUint32(aS,4,aR-aH*aM)}else{aR*=Math.pow(2,32);aR+=aG.readUint32(aS,8);aR-=aH*aM;aR=Math.max(aR,0);var aQ=Math.floor(aR/(V+1));var aP=Math.floor(aR%(V+1));aG.writeUint32(aS,4,aQ);aG.writeUint32(aS,8,aP)}})})})};aG.prototype.append=function au(aM,aI,aO,aK){var aH=this.initData;if(!aH){this.resetInitSegment(aM,this.audioCodec,this.videoCodec);aH=this.initData}var aL=void 0,aJ=this.initPTS;if(aJ===undefined){var aN=aG.getStartDTS(aH,aM);this.initPTS=aJ=aN-aI;this.observer.trigger(O.a.INIT_PTS_FOUND,{initPTS:aJ})}aG.offsetStartDTS(aH,aM,aJ);aL=aG.getStartDTS(aH,aM);this.remuxer.remux(aH.audio,aH.video,null,null,aL,aO,aK,aM)};aG.prototype.destroy=function aD(){};return aG}();var am=(h);var r={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48000,32000,22050,24000,16000,11025,12000,8000],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function al(ax,az,ay,aC,aw){if(ay+24>az.length){return undefined}var aA=this.parseHeader(az,ay);if(aA&&ay+aA.frameLength<=az.length){var au=aA.samplesPerFrame*90000/aA.sampleRate;var av=aC+aw*au;var aB={unit:az.subarray(ay,ay+aA.frameLength),pts:av,dts:av};ax.config=[];ax.channelCount=aA.channelCount;ax.samplerate=aA.sampleRate;ax.samples.push(aB);ax.len+=aA.frameLength;return{sample:aB,length:aA.frameLength}}return undefined},parseHeader:function J(aF,aE){var aC=aF[aE+1]>>3&3;var aA=aF[aE+1]>>1&3;var ay=aF[aE+2]>>4&15;var aw=aF[aE+2]>>2&3;var av=aF[aE+2]>>1&1;if(aC!==1&&ay!==0&&ay!==15&&aw!==3){var aJ=aC===3?3-aA:aA===3?3:4;var au=r.BitratesMap[aJ*14+ay-1]*1000;var aB=aC===3?0:aC===2?1:2;var aI=r.SamplingRateMap[aB*3+aw];var az=aF[aE+3]>>6===3?1:2;var ax=r.SamplesCoefficients[aC][aA];var aD=r.BytesInSlot[aA];var aH=ax*8*aD;var aG=parseInt(ax*au/aI+av,10)*aD;return{sampleRate:aI,channelCount:az,frameLength:aG,samplesPerFrame:aH}}return undefined},isHeaderPattern:function n(au,av){return au[av]===255&&(au[av+1]&224)===224&&(au[av+1]&6)!==0},isHeader:function i(au,av){if(av+1<au.length&&this.isHeaderPattern(au,av)){return true}return false},probe:function t(av,ax){if(ax+1<av.length&&this.isHeaderPattern(av,ax)){var au=4;var az=this.parseHeader(av,ax);var aw=au;if(az&&az.frameLength){aw=az.frameLength}var ay=ax+aw;if(ay===av.length||ay+1<av.length&&this.isHeaderPattern(av,ay)){return true}}return false}};var g=(r);function ak(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var ah=function(){function aI(aK){ak(this,aI);this.data=aK;this.bytesAvailable=aK.byteLength;this.word=0;this.bitsAvailable=0}aI.prototype.loadWord=function ax(){var aN=this.data,aO=this.bytesAvailable,aL=aN.byteLength-aO,aK=new Uint8Array(4),aM=Math.min(4,aO);if(aM===0){throw new Error("no bytes available")}aK.set(aN.subarray(aL,aL+aM));this.word=new DataView(aK.buffer).getUint32(0);this.bitsAvailable=aM*8;this.bytesAvailable-=aM};aI.prototype.skipBits=function aJ(aK){var aL;if(this.bitsAvailable>aK){this.word<<=aK;this.bitsAvailable-=aK}else{aK-=this.bitsAvailable;aL=aK>>3;aK-=aL>>3;this.bytesAvailable-=aL;this.loadWord();this.word<<=aK;this.bitsAvailable-=aK}};aI.prototype.readBits=function aD(aK){var aM=Math.min(this.bitsAvailable,aK),aL=this.word>>>32-aM;if(aK>32){S.b.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=aM;if(this.bitsAvailable>0){this.word<<=aM}else{if(this.bytesAvailable>0){this.loadWord()}}aM=aK-aM;if(aM>0&&this.bitsAvailable){return aL<<aM|this.readBits(aM)}else{return aL}};aI.prototype.skipLZ=function aB(){var aK;for(aK=0;aK<this.bitsAvailable;++aK){if(0!==(this.word&2147483648>>>aK)){this.word<<=aK;this.bitsAvailable-=aK;return aK}}this.loadWord();return aK+this.skipLZ()};aI.prototype.skipUEG=function aw(){this.skipBits(1+this.skipLZ())};aI.prototype.skipEG=function aG(){this.skipBits(1+this.skipLZ())};aI.prototype.readUEG=function aE(){var aK=this.skipLZ();return this.readBits(aK+1)-1};aI.prototype.readEG=function aA(){var aK=this.readUEG();if(1&aK){return 1+aK>>>1}else{return -1*(aK>>>1)}};aI.prototype.readBoolean=function au(){return 1===this.readBits(1)};aI.prototype.readUByte=function az(){return this.readBits(8)};aI.prototype.readUShort=function ay(){return this.readBits(16)};aI.prototype.readUInt=function aF(){return this.readBits(32)};aI.prototype.skipScalingList=function av(aN){var aL=8,aM=8,aK,aO;for(aK=0;aK<aN;aK++){if(aM!==0){aO=this.readEG();aM=(aL+aO+256)%256}aL=aM===0?aL:aM}};aI.prototype.readSPS=function aH(){var a0=0,a1=0,aU=0,a2=0,a5,aL,aX,aR,aN,aT,a8,aV,a4,aO=this.readUByte.bind(this),a7=this.readBits.bind(this),aM=this.readUEG.bind(this),a3=this.readBoolean.bind(this),aS=this.skipBits.bind(this),aZ=this.skipEG.bind(this),aY=this.skipUEG.bind(this),aP=this.skipScalingList.bind(this);aO();a5=aO();aL=a7(5);aS(3);aX=aO();aY();if(a5===100||a5===110||a5===122||a5===244||a5===44||a5===83||a5===86||a5===118||a5===128){var aQ=aM();if(aQ===3){aS(1)}aY();aY();aS(1);if(a3()){aV=aQ!==3?8:12;for(a4=0;a4<aV;a4++){if(a3()){if(a4<6){aP(16)}else{aP(64)}}}}}aY();var a6=aM();if(a6===0){aM()}else{if(a6===1){aS(1);aZ();aZ();aR=aM();for(a4=0;a4<aR;a4++){aZ()}}}aY();aS(1);aN=aM();aT=aM();a8=a7(1);if(a8===0){aS(1)}aS(1);if(a3()){a0=aM();a1=aM();aU=aM();a2=aM()}var aK=[1,1];if(a3()){if(a3()){var aW=aO();switch(aW){case 1:aK=[1,1];break;case 2:aK=[12,11];break;case 3:aK=[10,11];break;case 4:aK=[16,11];break;case 5:aK=[40,33];break;case 6:aK=[24,11];break;case 7:aK=[20,11];break;case 8:aK=[32,11];break;case 9:aK=[80,33];break;case 10:aK=[18,11];break;case 11:aK=[15,11];break;case 12:aK=[64,33];break;case 13:aK=[160,99];break;case 14:aK=[4,3];break;case 15:aK=[3,2];break;case 16:aK=[2,1];break;case 255:aK=[aO()<<8|aO(),aO()<<8|aO()];break}}}return{width:Math.ceil((aN+1)*16-a0*2-a1*2),height:(2-a8)*(aT+1)*16-(a8?2:4)*(aU+a2),pixelRatio:aK}};aI.prototype.readSliceType=function aC(){this.readUByte();this.readUEG();return this.readUEG()};return aI}();var ab=(ah);function N(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var u=function(){function aB(aD,aE,aF,aC){N(this,aB);this.decryptdata=aF;this.discardEPB=aC;this.decrypter=new l(aD,aE)}aB.prototype.decryptBuffer=function aA(aC,aD){this.decrypter.decrypt(aC,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,aD)};aB.prototype.decryptAacSample=function ax(aE,aC,aJ,aH){var aG=aE[aC].unit;var aI=aG.subarray(16,aG.length-aG.length%16);var aF=aI.buffer.slice(aI.byteOffset,aI.byteOffset+aI.length);var aD=this;this.decryptBuffer(aF,function(aK){aK=new Uint8Array(aK);aG.set(aK,16);if(!aH){aD.decryptAacSamples(aE,aC+1,aJ)}})};aB.prototype.decryptAacSamples=function av(aD,aC,aF){for(;;aC++){if(aC>=aD.length){aF();return}if(aD[aC].unit.length<32){continue}var aE=this.decrypter.isSync();this.decryptAacSample(aD,aC,aF,aE);if(!aE){return}}};aB.prototype.getAvcEncryptedData=function aw(aD){var aC=Math.floor((aD.length-48)/160)*16+16;var aF=new Int8Array(aC);var aG=0;for(var aE=32;aE<=aD.length-16;aE+=160,aG+=16){aF.set(aD.subarray(aE,aE+16),aG)}return aF};aB.prototype.getAvcDecryptedUnit=function au(aC,aF){aF=new Uint8Array(aF);var aD=0;for(var aE=32;aE<=aC.length-16;aE+=160,aD+=16){aC.set(aF.subarray(aD,aD+16),aE)}return aC};aB.prototype.decryptAvcSample=function az(aG,aI,aF,aK,aJ,aH){var aD=this.discardEPB(aJ.data);var aC=this.getAvcEncryptedData(aD);var aE=this;this.decryptBuffer(aC.buffer,function(aL){aJ.data=aE.getAvcDecryptedUnit(aD,aL);if(!aH){aE.decryptAvcSamples(aG,aI,aF+1,aK)}})};aB.prototype.decryptAvcSamples=function ay(aE,aC,aF,aI){for(;;aC++,aF=0){if(aC>=aE.length){aI();return}var aD=aE[aC].units;for(;;aF++){if(aF>=aD.length){break}var aG=aD[aF];if(aG.length<=48||aG.type!==1&&aG.type!==5){continue}var aH=this.decrypter.isSync();this.decryptAvcSample(aE,aC,aF,aI,aG,aH);if(!aH){return}}}};return aB}();var Z=(u);function P(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var w={video:0,audio:1,id3:2,text:3};var ao=function(){function aL(aS,aR,aT,aU){P(this,aL);this.observer=aS;this.config=aT;this.typeSupported=aU;this.remuxer=aR;this.sampleAes=null}aL.prototype.setDecryptData=function ax(aR){if(aR!=null&&aR.key!=null&&aR.method==="SAMPLE-AES"){this.sampleAes=new Z(this.observer,this.config,aR,this.discardEPB)}else{this.sampleAes=null}};aL.probe=function aI(aS){var aR=aL._syncOffset(aS);if(aR<0){return false}else{if(aR){S.b.warn("MPEG2-TS detected but first sync word found @ offset "+aR+", junk ahead ?")}return true}};aL._syncOffset=function aE(aS){var aT=Math.min(1000,aS.length-3*188);var aR=0;while(aR<aT){if(aS[aR]===71&&aS[aR+188]===71&&aS[aR+2*188]===71){return aR}else{aR++}}return -1};aL.createTrack=function au(aR,aS){return{container:aR==="video"||aR==="audio"?"video/mp2t":undefined,type:aR,id:w[aR],pid:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],len:0,dropped:aR==="video"?0:undefined,isAAC:aR==="audio"?true:undefined,duration:aR==="audio"?aS:undefined}};aL.prototype.resetInitSegment=function aH(aU,aT,aR,aS){this.pmtParsed=false;this._pmtId=-1;this._avcTrack=aL.createTrack("video",aS);this._audioTrack=aL.createTrack("audio",aS);this._id3Track=aL.createTrack("id3",aS);this._txtTrack=aL.createTrack("text",aS);this.aacOverFlow=null;this.aacLastPTS=null;this.avcSample=null;this.audioCodec=aT;this.videoCodec=aR;this._duration=aS};aL.prototype.resetTimeStamp=function aK(){};aL.prototype.append=function aM(bl,a3,bk,a0){var aX,bf=bl.length,a8,a4,bm,aY,bi,a9=false;this.contiguous=bk;var bc=this.pmtParsed,bg=this._avcTrack,ba=this._audioTrack,aZ=this._id3Track,bj=bg.pid,a5=ba.pid,a6=aZ.pid,aW=this._pmtId,a2=bg.pesData,bb=ba.pesData,a7=aZ.pesData,be=this._parsePAT,bh=this._parsePMT,aT=this._parsePES,aU=this._parseAVCPES.bind(this),aV=this._parseAACPES.bind(this),aS=this._parseMPEGPES.bind(this),bd=this._parseID3PES.bind(this);var aR=aL._syncOffset(bl);bf-=(bf+aR)%188;for(aX=aR;aX<bf;aX+=188){if(bl[aX]===71){a8=!!(bl[aX+1]&64);a4=((bl[aX+1]&31)<<8)+bl[aX+2];bm=(bl[aX+3]&48)>>4;if(bm>1){aY=aX+5+bl[aX+4];if(aY===aX+188){continue}}else{aY=aX+4}switch(a4){case bj:if(a8){if(a2&&(bi=aT(a2))){aU(bi,false)}a2={data:[],size:0}}if(a2){a2.data.push(bl.subarray(aY,aX+188));a2.size+=aX+188-aY}break;case a5:if(a8){if(bb&&(bi=aT(bb))){if(ba.isAAC){aV(bi)}else{aS(bi)}}bb={data:[],size:0}}if(bb){bb.data.push(bl.subarray(aY,aX+188));bb.size+=aX+188-aY}break;case a6:if(a8){if(a7&&(bi=aT(a7))){bd(bi)}a7={data:[],size:0}}if(a7){a7.data.push(bl.subarray(aY,aX+188));a7.size+=aX+188-aY}break;case 0:if(a8){aY+=bl[aY]+1}aW=this._pmtId=be(bl,aY);break;case aW:if(a8){aY+=bl[aY]+1}var a1=bh(bl,aY,this.typeSupported.mpeg===true||this.typeSupported.mp3===true,this.sampleAes!=null);bj=a1.avc;if(bj>0){bg.pid=bj}a5=a1.audio;if(a5>0){ba.pid=a5;ba.isAAC=a1.isAAC}a6=a1.id3;if(a6>0){aZ.pid=a6}if(a9&&!bc){S.b.log("reparse from beginning");a9=false;aX=aR-188}bc=this.pmtParsed=true;break;case 17:case 8191:break;default:a9=true;break}}else{this.observer.trigger(O.a.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(a2&&(bi=aT(a2))){aU(bi,true);bg.pesData=null}else{bg.pesData=a2}if(bb&&(bi=aT(bb))){if(ba.isAAC){aV(bi)}else{aS(bi)}ba.pesData=null}else{if(bb&&bb.size){S.b.log("last AAC PES packet truncated,might overlap between fragments")}ba.pesData=bb}if(a7&&(bi=aT(a7))){bd(bi);aZ.pesData=null}else{aZ.pesData=a7}if(this.sampleAes==null){this.remuxer.remux(ba,bg,aZ,this._txtTrack,a3,bk,a0)}else{this.decryptAndRemux(ba,bg,aZ,this._txtTrack,a3,bk,a0)}};aL.prototype.decryptAndRemux=function aB(aT,aX,aS,aW,aR,aY,aV){if(aT.samples&&aT.isAAC){var aU=this;this.sampleAes.decryptAacSamples(aT.samples,0,function(){aU.decryptAndRemuxAvc(aT,aX,aS,aW,aR,aY,aV)})}else{this.decryptAndRemuxAvc(aT,aX,aS,aW,aR,aY,aV)}};aL.prototype.decryptAndRemuxAvc=function aC(aT,aX,aS,aW,aR,aY,aV){if(aX.samples){var aU=this;this.sampleAes.decryptAvcSamples(aX.samples,0,0,function(){aU.remuxer.remux(aT,aX,aS,aW,aR,aY,aV)})}else{this.remuxer.remux(aT,aX,aS,aW,aR,aY,aV)}};aL.prototype.destroy=function aO(){this._initPTS=this._initDTS=undefined;this._duration=0};aL.prototype._parsePAT=function aP(aR,aS){return(aR[aS+10]&31)<<8|aR[aS+11]};aL.prototype._parsePMT=function aw(aT,aS,aW,aR){var aX,aU,aY,aV,aZ={audio:-1,avc:-1,id3:-1,isAAC:true};aX=(aT[aS+1]&15)<<8|aT[aS+2];aU=aS+3+aX-4;aY=(aT[aS+10]&15)<<8|aT[aS+11];aS+=12+aY;while(aS<aU){aV=(aT[aS+1]&31)<<8|aT[aS+2];switch(aT[aS]){case 207:if(!aR){S.b.log("unkown stream type:"+aT[aS]);break}case 15:if(aZ.audio===-1){aZ.audio=aV}break;case 21:if(aZ.id3===-1){aZ.id3=aV}break;case 219:if(!aR){S.b.log("unkown stream type:"+aT[aS]);break}case 27:if(aZ.avc===-1){aZ.avc=aV}break;case 3:case 4:if(!aW){S.b.log("MPEG audio found, not supported in this browser for now")}else{if(aZ.audio===-1){aZ.audio=aV;aZ.isAAC=false}}break;case 36:S.b.warn("HEVC stream type found, not supported for now");break;default:S.b.log("unkown stream type:"+aT[aS]);break}aS+=((aT[aS+3]&15)<<8|aT[aS+4])+5}return aZ};aL.prototype._parsePES=function aD(a2){var aX=0,a3,aR,aW,aT,a6,aY,a0,a5,a1,aV=a2.data;if(!a2||a2.size===0){return null}while(aV[0].length<19&&aV.length>1){var a4=new Uint8Array(aV[0].length+aV[1].length);a4.set(aV[0]);a4.set(aV[1],aV[0].length);aV[0]=a4;aV.splice(1,1)}a3=aV[0];aW=(a3[0]<<16)+(a3[1]<<8)+a3[2];if(aW===1){aT=(a3[4]<<8)+a3[5];if(aT&&aT>a2.size-6){return null}aR=a3[7];if(aR&192){a0=(a3[9]&14)*536870912+(a3[10]&255)*4194304+(a3[11]&254)*16384+(a3[12]&255)*128+(a3[13]&254)/2;if(a0>4294967295){a0-=8589934592}if(aR&64){a5=(a3[14]&14)*536870912+(a3[15]&255)*4194304+(a3[16]&254)*16384+(a3[17]&255)*128+(a3[18]&254)/2;if(a5>4294967295){a5-=8589934592}if(a0-a5>60*90000){S.b.warn(Math.round((a0-a5)/90000)+"s delta between PTS and DTS, align them");a0=a5}}else{a5=a0}}a6=a3[8];a1=a6+9;a2.size-=a1;aY=new Uint8Array(a2.size);for(var aU=0,aS=aV.length;aU<aS;aU++){a3=aV[aU];var aZ=a3.byteLength;if(a1){if(a1>aZ){a1-=aZ;continue}else{a3=a3.subarray(a1);aZ-=a1;a1=0}}aY.set(a3,aX);aX+=aZ}if(aT){aT-=a6+3}return{data:aY,pts:a0,dts:a5,len:aT}}else{return null}};aL.prototype.pushAccesUnit=function aN(aT,aS){if(aT.units.length&&aT.frame){var aR=aS.samples;var aU=aR.length;if(!this.config.forceKeyFrameOnDiscontinuity||aT.key===true||aS.sps&&(aU||this.contiguous)){aT.id=aU;aR.push(aT)}else{aS.dropped++}}if(aT.debug.length){S.b.log(aT.pts+"/"+aT.dts+":"+aT.debug)}};aL.prototype._parseAVCPES=function av(aU,a3){var aZ=this;var aT=this._avcTrack,a0=this._parseAVCNALu(aU.data),aS=false,aR,aY=this.avcSample,a1,aX=false,aW,a2=this.pushAccesUnit.bind(this),aV=function aV(a6,a7,a5,a4){return{key:a6,pts:a7,dts:a5,units:[],debug:a4}};aU.data=null;if(aY&&a0.length&&!aT.audFound){a2(aY,aT);aY=this.avcSample=aV(false,aU.pts,aU.dts,"")}a0.forEach(function(be){switch(be.type){case 1:a1=true;if(!aY){aY=aZ.avcSample=aV(true,aU.pts,aU.dts,"")}if(aS){aY.debug+="NDR "}aY.frame=true;var bn=be.data;if(aX&&bn.length>4){var bi=new ab(bn).readSliceType();if(bi===2||bi===4||bi===7||bi===9){aY.key=true}}break;case 5:a1=true;if(!aY){aY=aZ.avcSample=aV(true,aU.pts,aU.dts,"")}if(aS){aY.debug+="IDR "}aY.key=true;aY.frame=true;break;case 6:a1=true;if(aS&&aY){aY.debug+="SEI "}aR=new ab(aZ.discardEPB(be.data));aR.readUByte();var a4=0;var bc=0;var bb=false;var bk=0;while(!bb&&aR.bytesAvailable>1){a4=0;do{bk=aR.readUByte();a4+=bk}while(bk===255);bc=0;do{bk=aR.readUByte();bc+=bk}while(bk===255);if(a4===4&&aR.bytesAvailable!==0){bb=true;var a5=aR.readUByte();if(a5===181){var a6=aR.readUShort();if(a6===49){var a7=aR.readUInt();if(a7===1195456820){var bl=aR.readUByte();if(bl===3){var bj=aR.readUByte();var bg=aR.readUByte();var ba=31&bj;var bd=[bj,bg];for(aW=0;aW<ba;aW++){bd.push(aR.readUByte());bd.push(aR.readUByte());bd.push(aR.readUByte())}aZ._insertSampleInOrder(aZ._txtTrack.samples,{type:3,pts:aU.pts,bytes:bd})}}}}}else{if(bc<aR.bytesAvailable){for(aW=0;aW<bc;aW++){aR.readUByte()}}}}break;case 7:a1=true;aX=true;if(aS&&aY){aY.debug+="SPS "}if(!aT.sps){aR=new ab(be.data);var bm=aR.readSPS();aT.width=bm.width;aT.height=bm.height;aT.pixelRatio=bm.pixelRatio;aT.sps=[be.data];aT.duration=aZ._duration;var a8=be.data.subarray(1,4);var bf="avc1.";for(aW=0;aW<3;aW++){var bh=a8[aW].toString(16);if(bh.length<2){bh="0"+bh}bf+=bh}aT.codec=bf}break;case 8:a1=true;if(aS&&aY){aY.debug+="PPS "}if(!aT.pps){aT.pps=[be.data]}break;case 9:a1=false;aT.audFound=true;if(aY){a2(aY,aT)}aY=aZ.avcSample=aV(false,aU.pts,aU.dts,aS?"AUD ":"");break;case 12:a1=false;break;default:a1=false;if(aY){aY.debug+="unknown NAL "+be.type+" "}break}if(aY&&a1){var a9=aY.units;a9.push(be)}});if(a3&&aY){a2(aY,aT);this.avcSample=null}};aL.prototype._insertSampleInOrder=function aA(aS,aT){var aR=aS.length;if(aR>0){if(aT.pts>=aS[aR-1].pts){aS.push(aT)}else{for(var aU=aR-1;aU>=0;aU--){if(aT.pts<aS[aU].pts){aS.splice(aU,0,aT);break}}}}else{aS.push(aT)}};aL.prototype._getLastNalUnit=function ay(){var aV=this.avcSample,aU=void 0;if(!aV||aV.units.length===0){var aR=this._avcTrack,aT=aR.samples;aV=aT[aT.length-1]}if(aV){var aS=aV.units;aU=aS[aS.length-1]}return aU};aL.prototype._parseAVCNALu=function aJ(a1){var aX=0,aY=a1.byteLength,a7,aU,aT=this._avcTrack,aS=aT.naluState||0,aR=aS;var a0=[],a6,a5,aZ=-1,aV;if(aS===-1){aZ=0;aV=a1[0]&31;aS=0;aX=1}while(aX<aY){a7=a1[aX++];if(!aS){aS=a7?0:1;continue}if(aS===1){aS=a7?0:2;continue}if(!a7){aS=3}else{if(a7===1){if(aZ>=0){a6={data:a1.subarray(aZ,aX-aS-1),type:aV};a0.push(a6)}else{var a3=this._getLastNalUnit();if(a3){if(aR&&aX<=4-aR){if(a3.state){a3.data=a3.data.subarray(0,a3.data.byteLength-aR)}}aU=aX-aS-1;if(aU>0){var aW=new Uint8Array(a3.data.byteLength+aU);aW.set(a3.data,0);aW.set(a1.subarray(0,aU),a3.data.byteLength);a3.data=aW}}}if(aX<aY){a5=a1[aX]&31;aZ=aX;aV=a5;aS=0}else{aS=-1}}else{aS=0}}}if(aZ>=0&&aS>=0){a6={data:a1.subarray(aZ,aY),type:aV,state:aS};a0.push(a6)}if(a0.length===0){var a4=this._getLastNalUnit();if(a4){var a2=new Uint8Array(a4.data.byteLength+a1.byteLength);a2.set(a4.data,0);a2.set(a1,a4.data.byteLength);a4.data=a2}}aT.naluState=aS;return a0};aL.prototype.discardEPB=function aQ(aX){var aV=aX.byteLength,aS=[],aT=1,aW,aU;while(aT<aV-2){if(aX[aT]===0&&aX[aT+1]===0&&aX[aT+2]===3){aS.push(aT+2);aT+=2}else{aT++}}if(aS.length===0){return aX}aW=aV-aS.length;aU=new Uint8Array(aW);var aR=0;for(aT=0;aT<aW;aR++,aT++){if(aR===aS[0]){aR++;aS.shift()}aU[aT]=aX[aR]}return aU};aL.prototype._parseAACPES=function az(aW){var aV=this._audioTrack,a0=aW.data,a7=aW.pts,a6=0,a3=this.aacOverFlow,aX=this.aacLastPTS,aS,aU,aY,aR,a4;if(a3){var aZ=new Uint8Array(a3.byteLength+a0.byteLength);aZ.set(a3,0);aZ.set(a0,a3.byteLength);a0=aZ}for(aY=a6,a4=a0.length;aY<a4-1;aY++){if(i(a0,aY)){break}}if(aY){var a2,a5;if(aY<a4-1){a2="AAC PES did not start with ADTS header,offset:"+aY;a5=false}else{a2="no ADTS header found in AAC PES";a5=true}S.b.warn("parsing error:"+a2);this.observer.trigger(O.a.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_PARSING_ERROR,fatal:a5,reason:a2});if(a5){return}}G(aV,this.observer,a0,aY,this.audioCodec);aU=0;aS=ai(aV.samplerate);if(a3&&aX){var a1=aX+aS;if(Math.abs(a1-a7)>1){S.b.log("AAC: align PTS for overlapping frames by "+Math.round((a1-a7)/90));a7=a1}}while(aY<a4){if(i(a0,aY)&&aY+5<a4){var aT=al(aV,a0,aY,a7,aU);if(aT){aY+=aT.length;aR=aT.sample.pts;aU++}else{break}}else{aY++}}if(aY<a4){a3=a0.subarray(aY,a4)}else{a3=null}this.aacOverFlow=a3;this.aacLastPTS=aR};aL.prototype._parseMPEGPES=function aF(aR){var aT=aR.data;var aS=aT.length;var aX=0;var aW=0;var aV=aR.pts;while(aW<aS){if(g.isHeader(aT,aW)){var aU=g.appendFrame(this._audioTrack,aT,aW,aV,aX);if(aU){aW+=aU.length;aX++}else{break}}else{aW++}}};aL.prototype._parseID3PES=function aG(aR){this._id3Track.samples.push(aR)};return aL}();var an=(ao);function s(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var D=function(){function ay(aB,aA,aC){s(this,ay);this.observer=aB;this.config=aC;this.remuxer=aA}ay.prototype.resetInitSegment=function aw(aD,aC,aA,aB){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:false,samples:[],len:0,manifestCodec:aC,duration:aB,inputTimeScale:90000}};ay.prototype.resetTimeStamp=function ax(){};ay.probe=function av(aC){var aD,aB;var aA=X.a.getID3Data(aC,0);if(aA&&X.a.getTimeStamp(aA)!==undefined){for(aD=aA.length,aB=Math.min(aC.length-1,aD+100);aD<aB;aD++){if(g.probe(aC,aD)){S.b.log("MPEG Audio sync word found !");return true}}}return false};ay.prototype.append=function au(aI,aM,aB,aG){var aL=X.a.getID3Data(aI,0);var aJ=X.a.getTimeStamp(aL);var aN=aJ?90*aJ:aM*90000;var aH=aL.length;var aF=aI.length;var aE=0,aA=0;var aD=this._audioTrack;var aK=[{pts:aN,dts:aN,data:aL}];while(aH<aF){if(g.isHeader(aI,aH)){var aC=g.appendFrame(aD,aI,aH,aN,aE);if(aC){aH+=aC.length;aA=aC.sample.pts;aE++}else{break}}else{if(X.a.isHeader(aI,aH)){aL=X.a.getID3Data(aI,aH);aK.push({pts:aA,dts:aA,data:aL});aH+=aL.length}else{aH++}}}this.remuxer.remux(aD,{samples:[]},{samples:aK,inputTimeScale:90000},{samples:[]},aM,aB,aG)};ay.prototype.destroy=function az(){};return ay}();var ag=(D);function Q(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var R=function(){function au(){Q(this,au)}au.getSilentFrame=function av(ax,aw){switch(ax){case"mp4a.40.2":if(aw===1){return new Uint8Array([0,200,0,128,35,128])}else{if(aw===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else{if(aw===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else{if(aw===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else{if(aw===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else{if(aw===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}}}}}}break;default:if(aw===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else{if(aw===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else{if(aw===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}break}return null};return au}();var d=(R);function c(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var v=Math.pow(2,32)-1;var E=function(){function aL(){c(this,aL)}aL.init=function aN(){aL.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var aZ;for(aZ in aL.types){if(aL.types.hasOwnProperty(aZ)){aL.types[aZ]=[aZ.charCodeAt(0),aZ.charCodeAt(1),aZ.charCodeAt(2),aZ.charCodeAt(3)]}}var a0=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var aU=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);aL.HDLR_TYPES={video:a0,audio:aU};var aX=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var aW=new Uint8Array([0,0,0,0,0,0,0,0]);aL.STTS=aL.STSC=aL.STCO=aW;aL.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);aL.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);aL.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);aL.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var aV=new Uint8Array([105,115,111,109]);var aY=new Uint8Array([97,118,99,49]);var a1=new Uint8Array([0,0,0,1]);aL.FTYP=aL.box(aL.types.ftyp,aV,a1,aV,aY);aL.DINF=aL.box(aL.types.dinf,aL.box(aL.types.dref,aX))};aL.box=function aI(aY){var aZ=Array.prototype.slice.call(arguments,1),aX=8,aW=aZ.length,aV=aW,aU;while(aW--){aX+=aZ[aW].byteLength}aU=new Uint8Array(aX);aU[0]=aX>>24&255;aU[1]=aX>>16&255;aU[2]=aX>>8&255;aU[3]=aX&255;aU.set(aY,4);for(aW=0,aX=8;aW<aV;aW++){aU.set(aZ[aW],aX);aX+=aZ[aW].byteLength}return aU};aL.hdlr=function aw(aU){return aL.box(aL.types.hdlr,aL.HDLR_TYPES[aU])};aL.mdat=function av(aU){return aL.box(aL.types.mdat,aU)};aL.mdhd=function aR(aU,aX){aX*=aU;var aV=Math.floor(aX/(v+1));var aW=Math.floor(aX%(v+1));return aL.box(aL.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,aU>>24&255,aU>>16&255,aU>>8&255,aU&255,aV>>24,aV>>16&255,aV>>8&255,aV&255,aW>>24,aW>>16&255,aW>>8&255,aW&255,85,196,0,0]))};aL.mdia=function az(aU){return aL.box(aL.types.mdia,aL.mdhd(aU.timescale,aU.duration),aL.hdlr(aU.type),aL.minf(aU))};aL.mfhd=function aT(aU){return aL.box(aL.types.mfhd,new Uint8Array([0,0,0,0,aU>>24,aU>>16&255,aU>>8&255,aU&255]))};aL.minf=function aK(aU){if(aU.type==="audio"){return aL.box(aL.types.minf,aL.box(aL.types.smhd,aL.SMHD),aL.DINF,aL.stbl(aU))}else{return aL.box(aL.types.minf,aL.box(aL.types.vmhd,aL.VMHD),aL.DINF,aL.stbl(aU))}};aL.moof=function aC(aW,aV,aU){return aL.box(aL.types.moof,aL.mfhd(aW),aL.traf(aU,aV))};aL.moov=function aS(aU){var aW=aU.length,aV=[];while(aW--){aV[aW]=aL.trak(aU[aW])}return aL.box.apply(null,[aL.types.moov,aL.mvhd(aU[0].timescale,aU[0].duration)].concat(aV).concat(aL.mvex(aU)))};aL.mvex=function aF(aU){var aW=aU.length,aV=[];while(aW--){aV[aW]=aL.trex(aU[aW])}return aL.box.apply(null,[aL.types.mvex].concat(aV))};aL.mvhd=function aO(aV,aY){aY*=aV;var aW=Math.floor(aY/(v+1));var aX=Math.floor(aY%(v+1));var aU=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,aV>>24&255,aV>>16&255,aV>>8&255,aV&255,aW>>24,aW>>16&255,aW>>8&255,aW&255,aX>>24,aX>>16&255,aX>>8&255,aX&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return aL.box(aL.types.mvhd,aU)};aL.sdtp=function aJ(aW){var aX=aW.samples||[],aV=new Uint8Array(4+aX.length),aU,aY;for(aY=0;aY<aX.length;aY++){aU=aX[aY].flags;aV[aY+4]=aU.dependsOn<<4|aU.isDependedOn<<2|aU.hasRedundancy}return aL.box(aL.types.sdtp,aV)};aL.stbl=function aG(aU){return aL.box(aL.types.stbl,aL.stsd(aU),aL.box(aL.types.stts,aL.STTS),aL.box(aL.types.stsc,aL.STSC),aL.box(aL.types.stsz,aL.STSZ),aL.box(aL.types.stco,aL.STCO))};aL.avc1=function aH(aW){var aU=[],aX=[],aZ,aY,a0;for(aZ=0;aZ<aW.sps.length;aZ++){aY=aW.sps[aZ];a0=aY.byteLength;aU.push(a0>>>8&255);aU.push(a0&255);aU=aU.concat(Array.prototype.slice.call(aY))}for(aZ=0;aZ<aW.pps.length;aZ++){aY=aW.pps[aZ];a0=aY.byteLength;aX.push(a0>>>8&255);aX.push(a0&255);aX=aX.concat(Array.prototype.slice.call(aY))}var a2=aL.box(aL.types.avcC,new Uint8Array([1,aU[3],aU[4],aU[5],252|3,224|aW.sps.length].concat(aU).concat([aW.pps.length]).concat(aX))),aV=aW.width,a3=aW.height,a1=aW.pixelRatio[0],a4=aW.pixelRatio[1];return aL.box(aL.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,aV>>8&255,aV&255,a3>>8&255,a3&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a2,aL.box(aL.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),aL.box(aL.types.pasp,new Uint8Array([a1>>24,a1>>16&255,a1>>8&255,a1&255,a4>>24,a4>>16&255,a4>>8&255,a4&255])))};aL.esds=function aB(aU){var aV=aU.config.length;return new Uint8Array([0,0,0,0,3,23+aV,0,1,0,4,15+aV,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([aV]).concat(aU.config).concat([6,1,2]))};aL.mp4a=function aQ(aU){var aV=aU.samplerate;return aL.box(aL.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,aU.channelCount,0,16,0,0,0,0,aV>>8&255,aV&255,0,0]),aL.box(aL.types.esds,aL.esds(aU)))};aL.mp3=function aE(aU){var aV=aU.samplerate;return aL.box(aL.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,aU.channelCount,0,16,0,0,0,0,aV>>8&255,aV&255,0,0]))};aL.stsd=function aD(aU){if(aU.type==="audio"){if(!aU.isAAC&&aU.codec==="mp3"){return aL.box(aL.types.stsd,aL.STSD,aL.mp3(aU))}return aL.box(aL.types.stsd,aL.STSD,aL.mp4a(aU))}else{return aL.box(aL.types.stsd,aL.STSD,aL.avc1(aU))}};aL.tkhd=function aM(aV){var a0=aV.id,aZ=aV.duration*aV.timescale,aX=aV.width,aU=aV.height,aW=Math.floor(aZ/(v+1)),aY=Math.floor(aZ%(v+1));return aL.box(aL.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a0>>24&255,a0>>16&255,a0>>8&255,a0&255,0,0,0,0,aW>>24,aW>>16&255,aW>>8&255,aW&255,aY>>24,aY>>16&255,aY>>8&255,aY&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,aX>>8&255,aX&255,0,0,aU>>8&255,aU&255,0,0]))};aL.traf=function ay(aU,aX){var aV=aL.sdtp(aU),aZ=aU.id,aY=Math.floor(aX/(v+1)),aW=Math.floor(aX%(v+1));return aL.box(aL.types.traf,aL.box(aL.types.tfhd,new Uint8Array([0,0,0,0,aZ>>24,aZ>>16&255,aZ>>8&255,aZ&255])),aL.box(aL.types.tfdt,new Uint8Array([1,0,0,0,aY>>24,aY>>16&255,aY>>8&255,aY&255,aW>>24,aW>>16&255,aW>>8&255,aW&255])),aL.trun(aU,aV.length+16+20+8+16+8+8),aV)};aL.trak=function au(aU){aU.duration=aU.duration||4294967295;return aL.box(aL.types.trak,aL.tkhd(aU),aL.mdia(aU))};aL.trex=function ax(aU){var aV=aU.id;return aL.box(aL.types.trex,new Uint8Array([0,0,0,0,aV>>24,aV>>16&255,aV>>8&255,aV&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))};aL.trun=function aP(aV,aY){var a2=aV.samples||[],a0=a2.length,a5=12+16*a0,a1=new Uint8Array(a5),aZ,a3,aX,a4,aW,aU;aY+=8+a5;a1.set([0,0,15,1,a0>>>24&255,a0>>>16&255,a0>>>8&255,a0&255,aY>>>24&255,aY>>>16&255,aY>>>8&255,aY&255],0);for(aZ=0;aZ<a0;aZ++){a3=a2[aZ];aX=a3.duration;a4=a3.size;aW=a3.flags;aU=a3.cts;a1.set([aX>>>24&255,aX>>>16&255,aX>>>8&255,aX&255,a4>>>24&255,a4>>>16&255,a4>>>8&255,a4&255,aW.isLeading<<2|aW.dependsOn,aW.isDependedOn<<6|aW.hasRedundancy<<4|aW.paddingValue<<1|aW.isNonSync,aW.degradPrio&240<<8,aW.degradPrio&15,aU>>>24&255,aU>>>16&255,aU>>>8&255,aU&255],12+16*aZ)}return aL.box(aL.types.trun,a1)};aL.initSegment=function aA(aW){if(!aL.types){aL.init()}var aV=aL.moov(aW),aU;aU=new Uint8Array(aL.FTYP.byteLength+aV.byteLength);aU.set(aL.FTYP);aU.set(aV,aL.FTYP.byteLength);return aU};return aL}();var m=(E);function ae(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var M=10*1000;var F=function(){function az(aG,aH,aJ,aK){ae(this,az);this.observer=aG;this.config=aH;this.typeSupported=aJ;var aI=navigator.userAgent;this.isSafari=aK&&aK.indexOf("Apple")>-1&&aI&&!aI.match("CriOS");this.ISGenerated=false}az.prototype.destroy=function aE(){};az.prototype.resetTimeStamp=function aA(aG){this._initPTS=this._initDTS=aG};az.prototype.resetInitSegment=function av(){this.ISGenerated=false};az.prototype.remux=function aB(aK,aR,aU,aP,aT,aH,aI){if(!this.ISGenerated){this.generateIS(aK,aR,aT)}if(this.ISGenerated){var aM=aK.samples.length;var aN=aR.samples.length;var aS=aT;var aG=aT;if(aM&&aN){var aJ=(aK.samples[0].dts-aR.samples[0].dts)/aR.inputTimeScale;aS+=Math.max(0,aJ);aG+=Math.max(0,-aJ)}if(aM){if(!aK.timescale){S.b.warn("regenerate InitSegment as audio detected");this.generateIS(aK,aR,aT)}var aO=this.remuxAudio(aK,aS,aH,aI);if(aN){var aQ=void 0;if(aO){aQ=aO.endPTS-aO.startPTS}if(!aR.timescale){S.b.warn("regenerate InitSegment as video detected");this.generateIS(aK,aR,aT)}this.remuxVideo(aR,aG,aH,aQ,aI)}}else{var aL=void 0;if(aN){aL=this.remuxVideo(aR,aG,aH,aI)}if(aL&&aK.codec){this.remuxEmptyAudio(aK,aS,aH,aL)}}}if(aU.samples.length){this.remuxID3(aU,aT)}if(aP.samples.length){this.remuxText(aP,aT)}this.observer.trigger(O.a.FRAG_PARSED)};az.prototype.generateIS=function ay(aN,aS,aT){var aP=this.observer,aL=aN.samples,aJ=aS.samples,aG=this.typeSupported,aH="audio/mp4",aO={},aM={tracks:aO},aQ=this._initPTS===undefined,aR,aI;if(aQ){aR=aI=Infinity}if(aN.config&&aL.length){aN.timescale=aN.samplerate;S.b.log("audio sampling rate : "+aN.samplerate);if(!aN.isAAC){if(aG.mpeg){aH="audio/mpeg";aN.codec=""}else{if(aG.mp3){aN.codec="mp3"}}}aO.audio={container:aH,codec:aN.codec,initSegment:!aN.isAAC&&aG.mpeg?new Uint8Array():m.initSegment([aN]),metadata:{channelCount:aN.channelCount}};if(aQ){aR=aI=aL[0].pts-aN.inputTimeScale*aT}}if(aS.sps&&aS.pps&&aJ.length){var aK=aS.inputTimeScale;aS.timescale=aK;aO.video={container:"video/mp4",codec:aS.codec,initSegment:m.initSegment([aS]),metadata:{width:aS.width,height:aS.height}};if(aQ){aR=Math.min(aR,aJ[0].pts-aK*aT);aI=Math.min(aI,aJ[0].dts-aK*aT);this.observer.trigger(O.a.INIT_PTS_FOUND,{initPTS:aR})}}if(Object.keys(aO).length){aP.trigger(O.a.FRAG_PARSING_INIT_SEGMENT,aM);this.ISGenerated=true;if(aQ){this._initPTS=aR;this._initDTS=aI}}else{aP.trigger(O.a.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}};az.prototype.remuxVideo=function aw(aV,bm,a4,bd,aN){var bi=8,aX=aV.timescale,by,aT,a7,bc,aH,aG,bv,aU,a3=aV.samples,aW=[],aS=a3.length,aJ=this._PTSNormalize,bh=this._initDTS;var a1=this.nextAvcDts;var aK=this.isSafari;if(aK){a4|=a3.length&&a1&&(aN&&Math.abs(bm-a1/aX)<0.1||Math.abs(a3[0].pts-a1-bh)<aX/5)}if(!a4){a1=bm*aX}a3.forEach(function(bz){bz.pts=aJ(bz.pts-bh,a1);bz.dts=aJ(bz.dts-bh,a1)});a3.sort(function(bA,bz){var bC=bA.dts-bz.dts;var bB=bA.pts-bz.pts;return bC?bC:bB?bB:bA.id-bz.id});var ba=a3.reduce(function(bz,bA){return Math.max(Math.min(bz,bA.pts-bA.dts),-18000)},0);if(ba<0){S.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(ba/90)+" ms to overcome this issue");for(var br=0;br<a3.length;br++){a3[br].dts+=ba}}var aR=a3[0];aH=Math.max(aR.dts,0);bc=Math.max(aR.pts,0);var bg=Math.round((aH-a1)/90);if(a4){if(bg){if(bg>1){S.b.log("AVC:"+bg+" ms hole between fragments detected,filling it")}else{if(bg<-1){S.b.log("AVC:"+-bg+" ms overlapping between fragments detected")}}aH=a1;a3[0].dts=aH;bc=Math.max(bc-bg,a1);a3[0].pts=bc;S.b.log("Video/PTS/DTS adjusted: "+Math.round(bc/90)+"/"+Math.round(aH/90)+",delta:"+bg+" ms")}}aG=aH;aR=a3[a3.length-1];aU=Math.max(aR.dts,0);bv=Math.max(aR.pts,0,aU);if(aK){by=Math.round((aU-aH)/(a3.length-1))}var aQ=0,bq=0;for(var bs=0;bs<aS;bs++){var a0=a3[bs],bu=a0.units,a2=bu.length,a9=0;for(var bp=0;bp<a2;bp++){a9+=bu[bp].data.length}bq+=a9;aQ+=a2;a0.length=a9;if(aK){a0.dts=aH+bs*by}else{a0.dts=Math.max(a0.dts,aH)}a0.pts=Math.max(a0.pts,a0.dts)}var aM=bq+4*aQ+8;try{aT=new Uint8Array(aM)}catch(bt){this.observer.trigger(O.a.ERROR,{type:I.b.MUX_ERROR,details:I.a.REMUX_ALLOC_ERROR,fatal:false,bytes:aM,reason:"fail allocating video mdat "+aM});return}var aI=new DataView(aT.buffer);aI.setUint32(0,aM);aT.set(m.types.mdat,4);for(var aP=0;aP<aS;aP++){var a6=a3[aP],aY=a6.units,bl=0,a5=void 0;for(var bo=0,bx=aY.length;bo<bx;bo++){var bk=aY[bo],bb=bk.data,aL=bk.data.byteLength;aI.setUint32(bi,aL);bi+=4;aT.set(bb,bi);bi+=aL;bl+=4+aL}if(!aK){if(aP<aS-1){by=a3[aP+1].dts-a6.dts}else{var bf=this.config,bj=a6.dts-a3[aP>0?aP-1:aP].dts;if(bf.stretchShortVideoTrack){var aO=bf.maxBufferHole,bn=bf.maxSeekHole,aZ=Math.floor(Math.min(aO,bn)*aX),a8=(bd?bc+bd*aX:this.nextAudioPts)-a6.pts;if(a8>aZ){by=a8-bj;if(by<0){by=bj}S.b.log("It is approximately "+a8/90+" ms to the next segment; using duration "+by/90+" ms for the last video frame.")}else{by=bj}}else{by=bj}}a5=Math.round(a6.pts-a6.dts)}else{a5=Math.max(0,by*Math.round((a6.pts-a6.dts)/by))}aW.push({size:bl,duration:by,cts:a5,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a6.key?2:1,isNonSync:a6.key?0:1}})}this.nextAvcDts=aU+by;var be=aV.dropped;aV.len=0;aV.nbNalu=0;aV.dropped=0;aV.samples=aW;a7=m.moof(aV.sequenceNumber++,aH,aV);aV.samples=[];var bw={data1:a7,data2:aT,startPTS:bc/aX,endPTS:(bv+by)/aX,startDTS:aH/aX,endDTS:this.nextAvcDts/aX,type:"video",nb:aW.length,dropped:be};this.observer.trigger(O.a.FRAG_PARSING_DATA,bw);return bw};az.prototype.remuxAudio=function aC(aY,bf,a5,aO){var aG=aY.inputTimeScale,bi=aY.timescale,aP=aG/bi,bp=aY.isAAC?1024:1152,aJ=bp*aP,aM=this._PTSNormalize,bb=this._initDTS,bh=!aY.isAAC&&this.typeSupported.mpeg;var bc,aL,a0,aV,a7,a8,bn,a4=aY.samples,aZ=[],aQ=this.nextAudioPts;a5|=a4.length&&aQ&&(aO&&Math.abs(bf-aQ/aG)<0.1||Math.abs(a4[0].pts-aQ-bb)<20*aJ);a4.forEach(function(bt){bt.pts=bt.dts=aM(bt.pts-bb,bf*aG)});a4=a4.filter(function(bt){return bt.pts>=0});if(a4.length===0){return}if(!a5){if(!aO){aQ=a4[0].pts}else{aQ=bf*aG}}if(aY.isAAC){var a6=this.config.maxAudioFramesDrift;for(var bl=0,bg=aQ;bl<a4.length;){var aU=a4[bl],a9;var br=aU.pts;a9=br-bg;var a2=Math.abs(1000*a9/aG);if(a9<=-a6*aJ){S.b.warn("Dropping 1 audio frame @ "+(bg/aG).toFixed(3)+"s due to "+Math.round(a2)+" ms overlap.");a4.splice(bl,1);aY.len-=aU.unit.length}else{if(a9>=a6*aJ&&a2<M&&bg){var aI=Math.round(a9/aJ);S.b.warn("Injecting "+aI+" audio frame @ "+(bg/aG).toFixed(3)+"s due to "+Math.round(1000*a9/aG)+" ms gap.");for(var bj=0;bj<aI;bj++){var aS=Math.max(bg,0);a0=d.getSilentFrame(aY.manifestCodec||aY.codec,aY.channelCount);if(!a0){S.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead.");a0=aU.unit.subarray()}a4.splice(bl,0,{unit:a0,pts:aS,dts:aS});aY.len+=a0.length;bg+=aJ;bl++}aU.pts=aU.dts=bg;bg+=aJ;bl++}else{if(Math.abs(a9)>0.1*aJ){}aU.pts=aU.dts=bg;bg+=aJ;bl++}}}}for(var bk=0,bs=a4.length;bk<bs;bk++){var a3=a4[bk];var bd=a3.unit;var bq=a3.pts;if(bn!==undefined){aL.duration=Math.round((bq-bn)/aP)}else{var ba=Math.round(1000*(bq-aQ)/aG),bo=0;if(a5&&aY.isAAC){if(ba){if(ba>0&&ba<M){bo=Math.round((bq-aQ)/aJ);S.b.log(ba+" ms hole between AAC samples detected,filling it");if(bo>0){a0=d.getSilentFrame(aY.manifestCodec||aY.codec,aY.channelCount);if(!a0){a0=bd.subarray()}aY.len+=bo*a0.length}}else{if(ba<-12){S.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(aQ/aG).toFixed(3)+"s/"+(bq/aG).toFixed(3)+"s/"+-ba+"ms");aY.len-=bd.byteLength;continue}}bq=aQ}}a8=bq;if(aY.len>0){var aN=bh?aY.len:aY.len+8;bc=bh?0:8;try{aV=new Uint8Array(aN)}catch(bm){this.observer.trigger(O.a.ERROR,{type:I.b.MUX_ERROR,details:I.a.REMUX_ALLOC_ERROR,fatal:false,bytes:aN,reason:"fail allocating audio mdat "+aN});return}if(!bh){var aK=new DataView(aV.buffer);aK.setUint32(0,aN);aV.set(m.types.mdat,4)}}else{return}for(var aR=0;aR<bo;aR++){a0=d.getSilentFrame(aY.manifestCodec||aY.codec,aY.channelCount);if(!a0){S.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead.");a0=bd.subarray()}aV.set(a0,bc);bc+=a0.byteLength;aL={size:a0.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};aZ.push(aL)}}aV.set(bd,bc);var aH=bd.byteLength;bc+=aH;aL={size:aH,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};aZ.push(aL);bn=bq}var be=0;var aT=aZ.length;if(aT>=2){be=aZ[aT-2].duration;aL.duration=be}if(aT){this.nextAudioPts=aQ=bn+aP*be;aY.len=0;aY.samples=aZ;if(bh){a7=new Uint8Array()}else{a7=m.moof(aY.sequenceNumber++,a8/aP,aY)}aY.samples=[];var a1=a8/aG;var aW=aQ/aG;var aX={data1:a7,data2:aV,startPTS:a1,endPTS:aW,startDTS:a1,endDTS:aW,type:"audio",nb:aT};this.observer.trigger(O.a.FRAG_PARSING_DATA,aX);return aX}return null};az.prototype.remuxEmptyAudio=function aD(aL,aW,aJ,aQ){var aN=aL.inputTimeScale,aK=aL.samplerate?aL.samplerate:aN,aU=aN/aK,aS=this.nextAudioPts,aT=(aS!==undefined?aS:aQ.startDTS*aN)+this._initDTS,aM=aQ.endDTS*aN+this._initDTS,aI=1024,aH=aU*aI,aO=Math.ceil((aM-aT)/aH),aV=d.getSilentFrame(aL.manifestCodec||aL.codec,aL.channelCount);S.b.warn("remux empty Audio");if(!aV){S.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}var aR=[];for(var aP=0;aP<aO;aP++){var aG=aT+aP*aH;aR.push({unit:aV,pts:aG,dts:aG});aL.len+=aV.length}aL.samples=aR;this.remuxAudio(aL,aW,aJ)};az.prototype.remuxID3=function au(aH,aG){var aM=aH.samples.length,aL;var aK=aH.inputTimeScale;var aJ=this._initPTS;var aN=this._initDTS;if(aM){for(var aI=0;aI<aM;aI++){aL=aH.samples[aI];aL.pts=(aL.pts-aJ)/aK;aL.dts=(aL.dts-aN)/aK}this.observer.trigger(O.a.FRAG_PARSING_METADATA,{samples:aH.samples})}aH.samples=[];aG=aG};az.prototype.remuxText=function aF(aH,aG){aH.samples.sort(function(aO,aN){return aO.pts-aN.pts});var aM=aH.samples.length,aL;var aK=aH.inputTimeScale;var aJ=this._initPTS;if(aM){for(var aI=0;aI<aM;aI++){aL=aH.samples[aI];aL.pts=(aL.pts-aJ)/aK}this.observer.trigger(O.a.FRAG_PARSING_USERDATA,{samples:aH.samples})}aH.samples=[];aG=aG};az.prototype._PTSNormalize=function ax(aH,aG){var aI;if(aG===undefined){return aH}if(aG<aH){aI=-8589934592}else{aI=8589934592}while(Math.abs(aH-aG)>4294967296){aH+=aI}return aH};return az}();var b=(F);function af(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var q=function(){function ax(az){af(this,ax);this.observer=az}ax.prototype.destroy=function ay(){};ax.prototype.resetTimeStamp=function aw(){};ax.prototype.resetInitSegment=function au(){};ax.prototype.remux=function av(aD,aG,aI,aF,aH,aB,aC,az){var aE=this.observer;var aA="";if(aD){aA+="audio"}if(aG){aA+="video"}aE.trigger(O.a.FRAG_PARSING_DATA,{data1:az,startPTS:aH,startDTS:aH,type:aA,nb:1,dropped:0});aE.trigger(O.a.FRAG_PARSED)};return ax}();var T=(q);function k(au,av){if(!(au instanceof av)){throw new TypeError("Cannot call a class as a function")}}var L=function(){function ax(ay,aA,az,aB){k(this,ax);this.observer=ay;this.typeSupported=aA;this.config=az;this.vendor=aB}ax.prototype.destroy=function av(){var ay=this.demuxer;if(ay){ay.destroy()}};ax.prototype.push=function au(aG,aM,aH,aN,aF,aL,aD,aI,az,aE,aB,ay){if(aG.byteLength>0&&aM!=null&&aM.key!=null&&aM.method==="AES-128"){var aC=this.decrypter;if(aC==null){aC=this.decrypter=new l(this.observer,this.config)}var aK=this;var aA;try{aA=performance.now()}catch(aJ){aA=Date.now()}aC.decrypt(aG,aM.key.buffer,aM.iv.buffer,function(aQ){var aO;try{aO=performance.now()}catch(aP){aO=Date.now()}aK.observer.trigger(O.a.FRAG_DECRYPTED,{stats:{tstart:aA,tdecrypt:aO}});aK.pushDecrypted(new Uint8Array(aQ),aM,new Uint8Array(aH),aN,aF,aL,aD,aI,az,aE,aB,ay)})}else{this.pushDecrypted(new Uint8Array(aG),aM,new Uint8Array(aH),aN,aF,aL,aD,aI,az,aE,aB,ay)}};ax.prototype.pushDecrypted=function aw(aT,aA,aC,aB,aO,aK,aD,aE,aR,ay,aG,az){var aH=this.demuxer;if(!aH||aD&&!this.probe(aT)){var aM=this.observer;var aF=this.typeSupported;var aQ=this.config;var aU=[{demux:an,remux:b},{demux:am,remux:T},{demux:aa,remux:b},{demux:ag,remux:b}];for(var aN=0,aP=aU.length;aN<aP;aN++){var aJ=aU[aN];var aL=aJ.demux.probe;if(aL(aT)){var aS=this.remuxer=new aJ.remux(aM,aQ,aF,this.vendor);aH=new aJ.demux(aM,aS,aQ,aF);this.probe=aL;break}}if(!aH){aM.trigger(O.a.ERROR,{type:I.b.MEDIA_ERROR,details:I.a.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}this.demuxer=aH}var aI=this.remuxer;if(aD||aE){aH.resetInitSegment(aC,aB,aO,ay);aI.resetInitSegment()}if(aD){aH.resetTimeStamp(az);aI.resetTimeStamp(az)}if(typeof aH.setDecryptData==="function"){aH.setDecryptData(aA)}aH.append(aT,aK,aR,aG)};return ax}();var ap=ad.a=(L)}),(function(bn,aZ,ba){Object.defineProperty(aZ,"__esModule",{value:true});var bj=ba(6);var aO=ba.n(bj);var E=ba(1);var az=ba(2);var U=ba(0);var an=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(bu){return typeof bu}:function(bu){return bu&&typeof Symbol==="function"&&bu.constructor===Symbol&&bu!==Symbol.prototype?"symbol":typeof bu};function aq(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var V=function(){function bx(bC){aq(this,bx);this.hls=bC;this.onEvent=this.onEvent.bind(this);for(var bB=arguments.length,bD=Array(bB>1?bB-1:0),bE=1;bE<bB;bE++){bD[bE-1]=arguments[bE]}this.handledEvents=bD;this.useGenericHandler=true;this.registerListeners()}bx.prototype.destroy=function bw(){this.unregisterListeners()};bx.prototype.isEventHandler=function bv(){return an(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"};bx.prototype.registerListeners=function bz(){if(this.isEventHandler()){this.handledEvents.forEach(function(bB){if(bB==="hlsEventGeneric"){throw new Error("Forbidden event name: "+bB)}this.hls.on(bB,this.onEvent)},this)}};bx.prototype.unregisterListeners=function by(){if(this.isEventHandler()){this.handledEvents.forEach(function(bB){this.hls.off(bB,this.onEvent)},this)}};bx.prototype.onEvent=function bA(bB,bC){this.onEventGeneric(bB,bC)};bx.prototype.onEventGeneric=function bu(bD,bE){var bB=function bB(bF,bG){var bH="on"+bF.replace("hls","");if(typeof this[bH]!=="function"){throw new Error("Event "+bF+" has no generic handler in this "+this.constructor.name+" class (tried "+bH+")")}return this[bH].bind(this,bG)};try{bB.call(this,bD,bE).call()}catch(bC){U.b.error("internal error happened while processing "+bD+":"+bC.message);this.hls.trigger(E.a.ERROR,{type:az.b.OTHER_ERROR,details:az.a.INTERNAL_EXCEPTION,fatal:false,event:bD,err:bC})}};return bx}();var a3=(V);function Q(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var e=/^(\d+)x(\d+)$/;var aC=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var aw=function(){function bB(bD){Q(this,bB);if(typeof bD==="string"){bD=bB.parseAttrList(bD)}for(var bC in bD){if(bD.hasOwnProperty(bC)){this[bC]=bD[bC]}}}bB.prototype.decimalInteger=function bA(bC){var bD=parseInt(this[bC],10);if(bD>Number.MAX_SAFE_INTEGER){return Infinity}return bD};bB.prototype.hexadecimalInteger=function bv(bE){if(this[bE]){var bC=(this[bE]||"0x").slice(2);bC=(bC.length&1?"0":"")+bC;var bF=new Uint8Array(bC.length/2);for(var bD=0;bD<bC.length/2;bD++){bF[bD]=parseInt(bC.slice(bD*2,bD*2+2),16)}return bF}else{return null}};bB.prototype.hexadecimalIntegerAsNumber=function by(bC){var bD=parseInt(this[bC],16);if(bD>Number.MAX_SAFE_INTEGER){return Infinity}return bD};bB.prototype.decimalFloatingPoint=function bu(bC){return parseFloat(this[bC])};bB.prototype.enumeratedString=function bz(bC){return this[bC]};bB.prototype.decimalResolution=function bx(bD){var bC=e.exec(this[bD]);if(bC===null){return undefined}return{width:parseInt(bC[1],10),height:parseInt(bC[2],10)}};bB.parseAttrList=function bw(bD){var bF,bE={};aC.lastIndex=0;while((bF=aC.exec(bD))!==null){var bG=bF[2],bC='"';if(bG.indexOf(bC)===0&&bG.lastIndexOf(bC)===bG.length-1){bG=bG.slice(1,-1)}bE[bF[1]]=bG}return bE};return bB}();var bp=(aw);var v={audio:{a3ds:true,"ac-3":true,"ac-4":true,alac:true,alaw:true,dra1:true,"dts+":true,"dts-":true,dtsc:true,dtse:true,dtsh:true,"ec-3":true,enca:true,g719:true,g726:true,m4ae:true,mha1:true,mha2:true,mhm1:true,mhm2:true,mlpa:true,mp4a:true,"raw ":true,Opus:true,samr:true,sawb:true,sawp:true,sevc:true,sqcp:true,ssmv:true,twos:true,ulaw:true},video:{avc1:true,avc2:true,avc3:true,avc4:true,avcp:true,drac:true,dvav:true,dvhe:true,encv:true,hev1:true,hvc1:true,mjp2:true,mp4v:true,mvc1:true,mvc2:true,mvc3:true,mvc4:true,resv:true,rv60:true,s263:true,svc1:true,svc2:true,"vc-1":true,vp08:true,vp09:true}};function P(bw,bv){var bu=v[bv];return !!bu&&bu[bw.slice(0,4)]===true}function aB(bv,bu){return MediaSource.isTypeSupported((bu||"video")+'/mp4;codecs="'+bv+'"')}var ay=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function bg(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function I(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}function bh(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var av=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;var L=/#EXT-X-MEDIA:(.*)/g;var K=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g");var bq=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/;var a6=function(){function bv(){bh(this,bv);this.method=null;this.key=null;this.iv=null;this._uri=null}ay(bv,[{key:"uri",get:function bu(){if(!this._uri&&this.reluri){this._uri=aO.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:true})}return this._uri}}]);return bv}();var aW=function(){function bx(){bh(this,bx);this._url=null;this._byteRange=null;this._decryptdata=null;this.tagList=[]}bx.prototype.createInitializationVector=function by(bC){var bB=new Uint8Array(16);for(var bA=12;bA<16;bA++){bB[bA]=bC>>8*(15-bA)&255}return bB};bx.prototype.fragmentDecryptdataFromLevelkey=function bw(bC,bA){var bB=bC;if(bC&&bC.method&&bC.uri&&!bC.iv){bB=new a6();bB.method=bC.method;bB.baseuri=bC.baseuri;bB.reluri=bC.reluri;bB.iv=this.createInitializationVector(bA)}return bB};bx.prototype.cloneObj=function bv(bA){return JSON.parse(JSON.stringify(bA))};ay(bx,[{key:"url",get:function bu(){if(!this._url&&this.relurl){this._url=aO.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:true})}return this._url},set:function bz(bA){this._url=bA}},{key:"programDateTime",get:function bu(){if(!this._programDateTime&&this.rawProgramDateTime){this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))}return this._programDateTime}},{key:"byteRange",get:function bu(){if(!this._byteRange){var bB=this._byteRange=[];if(this.rawByteRange){var bC=this.rawByteRange.split("@",2);if(bC.length===1){var bA=this.lastByteRangeEndOffset;bB[0]=bA?bA:0}else{bB[0]=parseInt(bC[1])}bB[1]=parseInt(bC[0])+bB[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function bu(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function bu(){return this.byteRange[1]}},{key:"decryptdata",get:function bu(){if(!this._decryptdata){this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)}return this._decryptdata}}]);return bx}();function F(bu,bv){if(!bu){return null}var by=null;for(var bw=0;bw<bu.length;bw++){var bx=bu[bw];if(bx.id===bv){by=bx}}return by}var al=function(bJ){I(bF,bJ);function bF(bK){bh(this,bF);var bL=bg(this,bJ.call(this,bK,E.a.MANIFEST_LOADING,E.a.LEVEL_LOADING,E.a.AUDIO_TRACK_LOADING,E.a.SUBTITLE_TRACK_LOADING));bL.loaders={};return bL}bF.prototype.destroy=function bE(){for(var bL in this.loaders){var bK=this.loaders[bL];if(bK){bK.destroy()}}this.loaders={};a3.prototype.destroy.call(this)};bF.prototype.onManifestLoading=function bA(bK){this.load(bK.url,{type:"manifest"})};bF.prototype.onLevelLoading=function bw(bM){var bL=document.createElement("a");bL.href=this.hls.url;var bK=bL.href;bL=null;if(/^https:/i.test(bK)&&/^http:/i.test(bM.url)){bM.url=bM.url.replace(/^http:/i,"https:")}this.load(bM.url,{type:"level",level:bM.level,id:bM.id})};bF.prototype.onAudioTrackLoading=function bH(bK){this.load(bK.url,{type:"audioTrack",id:bK.id})};bF.prototype.onSubtitleTrackLoading=function bv(bK){this.load(bK.url,{type:"subtitleTrack",id:bK.id})};bF.prototype.load=function bG(bK,bM){var bT=this.loaders[bM.type];if(bT!==undefined){var bR=bT.context;if(bR&&bR.url===bK){U.b.trace("playlist request ongoing");return}else{U.b.warn("abort previous loader for type:"+bM.type);bT.abort()}}var bN=this.hls.config,bS=void 0,bQ=void 0,bU=void 0,bO=void 0;if(bM.type==="manifest"){bS=bN.manifestLoadingMaxRetry;bQ=bN.manifestLoadingTimeOut;bU=bN.manifestLoadingRetryDelay;bO=bN.manifestLoadingMaxRetryTimeout}else{if(bM.type==="level"){bS=0;bQ=bN.levelLoadingTimeOut}else{bS=bN.levelLoadingMaxRetry;bQ=bN.levelLoadingTimeOut;bU=bN.levelLoadingRetryDelay;bO=bN.levelLoadingMaxRetryTimeout;U.b.log("loading playlist for "+bM.type+" "+(bM.level||bM.id))}}bT=this.loaders[bM.type]=bM.loader=typeof bN.pLoader!=="undefined"?new bN.pLoader(bN):new bN.loader(bN);bM.url=bK;bM.responseType="";var bP=void 0,bL=void 0;bP={timeout:bQ,maxRetry:bS,retryDelay:bU,maxRetryDelay:bO};bL={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};bT.load(bM,bP,bL)};bF.prototype.resolve=function bI(bK,bL){return aO.a.buildAbsoluteURL(bL,bK,{alwaysNormalize:true})};bF.prototype.parseMasterPlaylist=function bC(bO,bR){var bP=[],bK=void 0;av.lastIndex=0;function bN(bS,bT){["video","audio"].forEach(function(bV){var bU=bS.filter(function(bX){return P(bX,bV)});if(bU.length){var bW=bU.filter(function(bX){return bX.lastIndexOf("avc1",0)===0||bX.lastIndexOf("mp4a",0)===0});bT[bV+"Codec"]=bW.length>0?bW[0]:bU[0];bS=bS.filter(function(bX){return bU.indexOf(bX)===-1})}});bT.unknownCodecs=bS}while((bK=av.exec(bO))!=null){var bQ={};var bM=bQ.attrs=new bp(bK[1]);bQ.url=this.resolve(bK[2],bR);var bL=bM.decimalResolution("RESOLUTION");if(bL){bQ.width=bL.width;bQ.height=bL.height}bQ.bitrate=bM.decimalInteger("AVERAGE-BANDWIDTH")||bM.decimalInteger("BANDWIDTH");bQ.name=bM.NAME;bN([].concat((bM.CODECS||"").split(/[ ,]+/)),bQ);if(bQ.videoCodec&&bQ.videoCodec.indexOf("avc1")!==-1){bQ.videoCodec=this.avc1toavcoti(bQ.videoCodec)}bP.push(bQ)}return bP};bF.prototype.parseMasterPlaylistMedia=function bz(bN,bO,bQ){var bR=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var bT=void 0;var bP=[];var bL=0;L.lastIndex=0;while((bT=L.exec(bN))!==null){var bM={};var bS=new bp(bT[1]);if(bS.TYPE===bQ){bM.groupId=bS["GROUP-ID"];bM.name=bS.NAME;bM.type=bQ;bM._default=bS.DEFAULT==="YES";bM.autoselect=bS.AUTOSELECT==="YES";bM.forced=bS.FORCED==="YES";if(bS.URI){bM.url=this.resolve(bS.URI,bO)}bM.lang=bS.LANGUAGE;if(!bM.name){bM.name=bM.lang}if(bR.length){var bK=F(bR,bM.groupId);bM.audioCodec=bK?bK.codec:bR[0].codec}bM.id=bL++;bP.push(bM)}}return bP};bF.prototype.avc1toavcoti=function bx(bM){var bL,bK=bM.split(".");if(bK.length>2){bL=bK.shift()+".";bL+=parseInt(bK.shift()).toString(16);bL+=("000"+parseInt(bK.shift()).toString(16)).substr(-4)}else{bL=bM}return bL};bF.prototype.parseLevelPlaylist=function bB(bK,b3,bZ,bQ){var b0=0,ca=0,bN={type:null,version:null,url:b3,fragments:[],live:true,startSN:0},bR=new a6(),bY=0,bM=null,bO=new aW(),bT,b4;K.lastIndex=0;while((bT=K.exec(bK))!==null){var bL=bT[1];if(bL){bO.duration=parseFloat(bL);var cb=(" "+bT[2]).slice(1);bO.title=cb?cb:null;bO.tagList.push(cb?["INF",bL,cb]:["INF",bL])}else{if(bT[3]){if(!isNaN(bO.duration)){var b6=b0++;bO.type=bQ;bO.start=ca;bO.levelkey=bR;bO.sn=b6;bO.level=bZ;bO.cc=bY;bO.baseurl=b3;bO.relurl=(" "+bT[3]).slice(1);bN.fragments.push(bO);bM=bO;ca+=bO.duration;bO=new aW()}}else{if(bT[4]){bO.rawByteRange=(" "+bT[4]).slice(1);if(bM){var bU=bM.byteRangeEndOffset;if(bU){bO.lastByteRangeEndOffset=bU}}}else{if(bT[5]){bO.rawProgramDateTime=(" "+bT[5]).slice(1);bO.tagList.push(["PROGRAM-DATE-TIME",bO.rawProgramDateTime]);if(bN.programDateTime===undefined){bN.programDateTime=new Date(new Date(Date.parse(bT[5]))-1000*ca)}}else{bT=bT[0].match(bq);for(b4=1;b4<bT.length;b4++){if(bT[b4]!==undefined){break}}var bW=(" "+bT[b4+1]).slice(1);var bV=(" "+bT[b4+2]).slice(1);switch(bT[b4]){case"#":bO.tagList.push(bV?[bW,bV]:[bW]);break;case"PLAYLIST-TYPE":bN.type=bW.toUpperCase();break;case"MEDIA-SEQUENCE":b0=bN.startSN=parseInt(bW);break;case"TARGETDURATION":bN.targetduration=parseFloat(bW);break;case"VERSION":bN.version=parseInt(bW);break;case"EXTM3U":break;case"ENDLIST":bN.live=false;break;case"DIS":bY++;bO.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":bY=parseInt(bW);break;case"KEY":var b9=bW;var b2=new bp(b9);var bP=b2.enumeratedString("METHOD"),b1=b2.URI,b8=b2.hexadecimalInteger("IV");if(bP){bR=new a6();if(b1&&["AES-128","SAMPLE-AES"].indexOf(bP)>=0){bR.method=bP;bR.baseuri=b3;bR.reluri=b1;bR.key=null;bR.iv=b8}}break;case"START":var bS=bW;var bX=new bp(bS);var b7=bX.decimalFloatingPoint("TIME-OFFSET");if(!isNaN(b7)){bN.startTimeOffset=b7}break;case"MAP":var b5=new bp(bW);bO.relurl=b5.URI;bO.rawByteRange=b5.BYTERANGE;bO.baseurl=b3;bO.level=bZ;bO.type=bQ;bO.sn="initSegment";bN.initSegment=bO;bO=new aW();break;default:U.b.warn("line parsed but not handled: "+bT);break}}}}}}bO=bM;if(bO&&!bO.relurl){bN.fragments.pop();ca-=bO.duration}bN.totalduration=ca;bN.averagetargetduration=ca/bN.fragments.length;bN.endSN=b0-1;bN.startCC=bN.fragments[0]?bN.fragments[0].cc:0;bN.endCC=bY;return bN};bF.prototype.loadsuccess=function by(bL,b1,bN){var bV=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var bK=bL.data,bS=bL.url,bR=bN.type,bW=bN.id,bM=bN.level,bZ=this.hls;this.loaders[bR]=undefined;if(bS===undefined||bS.indexOf("data:")===0){bS=bN.url}b1.tload=performance.now();if(bK.indexOf("#EXTM3U")===0){if(bK.indexOf("#EXTINF:")>0){var bO=bR!=="audioTrack"&&bR!=="subtitleTrack",bP=!isNaN(bM)?bM:!isNaN(bW)?bW:0,bX=this.parseLevelPlaylist(bK,bS,bP,bR==="audioTrack"?"audio":bR==="subtitleTrack"?"subtitle":"main");bX.tload=b1.tload;if(bR==="manifest"){bZ.trigger(E.a.MANIFEST_LOADED,{levels:[{url:bS,details:bX}],audioTracks:[],url:bS,stats:b1,networkDetails:bV})}b1.tparsed=performance.now();if(bX.targetduration){if(bO){bZ.trigger(E.a.LEVEL_LOADED,{details:bX,level:bM||0,id:bW||0,stats:b1,networkDetails:bV})}else{if(bR==="audioTrack"){bZ.trigger(E.a.AUDIO_TRACK_LOADED,{details:bX,id:bW,stats:b1,networkDetails:bV})}else{if(bR==="subtitleTrack"){bZ.trigger(E.a.SUBTITLE_TRACK_LOADED,{details:bX,id:bW,stats:b1,networkDetails:bV})}}}}else{bZ.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.MANIFEST_PARSING_ERROR,fatal:true,url:bS,reason:"invalid targetduration",networkDetails:bV})}}else{var bU=this.parseMasterPlaylist(bK,bS);if(bU.length){var bT=bU.map(function(b2){return{id:b2.attrs.AUDIO,codec:b2.audioCodec}});var bQ=this.parseMasterPlaylistMedia(bK,bS,"AUDIO",bT);var b0=this.parseMasterPlaylistMedia(bK,bS,"SUBTITLES");if(bQ.length){var bY=false;bQ.forEach(function(b2){if(!b2.url){bY=true}});if(bY===false&&bU[0].audioCodec&&!bU[0].attrs.AUDIO){U.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one");bQ.unshift({type:"main",name:"main"})}}bZ.trigger(E.a.MANIFEST_LOADED,{levels:bU,audioTracks:bQ,subtitles:b0,url:bS,stats:b1,networkDetails:bV})}else{bZ.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.MANIFEST_PARSING_ERROR,fatal:true,url:bS,reason:"no level found in manifest",networkDetails:bV})}}}else{bZ.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.MANIFEST_PARSING_ERROR,fatal:true,url:bS,reason:"no EXTM3U delimiter",networkDetails:bV})}};bF.prototype.loaderror=function bD(bM,bO){var bL=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var bN,bP,bK=bO.loader;switch(bO.type){case"manifest":bN=az.a.MANIFEST_LOAD_ERROR;bP=true;break;case"level":bN=az.a.LEVEL_LOAD_ERROR;bP=false;break;case"audioTrack":bN=az.a.AUDIO_TRACK_LOAD_ERROR;bP=false;break}if(bK){bK.abort();this.loaders[bO.type]=undefined}this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:bN,fatal:bP,url:bK.url,loader:bK,response:bM,context:bO,networkDetails:bL})};bF.prototype.loadtimeout=function bu(bO,bN){var bL=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var bM,bP,bK=bN.loader;switch(bN.type){case"manifest":bM=az.a.MANIFEST_LOAD_TIMEOUT;bP=true;break;case"level":bM=az.a.LEVEL_LOAD_TIMEOUT;bP=false;break;case"audioTrack":bM=az.a.AUDIO_TRACK_LOAD_TIMEOUT;bP=false;break}if(bK){bK.abort();this.loaders[bN.type]=undefined}this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:bM,fatal:bP,url:bK.url,loader:bK,context:bN,networkDetails:bL})};return bF}(a3);var aL=(al);function af(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function bb(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function bd(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var aV=function(by){bd(bB,by);function bB(bC){af(this,bB);var bD=bb(this,by.call(this,bC,E.a.FRAG_LOADING));bD.loaders={};return bD}bB.prototype.destroy=function bx(){var bD=this.loaders;for(var bE in bD){var bC=bD[bE];if(bC){bC.destroy()}}this.loaders={};a3.prototype.destroy.call(this)};bB.prototype.onFragLoading=function bA(bG){var bL=bG.frag,bI=bL.type,bK=this.loaders[bI],bE=this.hls.config;bL.loaded=0;if(bK){U.b.warn("abort previous fragment loader for type:"+bI);bK.abort()}bK=this.loaders[bI]=bL.loader=typeof bE.fLoader!=="undefined"?new bE.fLoader(bE):new bE.loader(bE);var bJ=void 0,bH=void 0,bD=void 0;bJ={url:bL.url,frag:bL,responseType:"arraybuffer",progressData:false};var bC=bL.byteRangeStartOffset,bF=bL.byteRangeEndOffset;if(!isNaN(bC)&&!isNaN(bF)){bJ.rangeStart=bC;bJ.rangeEnd=bF}bH={timeout:bE.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:bE.fragLoadingMaxRetryTimeout};bD={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};bK.load(bJ,bH,bD)};bB.prototype.loadsuccess=function bv(bD,bF,bE){var bC=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var bG=bD.data,bH=bE.frag;bH.loader=undefined;this.loaders[bH.type]=undefined;this.hls.trigger(E.a.FRAG_LOADED,{payload:bG,frag:bH,stats:bF,networkDetails:bC})};bB.prototype.loaderror=function bz(bE,bF){var bD=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var bC=bF.loader;if(bC){bC.abort()}this.loaders[bF.type]=undefined;this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.FRAG_LOAD_ERROR,fatal:false,frag:bF.frag,response:bE,networkDetails:bD})};bB.prototype.loadtimeout=function bu(bF,bE){var bD=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var bC=bE.loader;if(bC){bC.abort()}this.loaders[bE.type]=undefined;this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.FRAG_LOAD_TIMEOUT,fatal:false,frag:bE.frag,networkDetails:bD})};bB.prototype.loadprogress=function bw(bE,bD,bF){var bC=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var bG=bD.frag;bG.loaded=bE.loaded;this.hls.trigger(E.a.FRAG_LOAD_PROGRESS,{frag:bG,stats:bE,networkDetails:bC})};return bB}(a3);var p=(aV);function w(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function bk(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function s(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var bc=function(bx){s(bA,bx);function bA(bB){w(this,bA);var bC=bk(this,bx.call(this,bB,E.a.KEY_LOADING));bC.loaders={};bC.decryptkey=null;bC.decrypturl=null;return bC}bA.prototype.destroy=function bw(){for(var bC in this.loaders){var bB=this.loaders[bC];if(bB){bB.destroy()}}this.loaders={};a3.prototype.destroy.call(this)};bA.prototype.onKeyLoading=function by(bE){var bJ=bE.frag,bG=bJ.type,bI=this.loaders[bG],bK=bJ.decryptdata,bC=bK.uri;if(bC!==this.decrypturl||this.decryptkey===null){var bD=this.hls.config;if(bI){U.b.warn("abort previous key loader for type:"+bG);bI.abort()}bJ.loader=this.loaders[bG]=new bD.loader(bD);this.decrypturl=bC;this.decryptkey=null;var bH=void 0,bF=void 0,bB=void 0;bH={url:bC,frag:bJ,responseType:"arraybuffer"};bF={timeout:bD.fragLoadingTimeOut,maxRetry:bD.fragLoadingMaxRetry,retryDelay:bD.fragLoadingRetryDelay,maxRetryDelay:bD.fragLoadingMaxRetryTimeout};bB={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};bJ.loader.load(bH,bF,bB)}else{if(this.decryptkey){bK.key=this.decryptkey;this.hls.trigger(E.a.KEY_LOADED,{frag:bJ})}}};bA.prototype.loadsuccess=function bv(bB,bD,bC){var bE=bC.frag;this.decryptkey=bE.decryptdata.key=new Uint8Array(bB.data);bE.loader=undefined;this.loaders[bE.type]=undefined;this.hls.trigger(E.a.KEY_LOADED,{frag:bE})};bA.prototype.loaderror=function bz(bC,bD){var bE=bD.frag,bB=bE.loader;if(bB){bB.abort()}this.loaders[bD.type]=undefined;this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.KEY_LOAD_ERROR,fatal:false,frag:bE,response:bC})};bA.prototype.loadtimeout=function bu(bD,bC){var bE=bC.frag,bB=bE.loader;if(bB){bB.abort()}this.loaders[bC.type]=undefined;this.hls.trigger(E.a.ERROR,{type:az.b.NETWORK_ERROR,details:az.a.KEY_LOAD_TIMEOUT,fatal:false,frag:bE})};return bA}(a3);var aR=(bc);var aK={search:function D(bA,bw){var by=0;var bz=bA.length-1;var bv=null;var bx=null;while(by<=bz){bv=(by+bz)/2|0;bx=bA[bv];var bu=bw(bx);if(bu>0){by=bv+1}else{if(bu<0){bz=bv-1}else{return bx}}}return null}};var ae=(aK);var i={isBuffered:function y(by,bu){try{if(by){var bx=by.buffered;for(var bw=0;bw<bx.length;bw++){if(bu>=bx.start(bw)&&bu<=bx.end(bw)){return true}}}}catch(bv){}return false},bufferInfo:function aI(bz,bA,by){try{if(bz){var bu=bz.buffered,bx=[],bw;for(bw=0;bw<bu.length;bw++){bx.push({start:bu.start(bw),end:bu.end(bw)})}return this.bufferedInfo(bx,bA,by)}}catch(bv){}return{len:0,start:bA,end:bA,nextStart:undefined}},bufferedInfo:function R(bw,bD,bB){var bA=[],bv,bF,bG,bC,by;bw.sort(function(bI,bH){var bJ=bI.start-bH.start;if(bJ){return bJ}else{return bH.end-bI.end}});for(by=0;by<bw.length;by++){var bE=bA.length;if(bE){var bz=bA[bE-1].end;if(bw[by].start-bz<bB){if(bw[by].end>bz){bA[bE-1].end=bw[by].end}}else{bA.push(bw[by])}}else{bA.push(bw[by])}}for(by=0,bv=0,bF=bG=bD;by<bA.length;by++){var bu=bA[by].start,bx=bA[by].end;if(bD+bB>=bu&&bD<bx){bF=bu;bG=bx;bv=bG-bD}else{if(bD+bB<bu){bC=bu;break}}}return{len:bv,start:bF,end:bG,nextStart:bC}}};var aY=(i);var n=ba(7);var M=ba(5);var ac=ba.n(M);var a0=ba(9);var g=ba.n(a0);function ap(){if(typeof window!=="undefined"){return window.MediaSource||window.WebKitMediaSource}}function at(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var aQ=ap();var t=function(){function bv(bz,bA){at(this,bv);this.hls=bz;this.id=bA;var bG=this.observer=new ac.a();var bC=bz.config;bG.trigger=function bD(bL){for(var bJ=arguments.length,bM=Array(bJ>1?bJ-1:0),bK=1;bK<bJ;bK++){bM[bK-1]=arguments[bK]}bG.emit.apply(bG,[bL,bL].concat(bM))};bG.off=function bB(bL){for(var bJ=arguments.length,bM=Array(bJ>1?bJ-1:0),bK=1;bK<bJ;bK++){bM[bK-1]=arguments[bK]}bG.removeListener.apply(bG,[bL].concat(bM))};var bE=function(bJ,bK){bK=bK||{};bK.frag=this.frag;bK.id=this.id;bz.trigger(bJ,bK)}.bind(this);bG.on(E.a.FRAG_DECRYPTED,bE);bG.on(E.a.FRAG_PARSING_INIT_SEGMENT,bE);bG.on(E.a.FRAG_PARSING_DATA,bE);bG.on(E.a.FRAG_PARSED,bE);bG.on(E.a.ERROR,bE);bG.on(E.a.FRAG_PARSING_METADATA,bE);bG.on(E.a.FRAG_PARSING_USERDATA,bE);bG.on(E.a.INIT_PTS_FOUND,bE);var by={mp4:aQ.isTypeSupported("video/mp4"),mpeg:aQ.isTypeSupported("audio/mpeg"),mp3:aQ.isTypeSupported('audio/mp4; codecs="mp3"')};var bI=navigator.vendor;if(bC.enableWorker&&typeof Worker!=="undefined"){U.b.log("demuxing in webworker");var bH=void 0;try{bH=this.w=g()((10));this.onwmsg=this.onWorkerMessage.bind(this);bH.addEventListener("message",this.onwmsg);bH.onerror=function(bJ){bz.trigger(E.a.ERROR,{type:az.b.OTHER_ERROR,details:az.a.INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",err:{message:bJ.message+" ("+bJ.filename+":"+bJ.lineno+")"}})};bH.postMessage({cmd:"init",typeSupported:by,vendor:bI,id:bA,config:JSON.stringify(bC)})}catch(bF){U.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline");if(bH){URL.revokeObjectURL(bH.objectURL)}this.demuxer=new n.a(bG,by,bC,bI);this.w=undefined}}else{this.demuxer=new n.a(bG,by,bC,bI)}}bv.prototype.destroy=function bx(){var by=this.w;if(by){by.removeEventListener("message",this.onwmsg);by.terminate();this.w=null}else{var bA=this.demuxer;if(bA){bA.destroy();this.demuxer=null}}var bz=this.observer;if(bz){bz.removeAllListeners();this.observer=null}};bv.prototype.push=function bu(bF,bG,bO,bE,bN,bD,bB,bz){var bK=this.w;var bL=!isNaN(bN.startDTS)?bN.startDTS:bN.start;var bM=bN.decryptdata;var bJ=this.frag;var bC=!(bJ&&bN.cc===bJ.cc);var bI=!(bJ&&bN.level===bJ.level);var bH=bJ&&bN.sn===bJ.sn+1;var by=!bI&&bH;if(bC){U.b.log(this.id+":discontinuity detected")}if(bI){U.b.log(this.id+":switch detected")}this.frag=bN;if(bK){bK.postMessage({cmd:"demux",data:bF,decryptdata:bM,initSegment:bG,audioCodec:bO,videoCodec:bE,timeOffset:bL,discontinuity:bC,trackSwitch:bI,contiguous:by,duration:bD,accurateTimeOffset:bB,defaultInitPTS:bz},bF instanceof ArrayBuffer?[bF]:[])}else{var bA=this.demuxer;if(bA){bA.push(bF,bM,bG,bO,bE,bL,bC,bI,by,bD,bB,bz)}}};bv.prototype.onWorkerMessage=function bw(bz){var bA=bz.data,by=this.hls;switch(bA.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case E.a.FRAG_PARSING_DATA:bA.data.data1=new Uint8Array(bA.data1);if(bA.data2){bA.data.data2=new Uint8Array(bA.data2)}default:bA.data=bA.data||{};bA.data.frag=this.frag;bA.data.id=this.id;by.trigger(bA.event,bA.data);break}};return bv}();var aA=(t);function ai(bv,bx,bz){var bu=bv[bx],bw=bv[bz],by=bw.startPTS;if(!isNaN(by)){if(bz>bx){bu.duration=by-bu.start;if(bu.duration<0){U.b.warn("negative duration computed for frag "+bu.sn+",level "+bu.level+", there should be some duration drift between playlist and fragment!")}}else{bw.duration=bu.start-by;if(bw.duration<0){U.b.warn("negative duration computed for frag "+bw.sn+",level "+bw.level+", there should be some duration drift between playlist and fragment!")}}}else{if(bz>bx){bw.start=bu.start+bu.duration}else{bw.start=Math.max(bu.start-bw.duration,0)}}}function aT(bu,bG,by,bF,bC,bx){var bz=by;if(!isNaN(bG.startPTS)){var bv=Math.abs(bG.startPTS-by);if(isNaN(bG.deltaPTS)){bG.deltaPTS=bv}else{bG.deltaPTS=Math.max(bv,bG.deltaPTS)}bz=Math.max(by,bG.startPTS);by=Math.min(by,bG.startPTS);bF=Math.max(bF,bG.endPTS);bC=Math.min(bC,bG.startDTS);bx=Math.max(bx,bG.endDTS)}var bE=by-bG.start;bG.start=bG.startPTS=by;bG.maxStartPTS=bz;bG.endPTS=bF;bG.startDTS=bC;bG.endDTS=bx;bG.duration=bF-by;var bw=bG.sn;if(!bu||bw<bu.startSN||bw>bu.endSN){return 0}var bD,bB,bA;bD=bw-bu.startSN;bB=bu.fragments;bB[bD]=bG;for(bA=bD;bA>0;bA--){ai(bB,bA,bA-1)}for(bA=bD;bA<bB.length-1;bA++){ai(bB,bA,bA+1)}bu.PTSKnown=true;return bE}function ab(bu,by){var bv=Math.max(bu.startSN,by.startSN)-by.startSN,bx=Math.min(bu.endSN,by.endSN)-by.startSN,bF=by.startSN-bu.startSN,bE=bu.fragments,bA=by.fragments,bD=0,bw;if(bx<bv){by.PTSKnown=false;return}for(var bz=bv;bz<=bx;bz++){var bG=bE[bF+bz],bC=bA[bz];if(bC&&bG){bD=bG.cc-bC.cc;if(!isNaN(bG.startPTS)){bC.start=bC.startPTS=bG.startPTS;bC.endPTS=bG.endPTS;bC.duration=bG.duration;bC.backtracked=bG.backtracked;bC.dropped=bG.dropped;bw=bC}}}if(bD){U.b.log("discontinuity sliding from playlist, take drift into account");for(bz=0;bz<bA.length;bz++){bA[bz].cc+=bD}}if(bw){aT(by,bw,bw.startPTS,bw.endPTS,bw.startDTS,bw.endDTS)}else{if(bF>=0&&bF<bE.length){var bB=bE[bF].start;for(bz=0;bz<bA.length;bz++){bA[bz].start+=bB}}}by.PTSKnown=bu.PTSKnown}var au={toString:function aF(bx){var bw="",bu=bx.length;for(var bv=0;bv<bu;bv++){bw+="["+bx.start(bv).toFixed(3)+","+bx.end(bv).toFixed(3)+"]"}return bw}};var ak=(au);function m(bu,by){var bv=null;for(var bw=0;bw<bu.length;bw+=1){var bx=bu[bw];if(bx&&bx.cc===by){bv=bx;break}}return bv}function a7(bv,bu){return ae.search(bv,function(bw){if(bw.cc<bu){return 1}else{if(bw.cc>bu){return -1}else{return 0}}})}function H(bx,bv,bu){var bw=false;if(bv&&bv.details&&bu){if(bu.endCC>bu.startCC||bx&&bx.cc<bu.startCC){bw=true}}return bw}function c(bv,bw){var by=bv.fragments;var bx=bw.fragments;if(!bx.length||!by.length){U.b.log("No fragments to align");return}var bu=m(by,bx[0].cc);if(!bu||bu&&!bu.startPTS){U.b.log("No frag in previous level to align on");return}return bu}function bl(bv,bu){bu.fragments.forEach(function(bx){if(bx){var bw=bx.start+bv;bx.start=bx.startPTS=bw;bx.endPTS=bw+bx.duration}});bu.PTSKnown=true}function h(bA,by,bw){if(H(bA,by,bw)){var bx=c(by.details,bw);if(bx){U.b.log("Adjusting PTS using last level due to CC increase within current level");bl(bx.start,bw)}}if(bw.PTSKnown===false&&by&&by.details){var bz=by.details.programDateTime;var bv=bw.programDateTime;var bu=(bv-bz)/1000+by.details.fragments[0].start;if(!isNaN(bu)){U.b.log("adjusting PTS using programDateTime delta, sliding:"+bu.toFixed(3));bl(bu,bw)}}}var N=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function a5(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function J(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function G(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var bt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};var bs=function(bU){G(bW,bU);function bW(ce){a5(this,bW);var cf=J(this,bU.call(this,ce,E.a.MEDIA_ATTACHED,E.a.MEDIA_DETACHING,E.a.MANIFEST_LOADING,E.a.MANIFEST_PARSED,E.a.LEVEL_LOADED,E.a.KEY_LOADED,E.a.FRAG_LOADED,E.a.FRAG_LOAD_EMERGENCY_ABORTED,E.a.FRAG_PARSING_INIT_SEGMENT,E.a.FRAG_PARSING_DATA,E.a.FRAG_PARSED,E.a.ERROR,E.a.AUDIO_TRACK_SWITCHING,E.a.AUDIO_TRACK_SWITCHED,E.a.BUFFER_CREATED,E.a.BUFFER_APPENDED,E.a.BUFFER_FLUSHED));cf.config=ce.config;cf.audioCodecSwap=false;cf.ticks=0;cf._state=bt.STOPPED;cf.ontick=cf.tick.bind(cf);return cf}bW.prototype.destroy=function b1(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}a3.prototype.destroy.call(this);this.state=bt.STOPPED};bW.prototype.startLoad=function by(ch){if(this.levels){var ce=this.lastCurrentTime,cf=this.hls;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var cg=cf.startLevel;if(cg===-1){cg=0;this.bitrateTest=true}this.level=cf.nextLoadLevel=cg;this.loadedmetadata=false}if(ce>0&&ch===-1){U.b.log("override startPosition with lastCurrentTime @"+ce.toFixed(3));ch=ce}this.state=bt.IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=ch;this.tick()}else{this.forceStartLoad=true;this.state=bt.STOPPED}};bW.prototype.stopLoad=function bP(){var ce=this.fragCurrent;if(ce){if(ce.loader){ce.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=bt.STOPPED;this.forceStartLoad=false};bW.prototype.tick=function bw(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}};bW.prototype.doTick=function bA(){switch(this.state){case bt.ERROR:break;case bt.BUFFER_FLUSHING:this.fragLoadError=0;break;case bt.IDLE:this._doTickIdle();break;case bt.WAITING_LEVEL:var cg=this.levels[this.level];if(cg&&cg.details){this.state=bt.IDLE}break;case bt.FRAG_LOADING_WAITING_RETRY:var cf=performance.now();var ce=this.retryDate;if(!ce||cf>=ce||this.media&&this.media.seeking){U.b.log("mediaController: retryDate reached, switch back to IDLE state");this.state=bt.IDLE}break;case bt.ERROR:case bt.STOPPED:case bt.FRAG_LOADING:case bt.PARSING:case bt.PARSED:case bt.ENDED:break;default:break}this._checkBuffer();this._checkFragmentChanged()};bW.prototype._doTickIdle=function bF(){var ce=this.hls,cj=ce.config,ch=this.media;if(this.levelLastLoaded===undefined||!ch&&(this.startFragRequested||!cj.startFragPrefetch)){return}var cp=void 0;if(this.loadedmetadata){cp=ch.currentTime}else{cp=this.nextLoadPosition}var cg=ce.nextLoadLevel,cq=this.levels[cg];if(!cq){return}var cn=cq.bitrate,cr=void 0;if(cn){cr=Math.max(8*cj.maxBufferSize/cn,cj.maxBufferLength)}else{cr=cj.maxBufferLength}cr=Math.min(cr,cj.maxMaxBufferLength);var cm=aY.bufferInfo(this.mediaBuffer?this.mediaBuffer:ch,cp,cj.maxBufferHole),ci=cm.len;if(ci>=cr){return}U.b.trace("buffer length of "+ci.toFixed(3)+" is below max of "+cr.toFixed(3)+". checking for more payload ...");this.level=ce.nextLoadLevel=cg;var co=cq.details;if(co===undefined||co.live===true&&this.levelLastLoaded!==cg){this.state=bt.WAITING_LEVEL;return}var cf=this.fragPrevious;if(!co.live&&cf&&!cf.backtracked&&cf.sn===co.endSN&&!cm.nextStart){var ck=Math.min(ch.duration,cf.start+cf.duration);if(ck-Math.max(cm.end,cf.start)<=Math.max(0.2,cf.duration)){var cl={};if(this.altAudio){cl.type="video"}this.hls.trigger(E.a.BUFFER_EOS,cl);this.state=bt.ENDED;return}}this._fetchPayloadOrEos(cp,cm,co)};bW.prototype._fetchPayloadOrEos=function bx(cm,cj,cn){var cf=this.fragPrevious,ce=this.level,cl=cn.fragments,ck=cl.length;if(ck===0){return}var cg=cl[0].start,ci=cl[ck-1].start+cl[ck-1].duration,cp=cj.end,co=void 0;if(cn.initSegment&&!cn.initSegment.data){co=cn.initSegment}else{if(cn.live){var ch=this.config.initialLiveManifestSize;if(ck<ch){U.b.warn("Can not start playback of a level, reason: not enough fragments "+ck+" < "+ch);return}co=this._ensureFragmentAtLivePoint(cn,cp,cg,ci,cf,cl,ck);if(co===null){return}}else{if(cp<cg){co=cl[0]}}}if(!co){co=this._findFragment(cg,cf,ck,cl,cp,ci,cn)}if(co){this._loadFragmentOrKey(co,ce,cn,cm,cp)}return};bW.prototype._ensureFragmentAtLivePoint=function bz(cn,cr,cf,ck,ce,cm,cl){var ci=this.hls.config,cg=this.media;var cq=void 0;var cp=ci.liveMaxLatencyDuration!==undefined?ci.liveMaxLatencyDuration:ci.liveMaxLatencyDurationCount*cn.targetduration;if(cr<Math.max(cf-ci.maxFragLookUpTolerance,ck-cp)){var co=this.liveSyncPosition=this.computeLivePosition(cf,cn);U.b.log("buffer end: "+cr.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+co.toFixed(3));cr=co;if(cg&&cg.readyState&&cg.duration>co){cg.currentTime=co}this.nextLoadPosition=co}if(cn.PTSKnown&&cr>ck&&cg&&cg.readyState){return null}if(this.startFragRequested&&!cn.PTSKnown){if(ce){var cj=ce.sn+1;if(cj>=cn.startSN&&cj<=cn.endSN){var ch=cm[cj-cn.startSN];if(ce.cc===ch.cc){cq=ch;U.b.log("live playlist, switching playlist, load frag with next SN: "+cq.sn)}}if(!cq){cq=ae.search(cm,function(cs){return ce.cc-cs.cc});if(cq){U.b.log("live playlist, switching playlist, load frag with same CC: "+cq.sn)}}}if(!cq){cq=cm[Math.min(cl-1,Math.round(cl/2))];U.b.log("live playlist, switching playlist, unknown, load middle frag : "+cq.sn)}}return cq};bW.prototype._findFragment=function bJ(cj,cl,cq,cv,ci,ch,cp){var cu=this.hls.config;var cf=void 0;var cm=void 0;var cg=cu.maxFragLookUpTolerance;var cr=cl?cv[cl.sn-cv[0].sn+1]:undefined;var cs=function cs(cw){var cx=Math.min(cg,cw.duration+(cw.deltaPTS?cw.deltaPTS:0));if(cw.start+cw.duration-cx<=ci){return 1}else{if(cw.start-cx>ci&&cw.start){return -1}}return 0};if(ci<ch){if(ci>ch-cg){cg=0}if(cr&&!cs(cr)){cm=cr}else{cm=ae.search(cv,cs)}}else{cm=cv[cq-1]}if(cm){cf=cm;var cn=cf.sn-cp.startSN;var ct=cl&&cf.level===cl.level;var ce=cv[cn-1];var co=cv[cn+1];if(cl&&cf.sn===cl.sn){if(ct&&!cf.backtracked){if(cf.sn<cp.endSN){var ck=cl.deltaPTS;if(ck&&ck>cu.maxBufferHole&&cl.dropped&&cn){cf=ce;U.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this");cl.loadCounter--}else{cf=co;U.b.log("SN just loaded, load next one: "+cf.sn)}}else{cf=null}}else{if(cf.backtracked){if(co&&co.backtracked){U.b.warn("Already backtracked from fragment "+co.sn+", will not backtrack to fragment "+cf.sn+". Loading fragment "+co.sn);cf=co}else{U.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe");cf.dropped=0;if(ce){if(ce.loadCounter){ce.loadCounter--}cf=ce;cf.backtracked=true}else{if(cn){cf=null}}}}}}}return cf};bW.prototype._loadFragmentOrKey=function bR(cl,ck,cf,cj,ci){var ch=this.hls,cg=ch.config;if(cl.decryptdata&&cl.decryptdata.uri!=null&&cl.decryptdata.key==null){U.b.log("Loading key for "+cl.sn+" of ["+cf.startSN+" ,"+cf.endSN+"],level "+ck);this.state=bt.KEY_LOADING;ch.trigger(E.a.KEY_LOADING,{frag:cl})}else{U.b.log("Loading "+cl.sn+" of ["+cf.startSN+" ,"+cf.endSN+"],level "+ck+", currentTime:"+cj.toFixed(3)+",bufferEnd:"+ci.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(cl.loadCounter){cl.loadCounter++;var ce=cg.fragLoadingLoopThreshold;if(cl.loadCounter>ce&&Math.abs(this.fragLoadIdx-cl.loadIdx)<ce){ch.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:cl});return}}else{cl.loadCounter=1}cl.loadIdx=this.fragLoadIdx;cl.autoLevel=ch.autoLevelEnabled;cl.bitrateTest=this.bitrateTest;this.fragCurrent=cl;this.startFragRequested=true;if(!isNaN(cl.sn)&&!cl.bitrateTest){this.nextLoadPosition=cl.start+cl.duration}ch.trigger(E.a.FRAG_LOADING,{frag:cl});if(!this.demuxer){this.demuxer=new aA(ch,"main")}this.state=bt.FRAG_LOADING;return}};bW.prototype.getBufferedFrag=function bv(ce){return ae.search(this._bufferedFrags,function(cf){if(ce<cf.startPTS){return -1}else{if(ce>cf.endPTS){return 1}}return 0})};bW.prototype.followingBufferedFrag=function ca(ce){if(ce){return this.getBufferedFrag(ce.endPTS+0.5)}return null};bW.prototype._checkFragmentChanged=function b6(){var ch,cg,cf=this.media;if(cf&&cf.readyState&&cf.seeking===false){cg=cf.currentTime;if(cg>cf.playbackRate*this.lastCurrentTime){this.lastCurrentTime=cg}if(aY.isBuffered(cf,cg)){ch=this.getBufferedFrag(cg)}else{if(aY.isBuffered(cf,cg+0.1)){ch=this.getBufferedFrag(cg+0.1)}}if(ch){var ci=ch;if(ci!==this.fragPlaying){this.hls.trigger(E.a.FRAG_CHANGED,{frag:ci});var ce=ci.level;if(!this.fragPlaying||this.fragPlaying.level!==ce){this.hls.trigger(E.a.LEVEL_SWITCHED,{level:ce})}this.fragPlaying=ci}}}};bW.prototype.immediateLevelSwitch=function bN(){U.b.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;var cg=this.media,cf=void 0;if(cg){cf=cg.paused;cg.pause()}else{cf=true}this.previouslyPaused=cf}var ce=this.fragCurrent;if(ce&&ce.loader){ce.loader.abort()}this.fragCurrent=null;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.flushMainBuffer(0,Number.POSITIVE_INFINITY)};bW.prototype.immediateLevelSwitchEnd=function b5(){var ce=this.media;if(ce&&ce.buffered.length){this.immediateSwitch=false;if(aY.isBuffered(ce,ce.currentTime)){ce.currentTime-=0.0001}if(!this.previouslyPaused){ce.play()}}};bW.prototype.nextLevelSwitch=function bT(){var ck=this.media;if(ck&&ck.readyState){var cl=void 0,cj=void 0,cg=void 0;if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}cj=this.getBufferedFrag(ck.currentTime);if(cj&&cj.startPTS>1){this.flushMainBuffer(0,cj.startPTS-1)}if(!ck.paused){var cf=this.hls.nextLoadLevel,ci=this.levels[cf],ch=this.fragLastKbps;if(ch&&this.fragCurrent){cl=this.fragCurrent.duration*ci.bitrate/(1000*ch)+1}else{cl=0}}else{cl=0}cg=this.getBufferedFrag(ck.currentTime+cl);if(cg){cg=this.followingBufferedFrag(cg);if(cg){var ce=this.fragCurrent;if(ce&&ce.loader){ce.loader.abort()}this.fragCurrent=null;this.flushMainBuffer(cg.maxStartPTS,Number.POSITIVE_INFINITY)}}}};bW.prototype.flushMainBuffer=function bG(ce,cg){this.state=bt.BUFFER_FLUSHING;var cf={startOffset:ce,endOffset:cg};if(this.altAudio){cf.type="video"}this.hls.trigger(E.a.BUFFER_FLUSHING,cf)};bW.prototype.onMediaAttached=function bQ(cf){var cg=this.media=this.mediaBuffer=cf.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);cg.addEventListener("seeking",this.onvseeking);cg.addEventListener("seeked",this.onvseeked);cg.addEventListener("ended",this.onvended);var ce=this.config;if(this.levels&&ce.autoStartLoad){this.hls.startLoad(ce.startPosition)}};bW.prototype.onMediaDetaching=function bL(){var cf=this.media;if(cf&&cf.ended){U.b.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var ce=this.levels;if(ce){ce.forEach(function(cg){if(cg.details){cg.details.fragments.forEach(function(ch){ch.loadCounter=undefined;ch.backtracked=undefined})}})}if(cf){cf.removeEventListener("seeking",this.onvseeking);cf.removeEventListener("seeked",this.onvseeked);cf.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.stopLoad()};bW.prototype.onMediaSeeking=function bD(){var cf=this.media,ce=cf?cf.currentTime:undefined,cg=this.config;if(!isNaN(ce)){U.b.log("media seeking to "+ce.toFixed(3))}var ci=this.mediaBuffer?this.mediaBuffer:cf;var ch=aY.bufferInfo(ci,ce,this.config.maxBufferHole);if(this.state===bt.FRAG_LOADING){var cm=this.fragCurrent;if(ch.len===0&&cm){var ck=cg.maxFragLookUpTolerance,cj=cm.start-ck,cl=cm.start+cm.duration+ck;if(ce<cj||ce>cl){if(cm.loader){U.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load");cm.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;this.state=bt.IDLE}else{U.b.log("seeking outside of buffer but within currently loaded fragment range")}}}else{if(this.state===bt.ENDED){if(ch.len===0){this.fragPrevious=0}this.state=bt.IDLE}}if(cf){this.lastCurrentTime=ce}if(this.state!==bt.FRAG_LOADING&&this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*cg.fragLoadingLoopThreshold}if(!this.loadedmetadata){this.nextLoadPosition=this.startPosition=ce}this.tick()};bW.prototype.onMediaSeeked=function cd(){var cf=this.media,ce=cf?cf.currentTime:undefined;if(!isNaN(ce)){U.b.log("media seeked to "+ce.toFixed(3))}this.tick()};bW.prototype.onMediaEnded=function bS(){U.b.log("media ended");this.startPosition=this.lastCurrentTime=0};bW.prototype.onManifestLoading=function bB(){U.b.log("trigger BUFFER_RESET");this.hls.trigger(E.a.BUFFER_RESET);this._bufferedFrags=[];this.stalled=false;this.startPosition=this.lastCurrentTime=0};bW.prototype.onManifestParsed=function b8(ci){var cf=false,cg=false,ch;ci.levels.forEach(function(cj){ch=cj.audioCodec;if(ch){if(ch.indexOf("mp4a.40.2")!==-1){cf=true}if(ch.indexOf("mp4a.40.5")!==-1){cg=true}}});this.audioCodecSwitch=cf&&cg;if(this.audioCodecSwitch){U.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=ci.levels;this.startFragRequested=false;var ce=this.config;if(ce.autoStartLoad||this.forceStartLoad){this.hls.startLoad(ce.startPosition)}};bW.prototype.onLevelLoaded=function bY(ch){var cg=ch.details;var cl=ch.level;var ce=this.levels[this.levelLastLoaded];var ck=this.levels[cl];var cf=cg.totalduration;var ci=0;U.b.log("level "+cl+" loaded ["+cg.startSN+","+cg.endSN+"],duration:"+cf);if(cg.live){var cj=ck.details;if(cj&&cg.fragments.length>0){ab(cj,cg);ci=cg.fragments[0].start;this.liveSyncPosition=this.computeLivePosition(ci,cj);if(cg.PTSKnown&&!isNaN(ci)){U.b.log("live playlist sliding:"+ci.toFixed(3))}else{U.b.log("live playlist - outdated PTS, unknown sliding");h(this.fragPrevious,ce,cg)}}else{U.b.log("live playlist - first load, unknown sliding");cg.PTSKnown=false;h(this.fragPrevious,ce,cg)}}else{cg.PTSKnown=false}ck.details=cg;this.levelLastLoaded=cl;this.hls.trigger(E.a.LEVEL_UPDATED,{details:cg,level:cl});if(this.startFragRequested===false){if(this.startPosition===-1||this.lastCurrentTime===-1){var cm=cg.startTimeOffset;if(!isNaN(cm)){if(cm<0){U.b.log("negative start time offset "+cm+", count from end of last fragment");cm=ci+cf+cm}U.b.log("start time offset found in playlist, adjust startPosition to "+cm);this.startPosition=cm}else{if(cg.live){this.startPosition=this.computeLivePosition(ci,cg);U.b.log("configure startPosition to "+this.startPosition)}else{this.startPosition=0}}this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}if(this.state===bt.WAITING_LEVEL){this.state=bt.IDLE}this.tick()};bW.prototype.onKeyLoaded=function bO(){if(this.state===bt.KEY_LOADING){this.state=bt.IDLE;this.tick()}};bW.prototype.onFragLoaded=function b4(co){var cq=this.fragCurrent,cm=co.frag;if(this.state===bt.FRAG_LOADING&&cq&&cm.type==="main"&&cm.level===cq.level&&cm.sn===cq.sn){var cp=co.stats,cg=this.levels[cq.level],ce=cg.details;U.b.log("Loaded  "+cq.sn+" of ["+ce.startSN+" ,"+ce.endSN+"],level "+cq.level);this.bitrateTest=false;this.stats=cp;if(cm.bitrateTest===true&&this.hls.nextLoadLevel){this.state=bt.IDLE;this.startFragRequested=false;cp.tparsed=cp.tbuffered=performance.now();this.hls.trigger(E.a.FRAG_BUFFERED,{stats:cp,frag:cq,id:"main"});this.tick()}else{if(cm.sn==="initSegment"){this.state=bt.IDLE;cp.tparsed=cp.tbuffered=performance.now();ce.initSegment.data=co.payload;this.hls.trigger(E.a.FRAG_BUFFERED,{stats:cp,frag:cq,id:"main"});this.tick()}else{this.state=bt.PARSING;var cl=ce.totalduration,cf=cq.level,ck=cq.sn,cs=this.config.defaultAudioCodec||cg.audioCodec;if(this.audioCodecSwap){U.b.log("swapping playlist audio codec");if(cs===undefined){cs=this.lastAudioCodec}if(cs){if(cs.indexOf("mp4a.40.5")!==-1){cs="mp4a.40.2"}else{cs="mp4a.40.5"}}}this.pendingBuffering=true;this.appended=false;U.b.log("Parsing "+ck+" of ["+ce.startSN+" ,"+ce.endSN+"],level "+cf+", cc "+cq.cc);var ci=this.demuxer;if(!ci){ci=this.demuxer=new aA(this.hls,"main")}var ch=this.media;var cn=ch&&ch.seeking;var cj=!cn&&(ce.PTSKnown||!ce.live);var cr=ce.initSegment?ce.initSegment.data:[];ci.push(co.payload,cr,cs,cg.videoCodec,cq,cl,cj,undefined)}}}this.fragLoadError=0};bW.prototype.onFragParsingInitSegment=function bX(cg){var cl=this.fragCurrent;var ci=cg.frag;if(cl&&cg.id==="main"&&ci.sn===cl.sn&&ci.level===cl.level&&this.state===bt.PARSING){var cj=cg.tracks,ck,cf;if(cj.audio&&this.altAudio){delete cj.audio}cf=cj.audio;if(cf){var cm=this.levels[this.level].audioCodec,ce=navigator.userAgent.toLowerCase();if(cm&&this.audioCodecSwap){U.b.log("swapping playlist audio codec");if(cm.indexOf("mp4a.40.5")!==-1){cm="mp4a.40.2"}else{cm="mp4a.40.5"}}if(this.audioCodecSwitch){if(cf.metadata.channelCount!==1&&ce.indexOf("firefox")===-1){cm="mp4a.40.5"}}if(ce.indexOf("android")!==-1&&cf.container!=="audio/mpeg"){cm="mp4a.40.2";U.b.log("Android: force audio codec to "+cm)}cf.levelCodec=cm;cf.id=cg.id}cf=cj.video;if(cf){cf.levelCodec=this.levels[this.level].videoCodec;cf.id=cg.id}this.hls.trigger(E.a.BUFFER_CODECS,cj);for(ck in cj){cf=cj[ck];U.b.log("main track:"+ck+",container:"+cf.container+",codecs[level/parsed]=["+cf.levelCodec+"/"+cf.codec+"]");var ch=cf.initSegment;if(ch){this.appended=true;this.pendingBuffering=true;this.hls.trigger(E.a.BUFFER_APPENDING,{type:ck,data:ch,parent:"main",content:"initSegment"})}}this.tick()}};bW.prototype.onFragParsingData=function b9(cg){var ci=this;var ck=this.fragCurrent;var ch=cg.frag;if(ck&&cg.id==="main"&&ch.sn===ck.sn&&ch.level===ck.level&&!(cg.type==="audio"&&this.altAudio)&&this.state===bt.PARSING){var cf=this.levels[this.level],cm=ck;if(isNaN(cg.endPTS)){cg.endPTS=cg.startPTS+ck.duration;cg.endDTS=cg.startDTS+ck.duration}U.b.log("Parsed "+cg.type+",PTS:["+cg.startPTS.toFixed(3)+","+cg.endPTS.toFixed(3)+"],DTS:["+cg.startDTS.toFixed(3)+"/"+cg.endDTS.toFixed(3)+"],nb:"+cg.nb+",dropped:"+(cg.dropped||0));if(cg.type==="video"){cm.dropped=cg.dropped;if(cm.dropped){if(!cm.backtracked){var cj=cf.details;if(cj&&cm.sn===cj.startSN){U.b.warn("missing video frame(s) on first frag, appending with gap")}else{U.b.warn("missing video frame(s), backtracking fragment");cm.backtracked=true;this.nextLoadPosition=cg.startPTS;this.state=bt.IDLE;this.fragPrevious=cm;this.tick();return}}else{U.b.warn("Already backtracked on this fragment, appending with the gap")}}else{cm.backtracked=false}}var cl=aT(cf.details,cm,cg.startPTS,cg.endPTS,cg.startDTS,cg.endDTS),ce=this.hls;ce.trigger(E.a.LEVEL_PTS_UPDATED,{details:cf.details,level:this.level,drift:cl,type:cg.type,start:cg.startPTS,end:cg.endPTS});[cg.data1,cg.data2].forEach(function(cn){if(cn&&cn.length&&ci.state===bt.PARSING){ci.appended=true;ci.pendingBuffering=true;ce.trigger(E.a.BUFFER_APPENDING,{type:cg.type,data:cn,parent:"main",content:"data"})}});this.tick()}};bW.prototype.onFragParsed=function cc(cf){var ce=this.fragCurrent;var cg=cf.frag;if(ce&&cf.id==="main"&&cg.sn===ce.sn&&cg.level===ce.level&&this.state===bt.PARSING){this.stats.tparsed=performance.now();this.state=bt.PARSED;this._checkAppendedParsed()}};bW.prototype.onAudioTrackSwitching=function bI(ch){var ce=!!ch.url,ci=ch.id;if(!ce){if(this.mediaBuffer!==this.media){U.b.log("switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var cg=this.fragCurrent;if(cg.loader){U.b.log("switching to main audio track, cancel main fragment load");cg.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=bt.IDLE}var cf=this.hls;cf.trigger(E.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});cf.trigger(E.a.AUDIO_TRACK_SWITCHED,{id:ci});this.altAudio=false}};bW.prototype.onAudioTrackSwitched=function bZ(cg){var ch=cg.id,ce=!!this.hls.audioTracks[ch].url;if(ce){var cf=this.videoBuffer;if(cf&&this.mediaBuffer!==cf){U.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=cf}}this.altAudio=ce;this.tick()};bW.prototype.onBufferCreated=function b3(cj){var ch=cj.tracks,cg=void 0,cf=void 0,ck=false;for(var ci in ch){var ce=ch[ci];if(ce.id==="main"){cf=ci;cg=ce;if(ci==="video"){this.videoBuffer=ch[ci].buffer}}else{ck=true}}if(ck&&cg){U.b.log("alternate track found, use "+cf+".buffered to schedule main fragment loading");this.mediaBuffer=cg.buffer}else{this.mediaBuffer=this.media}};bW.prototype.onBufferAppended=function bE(cf){if(cf.parent==="main"){var ce=this.state;if(ce===bt.PARSING||ce===bt.PARSED){this.pendingBuffering=cf.pending>0;this._checkAppendedParsed()}}};bW.prototype._checkAppendedParsed=function bK(){if(this.state===bt.PARSED&&(!this.appended||!this.pendingBuffering)){var ch=this.fragCurrent;if(ch){var cg=this.mediaBuffer?this.mediaBuffer:this.media;U.b.log("main buffered : "+ak.toString(cg.buffered));var ce=this._bufferedFrags.filter(function(ci){return aY.isBuffered(cg,(ci.startPTS+ci.endPTS)/2)});ce.push(ch);this._bufferedFrags=ce.sort(function(cj,ci){return cj.startPTS-ci.startPTS});this.fragPrevious=ch;var cf=this.stats;cf.tbuffered=performance.now();this.fragLastKbps=Math.round(8*cf.total/(cf.tbuffered-cf.tfirst));this.hls.trigger(E.a.FRAG_BUFFERED,{stats:cf,frag:ch,id:"main"});this.state=bt.IDLE}this.tick()}};bW.prototype.onError=function bH(cg){var ch=cg.frag||this.fragCurrent;if(ch&&ch.type!=="main"){return}var ce=!!this.media&&aY.isBuffered(this.media,this.media.currentTime)&&aY.isBuffered(this.media,this.media.currentTime+0.5);switch(cg.details){case az.a.FRAG_LOAD_ERROR:case az.a.FRAG_LOAD_TIMEOUT:case az.a.KEY_LOAD_ERROR:case az.a.KEY_LOAD_TIMEOUT:if(!cg.fatal){if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var cf=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);ch.loadCounter=0;U.b.warn("mediaController: frag loading failed, retry in "+cf+" ms");this.retryDate=performance.now()+cf;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.fragLoadError++;this.state=bt.FRAG_LOADING_WAITING_RETRY}else{U.b.error("mediaController: "+cg.details+" reaches max retry, redispatch as fatal ...");cg.fatal=true;this.state=bt.ERROR}}break;case az.a.FRAG_LOOP_LOADING_ERROR:if(!cg.fatal){if(ce){this._reduceMaxBufferLength(ch.duration);this.state=bt.IDLE}else{if(!ch.autoLevel||ch.level===0){cg.fatal=true;this.state=bt.ERROR}}}break;case az.a.LEVEL_LOAD_ERROR:case az.a.LEVEL_LOAD_TIMEOUT:if(this.state!==bt.ERROR){if(cg.fatal){this.state=bt.ERROR;U.b.warn("streamController: "+cg.details+",switch to "+this.state+" state ...")}else{if(!cg.levelRetry&&this.state===bt.WAITING_LEVEL){this.state=bt.IDLE}}}break;case az.a.BUFFER_FULL_ERROR:if(cg.parent==="main"&&(this.state===bt.PARSING||this.state===bt.PARSED)){if(ce){this._reduceMaxBufferLength(this.config.maxBufferLength);this.state=bt.IDLE}else{U.b.warn("buffer full error also media.currentTime is not buffered, flush everything");this.fragCurrent=null;this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}}break;default:break}};bW.prototype._reduceMaxBufferLength=function bu(ce){var cf=this.config;if(cf.maxMaxBufferLength>=ce){cf.maxMaxBufferLength/=2;U.b.warn("main:reduce max buffer length to "+cf.maxMaxBufferLength+"s");if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*cf.fragLoadingLoopThreshold}}};bW.prototype._checkBuffer=function cb(){var cj=this.media,cy=this.config;if(cj&&cj.readyState){var ct=cj.currentTime,cg=this.mediaBuffer?this.mediaBuffer:cj,ce=cg.buffered;if(!this.loadedmetadata&&ce.length){this.loadedmetadata=true;var co=cj.seeking?ct:this.startPosition,cA=aY.isBuffered(cg,co),ck=ce.start(0),cn=!cA&&Math.abs(co-ck)<cy.maxSeekHole;if((ct!==co||cn)&&co>0){U.b.log("target start position:"+co);if(cn){co=ck;U.b.log("target start position not buffered, seek to buffered.start(0) "+co)}U.b.log("adjust currentTime from "+ct+" to "+co);cj.currentTime=co}}else{if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{var cq=aY.bufferInfo(cj,ct,0),ci=!(cj.paused||cj.ended||cj.buffered.length===0),cm=0.5,cp=ct!==this.lastCurrentTime;if(cp){if(this.stallReported){U.b.warn("playback not stuck anymore @"+ct+", after "+Math.round(performance.now()-this.stalled)+"ms");this.stallReported=false}this.stalled=undefined;this.nudgeRetry=0}else{if(ci){var cl=performance.now();var cv=this.hls;if(!this.stalled){this.stalled=cl;this.stallReported=false}else{var cx=cl-this.stalled;var cs=cq.len;var cz=this.nudgeRetry||0;if(cs<=cm&&cx>cy.lowBufferWatchdogPeriod*1000){if(!this.stallReported){this.stallReported=true;U.b.warn("playback stalling in low buffer @"+ct);cv.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_STALLED_ERROR,fatal:false,buffer:cs})}var cf=cq.nextStart,cw=cf-ct;if(cf&&cw<cy.maxSeekHole&&cw>0){this.nudgeRetry=++cz;var cr=cz*cy.nudgeOffset;U.b.log("adjust currentTime from "+cj.currentTime+" to next buffered @ "+cf+" + nudge "+cr);cj.currentTime=cf+cr;this.stalled=undefined;cv.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_SEEK_OVER_HOLE,fatal:false,hole:cf+cr-ct})}}else{if(cs>cm&&cx>cy.highBufferWatchdogPeriod*1000){if(!this.stallReported){this.stallReported=true;U.b.warn("playback stalling in high buffer @"+ct);cv.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_STALLED_ERROR,fatal:false,buffer:cs})}this.stalled=undefined;this.nudgeRetry=++cz;if(cz<cy.nudgeMaxRetry){var ch=cj.currentTime;var cu=ch+cz*cy.nudgeOffset;U.b.log("adjust currentTime from "+ch+" to "+cu);cj.currentTime=cu;cv.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_NUDGE_ON_STALL,fatal:false})}else{U.b.error("still stuck in high buffer @"+ct+" after "+cy.nudgeMaxRetry+", raise fatal error");cv.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_STALLED_ERROR,fatal:true})}}}}}}}}}};bW.prototype.onFragLoadEmergencyAborted=function bV(){this.state=bt.IDLE;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.tick()};bW.prototype.onBufferFlushed=function bC(){var ce=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(cf){return aY.isBuffered(ce,(cf.startPTS+cf.endPTS)/2)});if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.state=bt.IDLE;this.fragPrevious=null};bW.prototype.swapAudioCodec=function b2(){this.audioCodecSwap=!this.audioCodecSwap};bW.prototype.computeLivePosition=function b0(cf,ce){var cg=this.config.liveSyncDuration!==undefined?this.config.liveSyncDuration:this.config.liveSyncDurationCount*ce.targetduration;return cf+Math.max(0,ce.totalduration-cg)};N(bW,[{key:"state",set:function bM(cf){if(this.state!==cf){var ce=this.state;this._state=cf;U.b.log("main stream:"+ce+"->"+cf);this.hls.trigger(E.a.STREAM_STATE_TRANSITION,{previousState:ce,nextState:cf})}},get:function b7(){return this._state}},{key:"currentLevel",get:function b7(){var ce=this.media;if(ce){var cf=this.getBufferedFrag(ce.currentTime);if(cf){return cf.level}}return -1}},{key:"nextBufferedFrag",get:function b7(){var ce=this.media;if(ce){return this.followingBufferedFrag(this.getBufferedFrag(ce.currentTime))}else{return null}}},{key:"nextLevel",get:function b7(){var ce=this.nextBufferedFrag;if(ce){return ce.level}else{return -1}}},{key:"liveSyncPosition",get:function b7(){return this._liveSyncPosition},set:function bM(ce){this._liveSyncPosition=ce}}]);return bW}(a3);var d=(bs);var S=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function bf(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function a9(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function T(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var B=function(bI){T(bB,bI);function bB(bJ){bf(this,bB);var bK=a9(this,bI.call(this,bJ,E.a.MANIFEST_LOADED,E.a.LEVEL_LOADED,E.a.FRAG_LOADED,E.a.ERROR));bK.canload=false;bK.currentLevelIndex=null;bK.manualLevelIndex=-1;bK.timer=null;return bK}bB.prototype.destroy=function bG(){this.cleanTimer();this.manualLevelIndex=-1};bB.prototype.cleanTimer=function bz(){if(this.timer!==null){clearTimeout(this.timer);this.timer=null}};bB.prototype.startLoad=function bE(){var bJ=this._levels;this.canload=true;this.levelRetryCount=0;if(bJ){bJ.forEach(function(bL){bL.loadError=0;var bK=bL.details;if(bK&&bK.live){bL.details=undefined}})}if(this.timer!==null){this.loadLevel()}};bB.prototype.stopLoad=function bC(){this.canload=false};bB.prototype.onManifestLoaded=function bD(bN){var bS=[];var bO=void 0;var bP={};var bQ=null;var bJ=false;var bR=false;var bK=/chrome|firefox/.test(navigator.userAgent.toLowerCase());var bL=[];bN.levels.forEach(function(bT){bT.loadError=0;bT.fragmentError=false;bJ=bJ||!!bT.videoCodec;bR=bR||!!bT.audioCodec||!!(bT.attrs&&bT.attrs.AUDIO);if(bK===true&&bT.audioCodec&&bT.audioCodec.indexOf("mp4a.40.34")!==-1){bT.audioCodec=undefined}bQ=bP[bT.bitrate];if(bQ===undefined){bT.url=[bT.url];bT.urlId=0;bP[bT.bitrate]=bT;bS.push(bT)}else{bQ.url.push(bT.url)}});if(bJ===true&&bR===true){bS=bS.filter(function(bU){var bT=bU.videoCodec;return !!bT})}bS=bS.filter(function(bV){var bU=bV.audioCodec,bT=bV.videoCodec;return(!bU||aB(bU))&&(!bT||aB(bT))});if(bN.audioTracks){bL=bN.audioTracks.filter(function(bT){return !bT.audioCodec||aB(bT.audioCodec,"audio")})}if(bS.length>0){bO=bS[0].bitrate;bS.sort(function(bU,bT){return bU.bitrate-bT.bitrate});this._levels=bS;for(var bM=0;bM<bS.length;bM++){if(bS[bM].bitrate===bO){this._firstLevel=bM;U.b.log("manifest loaded,"+bS.length+" level(s) found, first bitrate:"+bO);break}}this.hls.trigger(E.a.MANIFEST_PARSED,{levels:bS,audioTracks:bL,firstLevel:this._firstLevel,stats:bN.stats,audio:bR,video:bJ,altAudio:(bL&&bL.length>0)})}else{this.hls.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})}};bB.prototype.setLevelInternal=function bv(bK){var bO=this._levels;var bM=this.hls;if(bK>=0&&bK<bO.length){this.cleanTimer();if(this.currentLevelIndex!==bK){U.b.log("switching to level "+bK);this.currentLevelIndex=bK;var bL=bO[bK];bL.level=bK;bM.trigger(E.a.LEVEL_SWITCH,bL);bM.trigger(E.a.LEVEL_SWITCHING,bL)}var bP=bO[bK],bJ=bP.details;if(!bJ||bJ.live===true){var bN=bP.urlId;bM.trigger(E.a.LEVEL_LOADING,{url:bP.url[bN],level:bK,id:bN})}}else{bM.trigger(E.a.ERROR,{type:az.b.OTHER_ERROR,details:az.a.LEVEL_SWITCH_ERROR,level:bK,fatal:false,reason:"invalid level idx"})}};bB.prototype.onError=function bx(bK){if(bK.fatal===true){if(bK.type===az.b.NETWORK_ERROR){this.cleanTimer()}return}var bM=false,bJ=false;var bL=void 0;switch(bK.details){case az.a.FRAG_LOAD_ERROR:case az.a.FRAG_LOAD_TIMEOUT:case az.a.FRAG_LOOP_LOADING_ERROR:case az.a.KEY_LOAD_ERROR:case az.a.KEY_LOAD_TIMEOUT:bL=bK.frag.level;bJ=true;break;case az.a.LEVEL_LOAD_ERROR:case az.a.LEVEL_LOAD_TIMEOUT:bL=bK.context.level;bM=true;break;case az.a.REMUX_ALLOC_ERROR:bL=bK.level;bM=true;break}if(bL!==undefined){this.recoverLevel(bK,bL,bM,bJ)}};bB.prototype.recoverLevel=function by(bN,bM,bO,bS){var bQ=this;var bL=this.hls.config;var bR=bN.details;var bK=this._levels[bM];var bJ=void 0,bP=void 0,bT=void 0;bK.loadError++;bK.fragmentError=bS;if(bO===true){if(this.levelRetryCount+1<=bL.levelLoadingMaxRetry){bP=Math.min(Math.pow(2,this.levelRetryCount)*bL.levelLoadingRetryDelay,bL.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return bQ.loadLevel()},bP);bN.levelRetry=true;this.levelRetryCount++;U.b.warn("level controller, "+bR+", retry in "+bP+" ms, current retry count is "+this.levelRetryCount)}else{U.b.error("level controller, cannot recover from "+bR+" error");this.currentLevelIndex=null;this.cleanTimer();bN.fatal=true;return}}if(bO===true||bS===true){bJ=bK.url.length;if(bJ>1&&bK.loadError<bJ){U.b.warn("level controller, "+bR+" for level "+bM+": switching to redundant stream id "+bK.urlId);bK.urlId=(bK.urlId+1)%bJ;bK.details=undefined}else{if(this.manualLevelIndex===-1){bT=bM===0?this._levels.length-1:bM-1;U.b.warn("level controller, "+bR+": switch to "+bT);this.hls.nextAutoLevel=this.currentLevelIndex=bT}else{if(bS===true){U.b.warn("level controller, "+bR+": reload a fragment");this.currentLevelIndex=null}}}}};bB.prototype.onFragLoaded=function bA(bJ){var bL=bJ.frag;if(bL!==undefined&&bL.type==="main"){var bK=this._levels[bL.level];if(bK!==undefined){bK.fragmentError=false;bK.loadError=0;this.levelRetryCount=0}}};bB.prototype.onLevelLoaded=function bu(bP){var bO=this;var bN=bP.level;if(bN===this.currentLevelIndex){var bJ=this._levels[bN];if(bJ.fragmentError===false){bJ.loadError=0;this.levelRetryCount=0}var bK=bP.details;if(bK.live){var bL=1000*(bK.averagetargetduration?bK.averagetargetduration:bK.targetduration),bM=bJ.details;if(bM&&bK.endSN===bM.endSN){bL/=2;U.b.log("same live playlist, reload twice faster")}bL-=performance.now()-bP.stats.trequest;bL=Math.max(1000,Math.round(bL));U.b.log("live playlist, reload in "+bL+" ms");this.timer=setTimeout(function(){return bO.loadLevel()},bL)}else{this.cleanTimer()}}};bB.prototype.loadLevel=function bH(){var bK=void 0,bJ=void 0;if(this.currentLevelIndex!==null&&this.canload===true){bK=this._levels[this.currentLevelIndex];if(bK!==undefined&&bK.url.length>0){bJ=bK.urlId;this.hls.trigger(E.a.LEVEL_LOADING,{url:bK.url[bJ],level:this.currentLevelIndex,id:bJ})}}};S(bB,[{key:"levels",get:function bw(){return this._levels}},{key:"level",get:function bw(){return this.currentLevelIndex},set:function bF(bJ){var bK=this._levels;if(bK){bJ=Math.min(bJ,bK.length-1);if(this.currentLevelIndex!==bJ||bK[bJ].details===undefined){this.setLevelInternal(bJ)}}}},{key:"manualLevel",get:function bw(){return this.manualLevelIndex},set:function bF(bJ){this.manualLevelIndex=bJ;if(this._startLevel===undefined){this._startLevel=bJ}if(bJ!==-1){this.level=bJ}}},{key:"firstLevel",get:function bw(){return this._firstLevel},set:function bF(bJ){this._firstLevel=bJ}},{key:"startLevel",get:function bw(){if(this._startLevel===undefined){var bJ=this.hls.config.startLevel;if(bJ!==undefined){return bJ}else{return this._firstLevel}}else{return this._startLevel}},set:function bF(bJ){this._startLevel=bJ}},{key:"nextLoadLevel",get:function bw(){if(this.manualLevelIndex!==-1){return this.manualLevelIndex}else{return this.hls.nextAutoLevel}},set:function bF(bJ){this.level=bJ;if(this.manualLevelIndex===-1){this.hls.nextAutoLevel=bJ}}}]);return bB}(a3);var u=(B);var r=ba(4);function aj(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function aN(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function o(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var b=function(bw){o(by,bw);function by(bA){aj(this,by);var bB=aN(this,bw.call(this,bA,E.a.MEDIA_ATTACHED,E.a.MEDIA_DETACHING,E.a.FRAG_PARSING_METADATA));bB.id3Track=undefined;bB.media=undefined;return bB}by.prototype.destroy=function bv(){a3.prototype.destroy.call(this)};by.prototype.onMediaAttached=function bu(bA){this.media=bA.media;if(!this.media){return}};by.prototype.onMediaDetaching=function bx(){this.media=undefined};by.prototype.onFragParsingMetadata=function bz(bE){var bI=bE.frag;var bK=bE.samples;if(!this.id3Track){this.id3Track=this.media.addTextTrack("metadata","id3");this.id3Track.mode="hidden"}var bG=window.WebKitDataCue||window.VTTCue||window.TextTrackCue;for(var bF=0;bF<bK.length;bF++){var bJ=r.a.getID3Frames(bK[bF].data);if(bJ){var bB=bK[bF].pts;var bH=bF<bK.length-1?bK[bF+1].pts:bI.endPTS;if(bB===bH){bH+=0.0001}for(var bC=0;bC<bJ.length;bC++){var bA=bJ[bC];if(!r.a.isTimeStampFrame(bA)){var bD=new bG(bB,bH,"");bD.value=bA;this.id3Track.addCue(bD)}}}}};return by}(a3);var q=(b);function aS(){var bu=ap();var bw=window.SourceBuffer||window.WebKitSourceBuffer;var bx=bu&&typeof bu.isTypeSupported==="function"&&bu.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var bv=!bw||bw.prototype&&typeof bw.prototype.appendBuffer==="function"&&typeof bw.prototype.remove==="function";return !!bx&&!!bv}function am(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var x=function(){function bx(by){am(this,bx);this.alpha_=by?Math.exp(Math.log(0.5)/by):0;this.estimate_=0;this.totalWeight_=0}bx.prototype.sample=function bw(bA,bz){var by=Math.pow(this.alpha_,bA);this.estimate_=bz*(1-by)+by*this.estimate_;this.totalWeight_+=bA};bx.prototype.getTotalWeight=function bu(){return this.totalWeight_};bx.prototype.getEstimate=function bv(){if(this.alpha_){var by=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/by}else{return this.estimate_}};return bx}();var aJ=(x);function aU(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var A=function(){function bu(bA,bB,bz,bC){aU(this,bu);this.hls=bA;this.defaultEstimate_=bC;this.minWeight_=0.001;this.minDelayMs_=50;this.slow_=new aJ(bB);this.fast_=new aJ(bz)}bu.prototype.sample=function by(bA,bz){bA=Math.max(bA,this.minDelayMs_);var bB=8000*bz/bA,bC=bA/1000;this.fast_.sample(bC,bB);this.slow_.sample(bC,bB)};bu.prototype.canEstimate=function bv(){var bz=this.fast_;return bz&&bz.getTotalWeight()>=this.minWeight_};bu.prototype.getEstimate=function bx(){if(this.canEstimate()){return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}else{return this.defaultEstimate_}};bu.prototype.destroy=function bw(){};return bu}();var l=(A);var z=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function Z(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function C(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function bo(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var ar=function(bF){bo(bE,bF);function bE(bG){Z(this,bE);var bH=C(this,bF.call(this,bG,E.a.FRAG_LOADING,E.a.FRAG_LOADED,E.a.FRAG_BUFFERED,E.a.ERROR));bH.lastLoadedFragLevel=0;bH._nextAutoLevel=-1;bH.hls=bG;bH.timer=null;bH._bwEstimator=null;bH.onCheck=bH._abandonRulesCheck.bind(bH);return bH}bE.prototype.destroy=function bD(){this.clearTimer();a3.prototype.destroy.call(this)};bE.prototype.onFragLoading=function by(bL){var bN=bL.frag;if(bN.type==="main"){if(!this.timer){this.timer=setInterval(this.onCheck,100)}if(!this._bwEstimator){var bI=this.hls,bM=bL.frag.level,bK=bI.levels[bM].details.live,bH=bI.config,bG=void 0,bJ=void 0;if(bK){bG=bH.abrEwmaFastLive;bJ=bH.abrEwmaSlowLive}else{bG=bH.abrEwmaFastVoD;bJ=bH.abrEwmaSlowVoD}this._bwEstimator=new l(bI,bJ,bG,bH.abrEwmaDefaultEstimate)}this.fragCurrent=bN}};bE.prototype._abandonRulesCheck=function bu(){var bW=this.hls,bR=bW.media,bI=this.fragCurrent,bO=bI.loader,bS=bW.minAutoLevel;if(!bO||bO.stats&&bO.stats.aborted){U.b.warn("frag loader destroy or aborted, disarm abandonRules");this.clearTimer();this._nextAutoLevel=-1;return}var bX=bO.stats;if(bR&&bX&&(!bR.paused&&bR.playbackRate!==0||!bR.readyState)&&bI.autoLevel&&bI.level){var bP=performance.now()-bX.trequest,bL=Math.abs(bR.playbackRate);if(bP>500*bI.duration/bL){var bK=bW.levels,bG=Math.max(1,bX.bw?bX.bw/8:bX.loaded*1000/bP),bH=bK[bI.level],bY=bH.realBitrate?Math.max(bH.realBitrate,bH.bitrate):bH.bitrate,bU=bX.total?bX.total:Math.max(bX.loaded,Math.round(bI.duration*bY/8)),bJ=bR.currentTime,bM=(bU-bX.loaded)/bG,bV=(aY.bufferInfo(bR,bJ,bW.config.maxBufferHole).end-bJ)/bL;if(bV<2*bI.duration/bL&&bM>bV){var bN=void 0,bT=void 0;for(bT=bI.level-1;bT>bS;bT--){var bQ=bK[bT].realBitrate?Math.max(bK[bT].realBitrate,bK[bT].bitrate):bK[bT].bitrate;bN=bI.duration*bQ/(8*0.8*bG);if(bN<bV){break}}if(bN<bM){U.b.warn("loading too slow, abort fragment loading and switch to level "+bT+":fragLoadedDelay["+bT+"]<fragLoadedDelay["+(bI.level-1)+"];bufferStarvationDelay:"+bN.toFixed(1)+"<"+bM.toFixed(1)+":"+bV.toFixed(1));bW.nextLoadLevel=bT;this._bwEstimator.sample(bP,bX.loaded);bO.abort();this.clearTimer();bW.trigger(E.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:bI,stats:bX})}}}}};bE.prototype.onFragLoaded=function bA(bI){var bL=bI.frag;if(bL.type==="main"&&!isNaN(bL.sn)){this.clearTimer();this.lastLoadedFragLevel=bL.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){var bK=this.hls.levels[bL.level];var bG=(bK.loaded?bK.loaded.bytes:0)+bI.stats.loaded;var bJ=(bK.loaded?bK.loaded.duration:0)+bI.frag.duration;bK.loaded={bytes:bG,duration:bJ};bK.realBitrate=Math.round(8*bG/bJ)}if(bI.frag.bitrateTest){var bH=bI.stats;bH.tparsed=bH.tbuffered=bH.tload;this.onFragBuffered(bI)}}};bE.prototype.onFragBuffered=function bx(bI){var bH=bI.stats,bJ=bI.frag;if(bH.aborted!==true&&bJ.loadCounter===1&&bJ.type==="main"&&!isNaN(bJ.sn)&&(!bJ.bitrateTest||bH.tload===bH.tbuffered)){var bG=bH.tparsed-bH.trequest;U.b.log("latency/loading/parsing/append/kbps:"+Math.round(bH.tfirst-bH.trequest)+"/"+Math.round(bH.tload-bH.tfirst)+"/"+Math.round(bH.tparsed-bH.tload)+"/"+Math.round(bH.tbuffered-bH.tparsed)+"/"+Math.round(8*bH.loaded/(bH.tbuffered-bH.trequest)));this._bwEstimator.sample(bG,bH.loaded);bH.bwEstimate=this._bwEstimator.getEstimate();if(bJ.bitrateTest){this.bitrateTestDelay=bG/1000}else{this.bitrateTestDelay=0}}};bE.prototype.onError=function bz(bG){switch(bG.details){case az.a.FRAG_LOAD_ERROR:case az.a.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}};bE.prototype.clearTimer=function bB(){clearInterval(this.timer);this.timer=null};bE.prototype._findBestLevel=function bw(bG,bL,bM,bK,bO,bJ,bR,bH,bW){for(var bN=bO;bN>=bK;bN--){var bV=bW[bN],bQ=bV.details,bP=bQ?bQ.totalduration/bQ.fragments.length:bL,bI=bQ?bQ.live:false,bT=void 0;if(bN<=bG){bT=bR*bM}else{bT=bH*bM}var bS=bW[bN].realBitrate?Math.max(bW[bN].realBitrate,bW[bN].bitrate):bW[bN].bitrate,bU=bS*bP/bT;U.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+bN+"/"+Math.round(bT)+"/"+bS+"/"+bP+"/"+bJ+"/"+bU);if(bT>bS&&(!bU||bI&&!this.bitrateTestDelay||bU<bJ)){return bN}}return -1};z(bE,[{key:"nextAutoLevel",get:function bv(){var bI=this._nextAutoLevel;var bG=this._bwEstimator;if(bI!==-1&&(!bG||!bG.canEstimate())){return bI}var bH=this._nextABRAutoLevel;if(bI!==-1){bH=Math.min(bI,bH)}return bH},set:function bC(bG){this._nextAutoLevel=bG}},{key:"_nextABRAutoLevel",get:function bv(){var bW=this.hls,bH=bW.maxAutoLevel,bL=bW.levels,bX=bW.config,bO=bW.minAutoLevel;var bN=bW.media,bU=this.lastLoadedFragLevel,bR=this.fragCurrent?this.fragCurrent.duration:0,bK=bN?bN.currentTime:0,bM=bN&&bN.playbackRate!==0?Math.abs(bN.playbackRate):1,bJ=this._bwEstimator?this._bwEstimator.getEstimate():bX.abrEwmaDefaultEstimate,bQ=(aY.bufferInfo(bN,bK,bX.maxBufferHole).end-bK)/bM;var bS=this._findBestLevel(bU,bR,bJ,bO,bH,bQ,bX.abrBandWidthFactor,bX.abrBandWidthUpFactor,bL);if(bS>=0){return bS}else{U.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var bT=bR?Math.min(bR,bX.maxStarvationDelay):bX.maxStarvationDelay,bV=bX.abrBandWidthFactor,bG=bX.abrBandWidthUpFactor;if(bQ===0){var bP=this.bitrateTestDelay;if(bP){var bI=bR?Math.min(bR,bX.maxLoadingDelay):bX.maxLoadingDelay;bT=bI-bP;U.b.trace("bitrate test took "+Math.round(1000*bP)+"ms, set first fragment max fetchDuration to "+Math.round(1000*bT)+" ms");bV=bG=1}}bS=this._findBestLevel(bU,bR,bJ,bO,bH,bQ+bT,bV,bG,bL);return Math.max(bS,0)}}}]);return bE}(a3);var Y=(ar);function aD(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function be(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function W(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var aM=ap();var br=function(bN){W(bz,bN);function bz(bU){aD(this,bz);var bV=be(this,bN.call(this,bU,E.a.MEDIA_ATTACHING,E.a.MEDIA_DETACHING,E.a.MANIFEST_PARSED,E.a.BUFFER_RESET,E.a.BUFFER_APPENDING,E.a.BUFFER_CODECS,E.a.BUFFER_EOS,E.a.BUFFER_FLUSHING,E.a.LEVEL_PTS_UPDATED,E.a.LEVEL_UPDATED));bV._msDuration=null;bV._levelDuration=null;bV._live=null;bV._objectUrl=null;bV.onsbue=bV.onSBUpdateEnd.bind(bV);bV.onsbe=bV.onSBUpdateError.bind(bV);bV.pendingTracks={};bV.tracks={};return bV}bz.prototype.destroy=function bP(){a3.prototype.destroy.call(this)};bz.prototype.onLevelPtsUpdated=function bI(bZ){var bW=bZ.type;var bU=this.tracks.audio;if(bW==="audio"&&bU&&bU.container==="audio/mpeg"){var bY=this.sourceBuffer.audio;var b0=Math.abs(bY.timestampOffset-bZ.start);if(b0>0.1){var bV=bY.updating;try{bY.abort()}catch(bX){bV=true;U.b.warn("can not abort audio buffer: "+bX)}if(!bV){U.b.warn("change mpeg audio timestamp offset from "+bY.timestampOffset+" to "+bZ.start);bY.timestampOffset=bZ.start}else{this.audioTimestampOffset=bZ.start}}}};bz.prototype.onManifestParsed=function bR(bU){var bX=bU.audio,bW=bU.video||bU.levels.length&&bU.audio,bV=0;if(bU.altAudio&&(bX||bW)){bV=(bX?1:0)+(bW?1:0);U.b.log(bV+" sourceBuffer(s) expected")}this.sourceBufferNb=bV};bz.prototype.onMediaAttaching=function bu(bV){var bW=this.media=bV.media;if(bW){var bU=this.mediaSource=new aM();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);bU.addEventListener("sourceopen",this.onmso);bU.addEventListener("sourceended",this.onmse);bU.addEventListener("sourceclose",this.onmsc);bW.src=URL.createObjectURL(bU);this._objectUrl=bW.src}};bz.prototype.onMediaDetaching=function bQ(){U.b.log("media source detaching");var bU=this.mediaSource;if(bU){if(bU.readyState==="open"){try{bU.endOfStream()}catch(bV){U.b.warn("onMediaDetaching:"+bV.message+" while calling endOfStream")}}bU.removeEventListener("sourceopen",this.onmso);bU.removeEventListener("sourceended",this.onmse);bU.removeEventListener("sourceclose",this.onmsc);if(this.media){URL.revokeObjectURL(this._objectUrl);if(this.media.src===this._objectUrl){this.media.removeAttribute("src");this.media.load()}else{U.b.warn("media.src was changed by a third party - skip cleanup")}}this.mediaSource=null;this.media=null;this._objectUrl=null;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(E.a.MEDIA_DETACHED)};bz.prototype.onMediaSourceOpen=function bC(){U.b.log("media source opened");this.hls.trigger(E.a.MEDIA_ATTACHED,{media:this.media});var bU=this.mediaSource;if(bU){bU.removeEventListener("sourceopen",this.onmso)}this.checkPendingTracks()};bz.prototype.checkPendingTracks=function bA(){var bV=this.pendingTracks,bU=Object.keys(bV).length;if(bU&&(this.sourceBufferNb<=bU||this.sourceBufferNb===0)){this.createSourceBuffers(bV);this.pendingTracks={};this.doAppending()}};bz.prototype.onMediaSourceClose=function bT(){U.b.log("media source closed")};bz.prototype.onMediaSourceEnded=function bL(){U.b.log("media source ended")};bz.prototype.onSBUpdateEnd=function bE(){if(this.audioTimestampOffset){var bV=this.sourceBuffer.audio;U.b.warn("change mpeg audio timestamp offset from "+bV.timestampOffset+" to "+this.audioTimestampOffset);bV.timestampOffset=this.audioTimestampOffset;delete this.audioTimestampOffset}if(this._needsFlush){this.doFlush()}if(this._needsEos){this.checkEos()}this.appending=false;var bU=this.parent;var bW=this.segments.reduce(function(bX,bY){return bY.parent===bU?bX+1:bX},0);this.hls.trigger(E.a.BUFFER_APPENDED,{parent:bU,pending:bW});if(!this._needsFlush){this.doAppending()}this.updateMediaElementDuration()};bz.prototype.onSBUpdateError=function bJ(bU){U.b.error("sourceBuffer error:",bU);this.hls.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_APPENDING_ERROR,fatal:false})};bz.prototype.onBufferReset=function bK(){var bW=this.sourceBuffer;for(var bU in bW){var bX=bW[bU];try{this.mediaSource.removeSourceBuffer(bX);bX.removeEventListener("updateend",this.onsbue);bX.removeEventListener("error",this.onsbe)}catch(bV){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0};bz.prototype.onBufferCodecs=function bw(bV){if(Object.keys(this.sourceBuffer).length===0){for(var bW in bV){this.pendingTracks[bW]=bV[bW]}var bU=this.mediaSource;if(bU&&bU.readyState==="open"){this.checkPendingTracks()}}};bz.prototype.createSourceBuffers=function by(bY){var bZ=this.sourceBuffer,bV=this.mediaSource;for(var b2 in bY){if(!bZ[b2]){var bW=bY[b2];var b1=bW.levelCodec||bW.codec;var bU=bW.container+";codecs="+b1;U.b.log("creating sourceBuffer("+bU+")");try{var b0=bZ[b2]=bV.addSourceBuffer(bU);b0.addEventListener("updateend",this.onsbue);b0.addEventListener("error",this.onsbe);this.tracks[b2]={codec:b1,container:bW.container};bW.buffer=b0}catch(bX){U.b.error("error while trying to add sourceBuffer:"+bX.message);this.hls.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_ADD_CODEC_ERROR,fatal:false,err:bX,mimeType:bU})}}}this.hls.trigger(E.a.BUFFER_CREATED,{tracks:bY})};bz.prototype.onBufferAppending=function bO(bU){if(!this._needsFlush){if(!this.segments){this.segments=[bU]}else{this.segments.push(bU)}this.doAppending()}};bz.prototype.onBufferAppendFail=function bv(bU){U.b.error("sourceBuffer error:",bU.event);this.hls.trigger(E.a.ERROR,{type:az.b.MEDIA_ERROR,details:az.a.BUFFER_APPENDING_ERROR,fatal:false})};bz.prototype.onBufferEos=function bH(bW){var bX=this.sourceBuffer;var bU=bW.type;for(var bV in bX){if(!bU||bV===bU){if(!bX[bV].ended){bX[bV].ended=true;U.b.log(bV+" sourceBuffer now EOS")}}}this.checkEos()};bz.prototype.checkEos=function bG(){var bY=this.sourceBuffer,bU=this.mediaSource;if(!bU||bU.readyState!=="open"){this._needsEos=false;return}for(var bV in bY){var bX=bY[bV];if(!bX.ended){return}if(bX.updating){this._needsEos=true;return}}U.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{bU.endOfStream()}catch(bW){U.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=false};bz.prototype.onBufferFlushing=function bM(bU){this.flushRange.push({start:bU.startOffset,end:bU.endOffset,type:bU.type});this.flushBufferCounter=0;this.doFlush()};bz.prototype.onLevelUpdated=function bS(bV){var bU=bV.details;if(bU.fragments.length>0){this._levelDuration=bU.totalduration+bU.fragments[0].start;this._live=bU.live;this.updateMediaElementDuration()}};bz.prototype.updateMediaElementDuration=function bB(){var bU=this.hls.config;var bW=void 0;if(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open"){return}for(var bV in this.sourceBuffer){if(this.sourceBuffer[bV].updating===true){return}}bW=this.media.duration;if(this._msDuration===null){this._msDuration=this.mediaSource.duration}if(this._live===true&&bU.liveDurationInfinity===true){U.b.log("Media Source duration is set to Infinity");this._msDuration=this.mediaSource.duration=Infinity}else{if(this._levelDuration>this._msDuration&&this._levelDuration>bW||bW===Infinity||isNaN(bW)){U.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3));this._msDuration=this.mediaSource.duration=this._levelDuration}}};bz.prototype.doFlush=function bF(){while(this.flushRange.length){var bU=this.flushRange[0];if(this.flushBuffer(bU.start,bU.end,bU.type)){this.flushRange.shift();this.flushBufferCounter=0}else{this._needsFlush=true;return}}if(this.flushRange.length===0){this._needsFlush=false;var bW=0;var bY=this.sourceBuffer;try{for(var bX in bY){bW+=bY[bX].buffered.length}}catch(bV){U.b.error("error while accessing sourceBuffer.buffered")}this.appended=bW;this.hls.trigger(E.a.BUFFER_FLUSHED)}};bz.prototype.doAppending=function bx(){var bV=this.hls,b0=this.sourceBuffer,bU=this.segments;if(Object.keys(b0).length){if(this.media.error){this.segments=[];U.b.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(bU&&bU.length){var bZ=bU.shift();try{var bW=bZ.type,b1=b0[bW];if(b1){if(!b1.updating){b1.ended=false;this.parent=bZ.parent;b1.appendBuffer(bZ.data);this.appendError=0;this.appended++;this.appending=true}else{bU.unshift(bZ)}}else{this.onSBUpdateEnd()}}catch(bY){U.b.error("error while trying to append buffer:"+bY.message);bU.unshift(bZ);var bX={type:az.b.MEDIA_ERROR,parent:bZ.parent};if(bY.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}bX.details=az.a.BUFFER_APPEND_ERROR;if(this.appendError>bV.config.appendErrorMaxRetry){U.b.log("fail "+bV.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");bU=[];bX.fatal=true;bV.trigger(E.a.ERROR,bX);return}else{bX.fatal=false;bV.trigger(E.a.ERROR,bX)}}else{this.segments=[];bX.details=az.a.BUFFER_FULL_ERROR;bX.fatal=false;bV.trigger(E.a.ERROR,bX);return}}}}};bz.prototype.flushBuffer=function bD(bZ,b2,bY){var b4,bV,bU,b3,b5,bW,b1=this.sourceBuffer;if(Object.keys(b1).length){U.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+bZ+"/"+b2);if(this.flushBufferCounter<this.appended){for(var b0 in b1){if(bY&&b0!==bY){continue}b4=b1[b0];b4.ended=false;if(!b4.updating){try{for(bV=0;bV<b4.buffered.length;bV++){bU=b4.buffered.start(bV);b3=b4.buffered.end(bV);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&b2===Number.POSITIVE_INFINITY){b5=bZ;bW=b2}else{b5=Math.max(bU,bZ);bW=Math.min(b3,b2)}if(Math.min(bW,b3)-b5>0.5){this.flushBufferCounter++;U.b.log("flush "+b0+" ["+b5+","+bW+"], of ["+bU+","+b3+"], pos:"+this.media.currentTime);b4.remove(b5,bW);return false}}}catch(bX){U.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}else{U.b.warn("cannot flush, sb updating in progress");return false}}}else{U.b.warn("abort flushing too many retries")}U.b.log("buffer flushed")}return true};return bz}(a3);var j=(br);var k=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function O(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function a1(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function ad(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var bi=function(bE){ad(bv,bE);function bv(bF){O(this,bv);return a1(this,bE.call(this,bF,E.a.FPS_DROP_LEVEL_CAPPING,E.a.MEDIA_ATTACHING,E.a.MANIFEST_PARSED))}bv.prototype.destroy=function bD(){if(this.hls.config.capLevelToPlayerSize){this.media=this.restrictedLevels=null;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){this.timer=clearInterval(this.timer)}}};bv.prototype.onFpsDropLevelCapping=function bw(bF){if(bv.isLevelAllowed(bF.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(bF.droppedLevel)}};bv.prototype.onMediaAttaching=function by(bF){this.media=bF.media instanceof HTMLVideoElement?bF.media:null};bv.prototype.onManifestParsed=function bu(bG){var bF=this.hls;this.restrictedLevels=[];if(bF.config.capLevelToPlayerSize){this.autoLevelCapping=Number.POSITIVE_INFINITY;this.levels=bG.levels;bF.firstLevel=this.getMaxLevel(bG.firstLevel);clearInterval(this.timer);this.timer=setInterval(this.detectPlayerSize.bind(this),1000);this.detectPlayerSize()}};bv.prototype.detectPlayerSize=function bC(){if(this.media){var bG=this.levels?this.levels.length:0;if(bG){var bF=this.hls;bF.autoLevelCapping=this.getMaxLevel(bG-1);if(bF.autoLevelCapping>this.autoLevelCapping){bF.streamController.nextLevelSwitch()}this.autoLevelCapping=bF.autoLevelCapping}}};bv.prototype.getMaxLevel=function bz(bF){var bG=this;if(!this.levels){return -1}var bH=this.levels.filter(function(bJ,bI){return bv.isLevelAllowed(bI,bG.restrictedLevels)&&bI<=bF});return bv.getMaxLevelByMediaSize(bH,this.mediaWidth,this.mediaHeight)};bv.isLevelAllowed=function bA(bG){var bF=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return bF.indexOf(bG)===-1};bv.getMaxLevelByMediaSize=function bB(bJ,bH,bF){if(!bJ||bJ&&!bJ.length){return -1}var bI=function bI(bM,bN){if(!bN){return true}return bM.width!==bN.width||bM.height!==bN.height};var bK=bJ.length-1;for(var bG=0;bG<bJ.length;bG+=1){var bL=bJ[bG];if((bL.width>=bH||bL.height>=bF)&&bI(bL,bJ[bG+1])){bK=bG;break}}return bK};k(bv,[{key:"mediaWidth",get:function bx(){var bF=void 0;var bG=this.media;if(bG){bF=bG.width||bG.clientWidth||bG.offsetWidth;bF*=bv.contentScaleFactor}return bF}},{key:"mediaHeight",get:function bx(){var bF=void 0;var bG=this.media;if(bG){bF=bG.height||bG.clientHeight||bG.offsetHeight;bF*=bv.contentScaleFactor}return bF}}],[{key:"contentScaleFactor",get:function bx(){var bG=1;try{bG=window.devicePixelRatio}catch(bF){}return bG}}]);return bv}(a3);var aa=(bi);function aP(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}function aX(bu,bv){if(!bu){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return bv&&(typeof bv==="object"||typeof bv==="function")?bv:bu}function f(bv,bu){if(typeof bu!=="function"&&bu!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof bu)}bv.prototype=Object.create(bu&&bu.prototype,{constructor:{value:bv,enumerable:false,writable:true,configurable:true}});if(bu){Object.setPrototypeOf?Object.setPrototypeOf(bv,bu):bv.__proto__=bu}}var bm=function(bx){f(bz,bx);function bz(bA){aP(this,bz);return aX(this,bx.call(this,bA,E.a.MEDIA_ATTACHING))}bz.prototype.destroy=function bw(){if(this.timer){clearInterval(this.timer)}this.isVideoPlaybackQualityAvailable=false};bz.prototype.onMediaAttaching=function bu(bC){var bA=this.hls.config;if(bA.capLevelOnFPSDrop){var bB=this.video=bC.media instanceof HTMLVideoElement?bC.media:null;if(typeof bB.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}clearInterval(this.timer);this.timer=setInterval(this.checkFPSInterval.bind(this),bA.fpsDroppedMonitoringPeriod)}};bz.prototype.checkFPS=function by(bC,bG,bH){var bD=performance.now();if(bG){if(this.lastTime){var bJ=bD-this.lastTime,bF=bH-this.lastDroppedFrames,bI=bG-this.lastDecodedFrames,bE=1000*bF/bJ,bA=this.hls;bA.trigger(E.a.FPS_DROP,{currentDropped:bF,currentDecoded:bI,totalDroppedFrames:bH});if(bE>0){if(bF>bA.config.fpsDroppedMonitoringThreshold*bI){var bB=bA.currentLevel;U.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+bB);if(bB>0&&(bA.autoLevelCapping===-1||bA.autoLevelCapping>=bB)){bB=bB-1;bA.trigger(E.a.FPS_DROP_LEVEL_CAPPING,{level:bB,droppedLevel:bA.currentLevel});bA.autoLevelCapping=bB;bA.streamController.nextLevelSwitch()}}}}this.lastTime=bD;this.lastDroppedFrames=bH;this.lastDecodedFrames=bG}};bz.prototype.checkFPSInterval=function bv(){var bB=this.video;if(bB){if(this.isVideoPlaybackQualityAvailable){var bA=bB.getVideoPlaybackQuality();this.checkFPS(bB,bA.totalVideoFrames,bA.droppedVideoFrames)}else{this.checkFPS(bB,bB.webkitDecodedFrameCount,bB.webkitDroppedFrameCount)}}};return bz}(a3);var ao=(bm);function aE(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var aG=function(){function bw(bC){aE(this,bw);if(bC&&bC.xhrSetup){this.xhrSetup=bC.xhrSetup}}bw.prototype.destroy=function bz(){this.abort();this.loader=null};bw.prototype.abort=function bB(){var bC=this.loader;if(bC&&bC.readyState!==4){this.stats.aborted=true;bC.abort()}window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null};bw.prototype.load=function bA(bD,bC,bE){this.context=bD;this.config=bC;this.callbacks=bE;this.stats={trequest:performance.now(),retry:0};this.retryDelay=bC.retryDelay;this.loadInternal()};bw.prototype.loadInternal=function bv(){var bF,bD=this.context;bF=this.loader=new XMLHttpRequest();var bC=this.stats;bC.tfirst=0;bC.loaded=0;var bG=this.xhrSetup;try{if(bG){try{bG(bF,bD.url)}catch(bE){bF.open("GET",bD.url,true);bG(bF,bD.url)}}if(!bF.readyState){bF.open("GET",bD.url,true)}}catch(bE){this.callbacks.onError({code:bF.status,text:bE.message},bD,bF);return}if(bD.rangeEnd){bF.setRequestHeader("Range","bytes="+bD.rangeStart+"-"+(bD.rangeEnd-1))}bF.onreadystatechange=this.readystatechange.bind(this);bF.onprogress=this.loadprogress.bind(this);bF.responseType=bD.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);bF.send()};bw.prototype.readystatechange=function bx(bC){var bL=bC.currentTarget,bI=bL.readyState,bJ=this.stats,bD=this.context,bE=this.config;if(bJ.aborted){return}if(bI>=2){window.clearTimeout(this.requestTimeout);if(bJ.tfirst===0){bJ.tfirst=Math.max(performance.now(),bJ.trequest)}if(bI===4){var bG=bL.status;if(bG>=200&&bG<300){bJ.tload=Math.max(bJ.tfirst,performance.now());var bH=void 0,bK=void 0;if(bD.responseType==="arraybuffer"){bH=bL.response;bK=bH.byteLength}else{bH=bL.responseText;bK=bH.length}bJ.loaded=bJ.total=bK;var bF={url:bL.responseURL,data:bH};this.callbacks.onSuccess(bF,bJ,bD,bL)}else{if(bJ.retry>=bE.maxRetry||bG>=400&&bG<499){U.b.error(bG+" while loading "+bD.url);this.callbacks.onError({code:bG,text:bL.statusText},bD,bL)}else{U.b.warn(bG+" while loading "+bD.url+", retrying in "+this.retryDelay+"...");this.destroy();this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,bE.maxRetryDelay);bJ.retry++}}}else{this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),bE.timeout)}}};bw.prototype.loadtimeout=function bu(){U.b.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)};bw.prototype.loadprogress=function by(bD){var bF=bD.currentTarget,bC=this.stats;bC.loaded=bD.loaded;if(bD.lengthComputable){bC.total=bD.total}var bE=this.callbacks.onProgress;if(bE){bE(bC,this.context,null,bF)}};return bw}();var a2=(aG);var a4=ba(3);var a8=ba.n(a4);var ah={autoStartLoad:true,startPosition:-1,defaultAudioCodec:undefined,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1000*1000,maxBufferHole:0.5,maxSeekHole:2,lowBufferWatchdogPeriod:0.5,highBufferWatchdogPeriod:3,nudgeOffset:0.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,liveDurationInfinity:false,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,manifestLoadingMaxRetryTimeout:64000,startLevel:undefined,levelLoadingTimeOut:10000,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1000,levelLoadingMaxRetryTimeout:64000,fragLoadingTimeOut:20000,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1000,fragLoadingMaxRetryTimeout:64000,fragLoadingLoopThreshold:3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5000,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:3,loader:a2,fLoader:undefined,pLoader:undefined,xhrSetup:undefined,fetchSetup:undefined,abrController:Y,bufferController:j,capLevelController:aa,fpsController:ao,stretchShortVideoTrack:false,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:500000,abrBandWidthFactor:0.95,abrBandWidthUpFactor:0.7,abrMaxWithRealBitrate:false,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};if(false){ah.subtitleStreamController=SubtitleStreamController;ah.subtitleTrackController=SubtitleTrackController;ah.timelineController=TimelineController;ah.cueHandler=Cues;ah.enableCEA708Captions=true;ah.enableWebVTT=true;ah.captionsTextTrack1Label="English";ah.captionsTextTrack1LanguageCode="en";ah.captionsTextTrack2Label="Spanish";ah.captionsTextTrack2LanguageCode="es"}if(false){ah.audioStreamController=AudioStreamController;ah.audioTrackController=AudioTrackController}var X=function(){function bu(by,bw){for(var bv=0;bv<bw.length;bv++){var bx=bw[bv];bx.enumerable=bx.enumerable||false;bx.configurable=true;if("value" in bx){bx.writable=true}Object.defineProperty(by,bx.key,bx)}}return function(bx,bv,bw){if(bv){bu(bx.prototype,bv)}if(bw){bu(bx,bw)}return bx}}();function ag(bu,bv){if(!(bu instanceof bv)){throw new TypeError("Cannot call a class as a function")}}var aH=function(){bv.isSupported=function bw(){return aS()};X(bv,null,[{key:"version",get:function bx(){return"0.8.9"}},{key:"Events",get:function bx(){return E.a}},{key:"ErrorTypes",get:function bx(){return az.b}},{key:"ErrorDetails",get:function bx(){return az.a}},{key:"DefaultConfig",get:function bx(){if(!bv.defaultConfig){return ah}return bv.defaultConfig},set:function bE(bG){bv.defaultConfig=bG}}]);function bv(){var bU=this;var bX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ag(this,bv);var bO=bv.DefaultConfig;if((bX.liveSyncDurationCount||bX.liveMaxLatencyDurationCount)&&(bX.liveSyncDuration||bX.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var bI in bO){if(bI in bX){continue}bX[bI]=bO[bI]}if(bX.liveMaxLatencyDurationCount!==undefined&&bX.liveMaxLatencyDurationCount<=bX.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(bX.liveMaxLatencyDuration!==undefined&&(bX.liveMaxLatencyDuration<=bX.liveSyncDuration||bX.liveSyncDuration===undefined)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}Object(U.a)(bX.debug);this.config=bX;this._autoLevelCapping=-1;var bV=this.observer=new ac.a();bV.trigger=function bQ(b4){for(var b2=arguments.length,b5=Array(b2>1?b2-1:0),b3=1;b3<b2;b3++){b5[b3-1]=arguments[b3]}bV.emit.apply(bV,[b4,b4].concat(b5))};bV.off=function bZ(b4){for(var b2=arguments.length,b5=Array(b2>1?b2-1:0),b3=1;b3<b2;b3++){b5[b3-1]=arguments[b3]}bV.removeListener.apply(bV,[b4].concat(b5))};this.on=bV.on.bind(bV);this.off=bV.off.bind(bV);this.trigger=bV.trigger.bind(bV);var bY=this.abrController=new bX.abrController(this);var bK=new bX.bufferController(this);var bG=new bX.capLevelController(this);var bM=new bX.fpsController(this);var bS=new aL(this);var bN=new p(this);var b1=new aR(this);var bT=new q(this);var bH=this.levelController=new u(this);var bJ=this.streamController=new d(this);var bP=[bH,bJ];var b0=bX.audioStreamController;if(b0){bP.push(new b0(this))}this.networkControllers=bP;var bL=[bS,bN,b1,bY,bK,bG,bM,bT];b0=bX.audioTrackController;if(b0){var bW=new b0(this);this.audioTrackController=bW;bL.push(bW)}b0=bX.subtitleTrackController;if(b0){var bR=new b0(this);this.subtitleTrackController=bR;bL.push(bR)}[bX.subtitleStreamController,bX.timelineController].forEach(function(b2){if(b2){bL.push(new b2(bU))}});this.coreComponents=bL}bv.prototype.destroy=function bF(){U.b.log("destroy");this.trigger(E.a.DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(bG){bG.destroy()});this.url=null;this.observer.removeAllListeners();this._autoLevelCapping=-1};bv.prototype.attachMedia=function bA(bG){U.b.log("attachMedia");this.media=bG;this.trigger(E.a.MEDIA_ATTACHING,{media:bG})};bv.prototype.detachMedia=function bB(){U.b.log("detachMedia");this.trigger(E.a.MEDIA_DETACHING);this.media=null};bv.prototype.loadSource=function by(bG){bG=aO.a.buildAbsoluteURL(window.location.href,bG,{alwaysNormalize:true});U.b.log("loadSource:"+bG);this.url=bG;this.trigger(E.a.MANIFEST_LOADING,{url:bG})};bv.prototype.startLoad=function bD(){var bG=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;U.b.log("startLoad("+bG+")");this.networkControllers.forEach(function(bH){bH.startLoad(bG)})};bv.prototype.stopLoad=function bC(){U.b.log("stopLoad");this.networkControllers.forEach(function(bG){bG.stopLoad()})};bv.prototype.swapAudioCodec=function bu(){U.b.log("swapAudioCodec");this.streamController.swapAudioCodec()};bv.prototype.recoverMediaError=function bz(){U.b.log("recoverMediaError");var bG=this.media;this.detachMedia();this.attachMedia(bG)};X(bv,[{key:"levels",get:function bx(){return this.levelController.levels}},{key:"currentLevel",get:function bx(){return this.streamController.currentLevel},set:function bE(bG){U.b.log("set currentLevel:"+bG);this.loadLevel=bG;this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function bx(){return this.streamController.nextLevel},set:function bE(bG){U.b.log("set nextLevel:"+bG);this.levelController.manualLevel=bG;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function bx(){return this.levelController.level},set:function bE(bG){U.b.log("set loadLevel:"+bG);this.levelController.manualLevel=bG}},{key:"nextLoadLevel",get:function bx(){return this.levelController.nextLoadLevel},set:function bE(bG){this.levelController.nextLoadLevel=bG}},{key:"firstLevel",get:function bx(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function bE(bG){U.b.log("set firstLevel:"+bG);this.levelController.firstLevel=bG}},{key:"startLevel",get:function bx(){return this.levelController.startLevel},set:function bE(bG){U.b.log("set startLevel:"+bG);var bH=this;if(bG!==-1){bG=Math.max(bG,bH.minAutoLevel)}bH.levelController.startLevel=bG}},{key:"autoLevelCapping",get:function bx(){return this._autoLevelCapping},set:function bE(bG){U.b.log("set autoLevelCapping:"+bG);this._autoLevelCapping=bG}},{key:"autoLevelEnabled",get:function bx(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function bx(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function bx(){var bH=this,bL=bH.levels,bJ=bH.config.minAutoBitrate,bG=bL?bL.length:0;for(var bI=0;bI<bG;bI++){var bK=bL[bI].realBitrate?Math.max(bL[bI].realBitrate,bL[bI].bitrate):bL[bI].bitrate;if(bK>bJ){return bI}}return 0}},{key:"maxAutoLevel",get:function bx(){var bG=this;var bI=bG.levels;var bJ=bG.autoLevelCapping;var bH=void 0;if(bJ===-1&&bI&&bI.length){bH=bI.length-1}else{bH=bJ}return bH}},{key:"nextAutoLevel",get:function bx(){var bG=this;return Math.min(Math.max(bG.abrController.nextAutoLevel,bG.minAutoLevel),bG.maxAutoLevel)},set:function bE(bH){var bG=this;bG.abrController.nextAutoLevel=Math.max(bG.minAutoLevel,bH)}},{key:"audioTracks",get:function bx(){var bG=this.audioTrackController;return bG?bG.audioTracks:[]}},{key:"audioTrack",get:function bx(){var bG=this.audioTrackController;return bG?bG.audioTrack:-1},set:function bE(bH){var bG=this.audioTrackController;if(bG){bG.audioTrack=bH}}},{key:"liveSyncPosition",get:function bx(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function bx(){var bG=this.subtitleTrackController;return bG?bG.subtitleTracks:[]}},{key:"subtitleTrack",get:function bx(){var bG=this.subtitleTrackController;return bG?bG.subtitleTrack:-1},set:function bE(bH){var bG=this.subtitleTrackController;if(bG){bG.subtitleTrack=bH}}},{key:"subtitleDisplay",get:function bx(){var bG=this.subtitleTrackController;return bG?bG.subtitleDisplay:false},set:function bE(bH){var bG=this.subtitleTrackController;if(bG){bG.subtitleDisplay=bH}}}]);return bv}();var ax=aZ._default=(aH)}),(function(f,c,g){function e(i){var j={};function l(n){if(j[n]){return j[n].exports}var m=j[n]={i:n,l:false,exports:{}};i[n].call(m.exports,m,m.exports,l);m.l=true;return m.exports}l.m=i;l.c=j;l.i=function(m){return m};l.d=function(n,o,m){if(!l.o(n,o)){Object.defineProperty(n,o,{configurable:false,enumerable:true,get:m})}};l.n=function(n){var m=n&&n.__esModule?function o(){return n["default"]}:function p(){return n};l.d(m,"a",m);return m};l.o=function(m,n){return Object.prototype.hasOwnProperty.call(m,n)};l.p="/";l.oe=function(m){console.error(m);throw m};var k=l(l.s=ENTRY_MODULE);return k._default||k}function b(i){return(i+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(l){var j=[];var o=l.toString();var i=o.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i){return j}var n=i[1];var m=new RegExp("(\\\\n|\\W)"+b(n)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");var k;while((k=m.exec(o))){j.push(k[3])}return j}function h(l,n){var j=[n];var i=[];var m={};while(j.length){var k=j.pop();if(m[k]||!l[k]){continue}m[k]=true;i.push(k);var o=d(l[k]);j=j.concat(o)}return i}f.exports=function(l,q){q=q||{};var j=g.m;var n=q.all?Object.keys(j):h(j,l);var i="("+e.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+n.map(function(r){return""+JSON.stringify(r)+": "+j[r].toString()}).join(",")+"})(self);";var k=new window.Blob([i],{type:"text/javascript"});if(q.bare){return k}var o=window.URL||window.webkitURL||window.mozURL||window.msURL;var p=o.createObjectURL(k);var m=new window.Worker(p);m.objectURL=p;return m}}),(function(d,g,c){Object.defineProperty(g,"__esModule",{value:true});var h=c(7);var j=c(1);var f=c(0);var b=c(5);var i=c.n(b);var e=function e(m){var l=new i.a();l.trigger=function n(r){for(var p=arguments.length,s=Array(p>1?p-1:0),q=1;q<p;q++){s[q-1]=arguments[q]}l.emit.apply(l,[r,r].concat(s))};l.off=function o(r){for(var p=arguments.length,s=Array(p>1?p-1:0),q=1;q<p;q++){s[q-1]=arguments[q]}l.removeListener.apply(l,[r].concat(s))};var k=function k(p,q){m.postMessage({event:p,data:q})};m.addEventListener("message",function(r){var s=r.data;switch(s.cmd){case"init":var p=JSON.parse(s.config);m.demuxer=new h.a(l,s.typeSupported,p,s.vendor);try{Object(f.a)(p.debug===true)}catch(q){console.warn("demuxerWorker: unable to enable logs")}k("init",null);break;case"demux":m.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS);break;default:break}});l.on(j.a.FRAG_DECRYPTED,k);l.on(j.a.FRAG_PARSING_INIT_SEGMENT,k);l.on(j.a.FRAG_PARSED,k);l.on(j.a.ERROR,k);l.on(j.a.FRAG_PARSING_METADATA,k);l.on(j.a.FRAG_PARSING_USERDATA,k);l.on(j.a.INIT_PTS_FOUND,k);l.on(j.a.FRAG_PARSING_DATA,function(r,s){var p=[];var q={event:r,data:s};if(s.data1){q.data1=s.data1.buffer;p.push(s.data1.buffer);delete s.data1}if(s.data2){q.data2=s.data2.buffer;p.push(s.data2.buffer);delete s.data2}m.postMessage(q,p)})};g._default=(e)})])["_default"]})})(s7getCurrentNameSpace());