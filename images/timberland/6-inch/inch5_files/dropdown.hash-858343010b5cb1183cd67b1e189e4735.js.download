define(["jquery","pubsub","shared.main.screen","jquery.hoverintent","shared.lazyload","wcs.utils"],function(D,n,t,o,e,l){var a;return(a={defaults:{el:".topnav-mainnav",dataAttr:"topnav-dropdown-options",dropdown:".topnav-dropdown",dropdownL3:".topnav-accordion-l3-dropdown",dropdownCloseButton:"topnav-dropdown-close",dropdownLink:".l1.has-children:not('.topnav-list, .more') > a",dropdownItem:".l1.has-children:not('.topnav-list, .more')",item:".topnav-accordion-item",itemLink:".topnav-accordion-item-link",l1Item:".l1:not('.topnav-list, .more')",l1ItemActive:".l1.active:not('.topnav-list, .more')",promoColumn:"topnav-column-promo",topnavHeader:".topnav-header",topnavPromobar:".topnav-promobar",shopAll:"topnav-accordion-shopall",stickyMed:".sticky-medium",rateLimit:150,dropdownWrapper:".topnav-dropdown-wrapper",placeholderLink:".topnav-accordion-item-link.placeholder",lazyLoadImages:"picture.lazy-load"},init:function(){var n=this;return n.deferred=D.Deferred(),n.menuStatus="inactive",n.$element=D(n.defaults.el),n.metadata=n.$element.data(n.defaults.dataAttr),n.config=D.extend({},n.defaults,n.metadata),n.$dropdown=n.$element.find(n.config.dropdown),n.$dropdownItem=n.$element.find(n.config.dropdownItem),n.$l3Containers=D(n.config.dropdownL3),n.$l3Controllers=n.$l3Containers.siblings(n.config.itemLink),n.$dropdown.find("."+n.config.promoColumn+" a").addClass(n.config.promoColumn+"-link"),n.events(),n.configureAriaTags(),n.setColumnOrder(t.size()),D.pubsub("publish","vfdp.aem.topnav.dropdown.loaded"),n.deferred.resolve(),n},events:function(){var e=this;e.checkForVisibleDropdowns(),e.toggleMenuStatus(e.$element),D.pubsub("subscribe","window.resize.breakpoint",function(n,o){e.configureAriaTags(),e.setColumnOrder(t.size()),e.hideDropdown(e.$dropdownItem),e.toggleL1KeyboardMenuEvents(D(e.config.l1Item))}),D.pubsub("subscribe","vfdp.aem.topnav.moreMenu.remove.dropdown",function(n,o){e.bindDropdownMenuEvents(o)}),D.pubsub("subscribe","vfdp.aem.topnav.moreMenu.add.dropdown",function(n,o){e.unbindDropdownMenuEvents(o)}),e.bindDropdownMenuEvents(D(e.config.l1Item)),e.toggleL1KeyboardMenuEvents(D(e.config.l1Item)),D("."+e.config.dropdownCloseButton).on("click touch",function(n){n.preventDefault(),e.menuStatus="inactive",e.animateClosed(D(this).closest(".l1"))}),D.pubsub("subscribe","vfdp.aem.topnav.moreDropdown.opened",function(){e.hideDropdown(e.$dropdownItem)}),D(e.config.placeholderLink).on("click",function(n){n.preventDefault()})},unbindDropdownMenuEvents:function(n){n.off("mouseenter mouseleave"),n.find("> a").off("tap"),n.off("keydown")},toggleL1KeyboardMenuEvents:function(n){n.off("keydown"),"small"!==t.size()&&n.on("keydown",this,this.topnavMenuKeyDownHandler)},bindDropdownMenuEvents:function(n){var e=this;n.hoverIntent({over:function(){"small"!==t.size()&&("inactive"===e.menuStatus&&n.hasClass("has-children")&&!D(this).hasClass("active")?e.animateOpen(D(this)):e.showDropdown(D(this)))},out:function(){},timeout:e.config.rateLimit}),n.find("> a").on("tap",function(n){var o=D(this).closest(e.config.dropdownItem);"small"!==t.size()&&D(this).closest(".l1").hasClass("has-children")&&(n.preventDefault(),o.hasClass("active")?e.animateClosed(o):D(e.config.l1Item).hasClass("active")?e.showDropdown(o):e.animateOpen(o))})},configureAriaTags:function(){var n=this;"small"!==t.size()?(n.$l3Containers.each(function(){var n=D(this);n.attr({"data-labelledby":n.attr("aria-labelledby")}).removeAttr("aria-labelledby")}),n.$l3Controllers.each(function(){var n=D(this);n.attr({"data-expanded":n.attr("aria-expanded"),"data-controls":n.attr("aria-controls"),"data-haspopup":n.attr("aria-haspopup")}).removeAttr("aria-expanded aria-controls aria-haspopup")})):(n.$l3Containers.each(function(){var n=D(this);n.attr({"aria-labelledby":n.attr("data-labelledby")}).removeAttr("data-labelledby")}),n.$l3Controllers.each(function(){var n=D(this);n.attr({"aria-expanded":n.attr("data-expanded"),"aria-controls":n.attr("data-controls"),"aria-haspopup":n.attr("data-haspopup")}).removeAttr("data-expanded data-controls data-haspopup")}))},setColumnOrder:function(e){this.$dropdown.find(".columns").each(function(){var n=D(this),o=n.data("order-"+e);void 0!==o&&n.css("order",o)})},animateOpen:function(n){var o=this,e=n.find(">"+o.config.itemLink),t=n.find(o.config.dropdown),a=0,i=t[0],s=D(o.config.topnavPromobar)[0],r=function(){i.style.height="",i.removeEventListener("transitionend",r)};if(o.hideDropdown(n.siblings(o.config.dropdownItem)),D(o.config.topnavPromobar).hasClass("notransition")&&D(o.config.topnavPromobar).removeClass("notransition"),n.hasClass("active")||!n.hasClass("has-children"))return!0;var d=t.add(o.config.topnavPromobar);l.interruptTransitions(d,function(){n.addClass("active"),t.css({display:"block",height:"0"}),D(o.config.topnavHeader).hasClass("sticky-minimized")&&D(o.config.topnavPromobar).removeClass("hide"),a=i.scrollHeight}),i.addEventListener("transitionend",r),e.attr({"aria-expanded":"true"}),D(document).on("click touchstart scroll",o,o.topnavDismiss),i.style.height=a+"px",s.style.top=a+"px",D.pubsub("publish","vfdp.aem.topnav.dropdown.animate.opened")},animateClosed:function(n){var o,e=this,t=n.find(">"+e.config.itemLink),a=n.find(e.config.dropdown),i=a[0],s=D(e.config.topnavPromobar)[0],r=function(){i.style.display="",i.style.height="",a.closest(".l1").removeClass("active"),D(e.config.topnavHeader).hasClass("sticky-minimized")?D(e.config.topnavPromobar).addClass("hide"):D(e.config.topnavPromobar).css({top:""}),i.removeEventListener("transitionend",r)};D(e.config.topnavPromobar).hasClass("notransition")&&D(e.config.topnavPromobar).removeClass("notransition"),o=i.scrollHeight,t.attr({"aria-expanded":"false"}),D(document).off("click touchstart scroll",e,e.topnavDismiss),requestAnimationFrame(function(){var n=a.add(e.config.topnavPromobar);l.interruptTransitions(n,function(){i.style.height=o+"px",s.style.top=o+"px"}),requestAnimationFrame(function(){i.addEventListener("transitionend",r),i.style.height="0px",s.style.top="0px"})})},checkForVisibleDropdowns:function(){var n=this,o=D(n.config.dropdown+":visible");0<o.length?(o.closest(n.config.dropdownItem).one("mouseleave",function(){n.$element.removeClass("topnav-mainnav-no-js")}),n.$element.one("mouseleave",n,n.dropdownDismissHandler)):n.$element.removeClass("topnav-mainnav-no-js")},dropdownDismissHandler:function(n){var o=n.data,e=D(n.target);e.is(o.$element)||e.is(o.config.dropdownWrapper)||e.is(o.config.topnavPromobar)||o.$dropdownItem.hasClass("active")&&(o.animateClosed(D(o.config.l1ItemActive)),o.menuStatus="inactive")},toggleMenuStatus:function(n){function o(n){var o=n.data;D(".l1.more").hasClass("hide")&&o.$dropdownItem.hasClass("active")&&(D(n.target)!==D(n.currentTarget)&&!D(n.target).is(o.$element)||(o.hideDropdown(D(o.config.l1ItemActive)),o.menuStatus="inactive"))}var e=this;n.hoverIntent({over:function(n){"small"!==t.size()&&(e.menuStatus="active",e.$dropdownItem.hasClass("active")&&(D(this).one("mouseleave",e,e.dropdownDismissHandler),D(this).on("mousemove",e,o)))},out:function(){"small"!==t.size()&&(e.menuStatus="inactive",D(this).off("mousemove",e,o))},timeout:e.config.rateLimit}),n.closest(e.config.topnavHeader).hoverIntent({over:function(n){"small"!==t.size()&&D(this).find(e.config.lazyLoadImages).lazyload()},out:function(){"small"!==t.size()&&e.$dropdownItem.hasClass("active")&&(e.animateClosed(D(e.config.l1ItemActive)),D(this).off("mousemove",e,o),D(this).off("mouseleave",e,e.dropdownDismissHandler),e.menuStatus="inactive")},timeout:e.config.rateLimit})},hideDropdown:function(n){var o=this,e=n.find(">"+o.config.itemLink),t=n.find(o.config.dropdown),a=D(o.config.topnavPromobar);t.css({transition:"",display:"",height:""}),e.attr({"aria-expanded":"false"}),n.removeClass("active"),n.siblings(o.config.dropdownItem).removeClass("active"),D(o.config.topnavHeader).hasClass("sticky-minimized")&&a.addClass("hide"),a.addClass("notransition").css({top:0}),D(document).off("click touchstart scroll",o,o.topnavDismiss)},showDropdown:function(n){var o,e=this,t=n.find(">"+e.config.itemLink),a=n.find(e.config.dropdown),i=D(e.config.topnavPromobar);e.hideDropdown(n.siblings(e.config.dropdownItem)),n.hasClass("has-children")?(n.addClass("active"),a.css({transition:"",display:"block"}),o=a.outerHeight(),D(e.config.topnavHeader).hasClass("sticky-minimized")&&D(e.config.topnavPromobar).removeClass("hide"),a.css({height:o}),i.addClass("notransition").css({top:o})):D(e.config.topnavHeader).hasClass("sticky-minimized")&&D(e.config.topnavPromobar).addClass("hide"),t.attr({"aria-expanded":"true"}),D(document).on("click touchstart scroll",e,e.topnavDismiss),D.pubsub("publish","vfdp.aem.topnav.dropdown.opened")},topnavDismiss:function(n){var o=n.data;D(n.target).closest(o.config.dropdownItem).length||D(n.target).closest(o.config.dropdown).length||o.hideDropdown(D(o.config.dropdownItem))},addTabIndexToDropdownElements:function(n){var a="a:not(.l2 ."+this.config.shopAll+"-link)";D(n).each(function(n,o){for(var e=D(o).find(a),t=0;t<e.length;t++)D(e[t]).attr("tabindex",t)})},topnavMenuKeyDownHandler:function(n){var o,e,t=n.data,a=D(this),i=a.find(D(":focus")),s=i.parent(),r=s.closest(t.config.dropdownWrapper),d=s.closest(".columns"),l=s.hasClass("has-children"),c=l&&s.hasClass("l1"),f=40,p=13,m=27,u=37,h=39,v=32,g=38;function w(){var n=r.find("> ."+t.config.shopAll+" a");return n.length||(n=r.find("> .row > .columns:first-child").find(".l2").first()),n}function C(n){return o=n.length?n.hasClass(t.config.promoColumn)&&n.find("."+t.config.promoColumn+"-link").length?n.find("."+t.config.promoColumn+"-link").first():n.find(".l2").first():w()}switch(n.keyCode){case v:case p:c?(n.preventDefault(),s.hasClass("active")?t.hideDropdown(a):(t.showDropdown(a),s.find("."+t.config.dropdownCloseButton).focus())):i.hasClass(t.config.dropdownCloseButton)&&(n.preventDefault(),t.hideDropdown(a),i.closest(".l1").find("> "+t.config.itemLink).focus());break;case f:if(n.preventDefault(),c)t.showDropdown(a),s.find("."+t.config.dropdownCloseButton).focus();else{var b=d.next();o=s.next(),i.hasClass(t.config.dropdownCloseButton)?o=w():i.hasClass(t.config.shopAll+"-link")?o=r.find(t.config.item).first():l?o=s.find(".l3").first():s.hasClass("l2")&&s.is(":last-child")?o=C(b):s.hasClass("l3")&&s.is(":last-child")?(o=s.closest(".l2").next()).length||(o=C(b)):i.hasClass(t.config.promoColumn+"-link")&&(s.hasClass("media")&&(o=d.find("."+t.config.promoColumn+"-text a").first()),s.hasClass(t.config.promoColumn+"-text")&&(o=i.next("a")),o.length||(o=w())),o.is("a")?o.focus():o.find("> a").focus()}break;case g:n.preventDefault();var k=d.prev();e=s.prev(),i.hasClass(t.config.shopAll+"-link")?e=r.find("> .row > .columns:last-child a").last():s.hasClass("l2")&&s.is(":first-child")?d.is(":first-child")?(e=r.find(" > ."+t.config.shopAll+" a"),k.length||r.find("> .row > .columns:last-child a").last()):e=k.find("a").last():e.hasClass("has-children")?e=e.find("a").last():s.hasClass("l3")&&s.is(":first-child")?e=s.closest(".l2"):i.hasClass(t.config.promoColumn+"-link")&&(s.hasClass(t.config.promoColumn+"-text")&&(e=i.prev("a")),e.length||s.hasClass("media")||(e=d.find("."+t.config.promoColumn+"-media a")),e.length||(e=k.find("a").last())),e.is("a")?e.focus():e.find("> a").focus();break;case h:n.preventDefault(),s.hasClass("l1")?(o=s.next(":visible").find("> a")).length||(o=t.$element.find(".l1").first().find("> a")):(o=d.next().find("a").first()).length||(o=d.siblings().first().find("a").first()),o.focus();break;case u:n.preventDefault(),s.hasClass("l1")?(e=s.prev().find("> a")).length||(e=t.$element.find(".l1:visible").last().find("> a")):(e=d.prev().find("a").first()).length||(e=d.siblings().last().find("a").first()),e.focus();break;case m:i.closest(".l1").hasClass("active")&&(n.preventDefault(),t.hideDropdown(a),i.closest(".l1").find("> "+t.config.itemLink).focus())}}}).init(),a});
//# sourceMappingURL=../../../maps/js/cms/nav/dropdown.hash-3de0f38ab39f4de046a874a1e35066f0.js.map