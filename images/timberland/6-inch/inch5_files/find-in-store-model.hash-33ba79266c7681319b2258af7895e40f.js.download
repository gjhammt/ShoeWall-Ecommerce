define(["jquery","domReady","wcs.context","wcs.text","wcs.utils","wcs.alert","pubsub","wcs.net"],function(I,e,a,s,d,f,t,c){var n,_,u,l,S,N=!1,E=!1,T={},r=(I("#shipToStoreRadius").data("radiusUom")||"").split("|"),O={},o={},L=I(".find-a-store-form-js").data(),h=I(".find-store-container-js .find-retail-store-catentryid-js"),y=I(".ship-to-store-radius-js"),C=I('input[name="shipToStoreZip"]');function p(o){var i=[],e=I(".attr-color-js").data("attributeId");return Object.keys(o).forEach(function(r){e!==r&&Object.keys(O.attributes).forEach(function(e,t){O.attributes[e].map(function(e,t){o[r]==e.display&&e.catentryId.forEach(function(e,t){i.push(e.toString())})})})}),i}function R(e,t){var r=Object.keys(T).length;return(1==r?e:2<r?function(e){for(var t,r=e.length,o=[],i={},n=0;n<r;n++)i[t=e[n]]=1<=i[t]?i[t]+1:1,2<=i[t]&&o.push(t);return o}(t):t).toString()}function g(e){var t=I.Deferred();return I.ajax({type:"GET",url:L.omsInstoreavailabilityUrl,data:e,cache:!1}).done(function(e){!0===(N=e.omsUnreachableError)?t.reject():t.resolve(e)}).fail(function(e){A()}),t}var m=function(){S=l=u=_=n=void 0};function v(t){var e,r,o=I(t),i=(o.find("response").attr("code"),o.find("poi")),n=L.enableFilter;if(u=[],I(i).each(function(e,t){u+=(""===u?"":",")+s.safeString(I(t).find("clientkey").text())}),u=u,WCS_CONFIG.get("BOPIS::bopisEnabled")&&(l=[],I(i).each(function(e,t){l+=(""===l?"":",")+s.safeString(I(t).find("enterprise_store_identifier").text())}),l=l),L.findLiveStoreInventoryEnabled&&(e=i,r=L.findLiveStoreInventoryProfileIdNode,I(e).each(function(e,t){S+=(""===S?"":",")+s.safeString(I(t).find(r).text())}),S=S),"true"!=n)return d.xmlToJson(t);(function(e){var o=[];I.each(e,function(e,t){var r=I(t).find("clientkey").text();o[e]=r});var t=I("form.get-active-store-js");return I('input[name="stloc_id"]',t).val(o.toString()),c.submitForm(t)})(i).done(function(e){if(null===e.errorMessage)return d.xmlToJson(t)})}function A(){f.hideLoadingNotification(),I("#find-store-container .store-results-list-js").html('<div class="callout alert">'+LANG_MSG["PDP.STORE_INVENTORY.MSG.noStores"]+"</div>")}function D(e){var t,r=I.Deferred();return t=WCS_CONFIG.get("BOPIS::bopisEnabled")?"&retailStoreEnterpriseStoreIdentifierFilterList="+l:"&retailStoreClientkeyFilterList="+e,L.findLiveStoreInventoryEnabled&&(t+="&carProfileIdList="+S),I.ajax({type:"GET",url:L.instoreavailabilityUrl+"&catentryId="+h.val()+t,dataType:"json",cache:!1}).done(function(e){r.resolve(e)}).fail(function(e){A()}),r}function F(){return a.getCookie("Edgescape-Lat-Long")}function b(){return a.getCookie("Edgescape-Zip")}var G,i,w=((i={})._combineDataInNewObject=function(){var o=n.response.collection;return o?(o.storeColumnTitle=LANG_FIND_IN_STORE.RETAIL_STORE_IN_STORE_COL_TITLE,o.storeCheckBox=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_STORE_AVAILABILITY_CHECKBOX,o.storeChoose=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_STORE_CHOOSE_BUTTON,o.stockColumnTitle=LANG_FIND_IN_STORE.RETAIL_STORE_IN_STOCK_COL_TITLE,o.resultsText=LANG_FIND_IN_STORE.RETAIL_STORE_RESULTS_TEXT,o.outOfStockText=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_OUT_OF_STOCK,o.viewMoreCollapsed=LANG_FIND_IN_STORE.RETAIL_STORE_MORE_BUTTON_TEXT_COLLAPSED,o.viewMoreExpanded=LANG_FIND_IN_STORE.RETAIL_STORE_MORE_BUTTON_TEXT_EXPANDED,o.currentLocation=LANG_FIND_IN_STORE.RETAIL_STORE_CURRENT_LOCATION,o.reserveButton=LANG_FIND_IN_STORE.ROBIS_RESERVE_BUTTON_TEXT,I(o.poi).each(function(e,t){var r=this._distance&&this._distance["#text"]?this._distance["#text"]:"";this.googleMapLink=function(e,t){var r=encodeURIComponent(e);switch(d.getDeviceType()){case"ios":return"http://maps.apple.com?saddr="+t+"&daddr="+r;case"android":return"geo:0,0?q="+r;case"wp7":return"maps:"+r;case"wp8":return"bingmaps:?where="+r;default:return"http://maps.google.com?saddr="+t+"&daddr="+r}}(i._buildAddressStringForGoogleMaps(this),o.currentLocation),this.weekdayHours=i._getMondayThroughFriday(e,this),this.inventory=i._getInventory(this,_.inventory),this.appendValue=i._appendCookieName(this),this.storeIdentifier=i._storeCookieValue(this),this.storeZipValue=i._storeZipValue(this),this.productAttributes=_.productInfo.attributes,this.productImage=_.productInfo.productImage,this.productName=_.productInfo.productName,this.storeMessageTitle=LANG_FIND_IN_STORE.RETAIL_STORE_IN_STORE_TITLE,this.storeMessage=LANG_FIND_IN_STORE.RETAIL_STORE_IN_STORE_DESCRIPTION,WCS_CONFIG.get("PDP::ROBISEnabled")&&this.inventory&&(this.inventory.ROBISEnabled?(LANG_FIND_IN_STORE.ROBIS_RETAIL_STORE_IN_STORE_TITLE&&(this.storeMessageTitle=LANG_FIND_IN_STORE.ROBIS_RETAIL_STORE_IN_STORE_TITLE),LANG_FIND_IN_STORE.ROBIS_RETAIL_STORE_IN_STORE_DESCRIPTION&&(this.storeMessage=LANG_FIND_IN_STORE.ROBIS_RETAIL_STORE_IN_STORE_DESCRIPTION)):!this.inventory.isInventoryAvailable&&WCS_CONFIG.get("PDP::hideOutOfStockDescriptionEnabled")&&(this.storeMessageTitle="",this.storeMessage="")),this.getDirections=LANG_FIND_IN_STORE.RETAIL_STORE_FIND_STORE_GET_DIRECTIONS,this.saturday=LANG_FIND_IN_STORE.RETAIL_STORE_SATURDAY,this.sunday=LANG_FIND_IN_STORE.RETAIL_STORE_SUNDAY,this.monfri=LANG_FIND_IN_STORE.RETAIL_STORE_MONDAY_FRIDAY,this.storeHours=LANG_FIND_IN_STORE.RETAIL_STORE_FIND_STORE_HOURS,this.resultClass=i._getResultClass(e),this.radiusUOM=x(r)}),o.includeStockInfoInStoreResults=WCS_CONFIG.get("PDP::includeStockInfoInStoreResults"),o):n},i._getInventory=function(r,o){var i,n,a=WCS_CONFIG.get("PDP::w2giStoreField");return I(o).each(function(e,t){n=WCS_CONFIG.get("BOPIS::bopisEnabled")?r.enterprise_store_identifier["#text"]:WCS_CONFIG.get("PDP::w2gicatalogStoreIdCheck")?"enterprise_store_identifier"===a?r.enterprise_store_identifier["#text"]:r.storenumber["#text"]:r.clientkey["#text"],o[e].retailStore===n&&(i=o[e])}),i},i._buildAddressStringForGoogleMaps=function(e){var t=I.isEmptyObject(e.name["#text"])?"":e.name["#text"]+", ";return t+=I.isEmptyObject(e.address1["#text"])?"":e.address1["#text"]+" ",t+=I.isEmptyObject(e.address2["#text"])?"":e.address2["#text"]+" ",t+=I.isEmptyObject(e.city["#text"])?"find-in-store-alt-colors.js":e.city["#text"]+", ",t+=I.isEmptyObject(e.state["#text"])?"":e.state["#text"]+" ",t+=I.isEmptyObject(e.postalcode["#text"])?"":e.postalcode["#text"]},i._getResultClass=function(e){return e<4?"initial":"hidden"},i._appendCookieName=function(e){var t,r=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_YOUR_STORE,o=WCS_CONFIG.get("BOPIS::bopisFavStore")+a.getStoreId(),i=a.getCookie(o),n=e.postalcode["#text"];return i===(void 0!==e.enterprise_store_identifier?e.enterprise_store_identifier["#text"]:"")&&n&&(a.setCookie("USER_ENTERED_ZIP",n),t=r),t},i._storeCookieValue=function(e){return void 0!==e.enterprise_store_identifier?e.enterprise_store_identifier["#text"]:""},i._storeZipValue=function(e){return e.postalcode["#text"]},i._getMondayThroughFriday=function(e,t){var r,o=!0,i=[];try{i.push({day:LANG_FIND_IN_STORE.RETAIL_STORE_MONDAY,hours:t.m["#text"]})}catch(e){}try{i.push({day:LANG_FIND_IN_STORE.RETAIL_STORE_TUESDAY,hours:t.t["#text"]})}catch(e){}try{i.push({day:LANG_FIND_IN_STORE.RETAIL_STORE_WEDNESDAY,hours:t.w["#text"]})}catch(e){}try{i.push({day:LANG_FIND_IN_STORE.RETAIL_STORE_THURSDAY,hours:t.thu["#text"]})}catch(e){}try{i.push({day:LANG_FIND_IN_STORE.RETAIL_STORE_FRIDAY,hours:t.f["#text"]})}catch(e){}for(G=i.length,r=0;r<G;r++)i[r].hours!==i[0].hours&&(o=!1);return o?t.m:(i.htmlClass="hidden",i)},{combineData:i._combineDataInNewObject});function x(e){var t=r[1];return e&&1!==parseFloat(e)&&(t=r[0]),t}return{getStoreData:function(e,t){var r=I.Deferred(),o=I.Deferred(),i=I.Deferred();return m(),I("#search-stores").on("click",function(){E=!1}),function(e,t){var r=I.Deferred(),o="^(\\+|\\-)?[0-9]+(.[0-9]+)?$";if(WCS_CONFIG.get("PDP::w2giServerApiEnabled")){var i=L.w2giServerApiUrl,n=e?y.find("option:last").val():y.val(),a=null!==F()&&void 0!==F()?F():"",s=b()?b().split("-")[0]:"",d=a.split(","),c={radius:n};t&&""!==C.val()?c.addressLine=C.val():e&&""!==s?c.addressLine=s:e&&1<d.length&&d[0].match(o)&&d[1].match(o)?c.latLong=a:c.addressLine="",f.showLoadingNotification("p"),I.ajax({type:"GET",url:i,dataType:"xml",data:c}).done(function(e){e=v(e),r.resolve(e)}).fail(function(e){console.error(e),f.hideLoadingNotification()})}else{var _=function(e,t){var r=L.w2giUrl,o=L.w2giAppkey,i=L.w2giLimit,n=L.w2giWhereClauseBrand,a=e?y.find("option:last").val():y.val(),s=WCS_CONFIG.get("PDP::pdpInStoreW2GICountryCode"),d=x(),c=0<d.length?"<radiusuom>"+d+"</radiusuom>":"",_=WCS_CONFIG.get("PDP::w2giAddWhereClauseFilterStores"),u=WCS_CONFIG.get("PDP::w2giStoreField"),l=WCS_CONFIG.get("PDP::w2gifetchBrandStores"),I=WCS_CONFIG.get("PDP::w2gifetchOutletStores"),f=WCS_CONFIG.get("PDP::w2gifetchAuthorizedDealers"),S=WCS_CONFIG.get("PDP::w2gifetchSummitSeries"),N=F()?F().split(","):["",""],E=b()?b().split("-")[0]:"",T="^(\\+|\\-)?[0-9]+(.[0-9]+)?$",O="<geolocs><geoloc>";t&&""!==C.val()?O+="<addressline>"+C.val()+"</addressline>":e&&""!==E?O+="<addressline>"+E+"</addressline>":e&&N[0].match(T)&&N[1].match(T)?(O+="<longitude>"+N[1]+"</longitude>",O+="<latitude>"+N[0]+"</latitude>"):O+="<addressline></addressline>";O+="<country>"+s+"</country>",O+="</geoloc></geolocs>";var h="",p=!0===_?"<"+u+"><notlike>''</notlike></"+u+">":"",R=!0===l?"<"+n+"><eq>1</eq></"+n+">":"",g=!0===I?"<outletstore><eq>1</eq></outletstore>":"",m=!0===f?"<retailstore><eq>1</eq></retailstore>":"",v=!0===S?"<summit><eq>1</eq></summit>":"";""===n&&(R=!0===l?"TRUE":"",g=!0===I?"TRUE":"",m=!0===f?"TRUE":"");h=""!==n?["<request>","<appkey>"+o+"</appkey>",'<formdata id="locatorsearch">',"<dataview>store_default</dataview>","<order>_distance</order>","<softmatch>1</softmatch>","<limit>"+i+"</limit>","<atleast>1</atleast>","<searchradius>"+a+"</searchradius>",c,O,"<stateonly>1</stateonly>","<nobf>1</nobf>","<where>",p,"<or>",R,g,m,v,"</or>","<country><eq>"+s+"</eq></country>","</where>","</formdata></request>"]:["<request>","<appkey>"+o+"</appkey>",'<formdata id="locatorsearch">',"<dataview>store_default</dataview>","<order>_distance</order>","<softmatch>1</softmatch>","<limit>"+i+"</limit>","<atleast>1</atleast>","<searchradius>"+a+"</searchradius>",c,O,"<stateonly>1</stateonly>","<nobf>1</nobf>","<where>",p,"<tnvn><eq></eq></tnvn>","<country><eq>"+s+"</eq></country>","<or>","<off><eq>"+R+"</eq></off>","<out><eq>"+g+"</eq></out>","<aut><eq>"+m+"</eq></aut>","</or></where></formdata></request>"];return r+=encodeURIComponent(h.join(""))}(e,t).split("?"),u=_[0],l=_[1];f.showLoadingNotification("p"),I.ajax({type:"POST",url:u,dataType:"xml",data:l}).done(function(e){e=v(e),r.resolve(e)}).fail(function(e){console.error(e),f.hideLoadingNotification()})}return r.promise()}(e,t).done(function(e){n=e,o.resolve(n)}),I.when(o).done(function(){(function(){var t=I.Deferred(),e=function(e){var t,r,o=window.location.href;return e=e.replace(/[\[\]]/g,"\\$&"),t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),(r=t.exec(o))?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}("findOMSInventory");if(0===u.length)return t.reject(),E&&A(),t.promise();(WCS_CONFIG.get("PDP::pdpInstoreOMSInventoryCheckEnabled")||null!==e&&"true"===e)&&!1===N?function(e){var t=h.val();0<e.length&&(e=e.replace(/^,|,$/g,""));return g({retailStoreClientkeyFilterList:e,catentryString:R(t,p(T)),selectedCatentry:t}).promise()}(u).done(function(e){t.resolve(e)}).fail(function(){!0===N&&D(u).done(function(e){t.resolve(e)})}):WCS_CONFIG.get("BOPIS::bopisEnabled")||null!==e&&"true"===e&&!1===N?function(e){var t=h.val();0<e.length&&(e=e.replace(/^,|,$/g,""));return g({retailStoreEnterpriseStoreIdentifierFilterList:e,catentryString:R(t,p(T)),selectedCatentry:t}).promise()}(l).done(function(e){t.resolve(e)}).fail(function(){!0===N&&D(l).done(function(e){t.resolve(e)})}):D(u).done(function(e){t.resolve(e)});return t.promise()})().done(function(e){_=e,i.resolve(_)}).fail(function(){"100"!==y.val()&&I.pubsub("publish","NO_STORES_WITHIN_RADIUS"),"100"===y.val()&&A()})}),I.when(i).done(function(){r.resolve(w.combineData()),f.hideLoadingNotification()}),r.promise()},resubmitWithMaxRadius:function(){y.val(y.find("option:last").val()),I("#search-stores").trigger("click"),E=!0},createOrder:function(t){f.showLoadingNotification("p");var e={catentryId:h.val(),physicalStoreId:t.physicalStoreId,storeNumber:t.storeNumber};o.orderId&&(e.orderId=o.orderId),o.orderItemId&&(e.orderItemId=o.orderItemId);var r=L.robisOrderCreateUrl+"&"+I.param(e);return I.post(r).then(function(e){if(e&&e.errorMessage)throw new Error(e.errorMessage);o={storeNumber:t.storeNumber,orderId:e.orderId,orderItemId:e.orderItemId},f.hideLoadingNotification()}).catch(function(e){throw f.hideLoadingNotification(),e})},processOrder:function(e){f.showLoadingNotification("p");var t={orderId:o.orderId,storeNumber:o.storeNumber,firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone};e.comments&&(t.comments=e.comments);var r=L.robisOrderProcessUrl+"&"+I.param(t);return I.post(r).then(function(e){if(e&&e.errorMessage)throw new Error(e.errorMessage);return o={},f.hideLoadingNotification(),e}).catch(function(e){throw f.hideLoadingNotification(),e})},setProductSelection:function(e){T=e},setProductAvailabilityJSON:function(e){O=e},getProductAvailabilityJSON:function(){return O},resetOMSFindInStoreError:function(){N=!1}}});
//# sourceMappingURL=../../../../maps/js/wcs/view/find-in-store/find-in-store-model.hash-5154acd60f9cb01aaf6c059caeea872d.js.map